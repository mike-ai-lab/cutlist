<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AutoNestCut Interactive Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .container { display: flex; gap: 20px; }
        .diagrams-container { flex: 1; }
        .report-container { flex: 1; }
        .diagram-card { border: 1px solid #ddd; margin: 10px 0; padding: 10px; }
        .diagram-canvas { border: 1px solid #ccc; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 60%; max-width: 800px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
        #modalCanvas { border: 1px solid #ddd; }
        #modalInfo { margin-top: 15px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>AutoNestCut Interactive Report</h1>
        <button onclick="window.print()">Print / Save as PDF</button>
    </div>
    <div class="container">
        <div id="diagramsContainer" class="diagrams-container"></div>
        <div id="reportContainer" class="report-container">
            <h2>Overall Summary</h2>
            <table id="summaryTable"></table>
            <h2>Materials Used</h2>
            <div id="materialsContainer"></div>
            <h2>Unique Part Types</h2>
            <table id="uniquePartTypesTable"></table>
            <h2>Unique Board Types</h2>
            <table id="uniqueBoardTypesTable"></table>
            <h2>Boards Summary</h2>
            <table id="boardsTable"></table>
            <h2>Parts Placed (Detailed)</h2>
            <table id="partsTable"></table>
        </div>
    </div>
    <div id="partModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <canvas id="modalCanvas" width="500" height="400"></canvas>
            <div id="modalInfo"></div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        let g_boardsData = [{"material":"CHESTNUT_WOOD","stock_width":2440,"stock_height":1220,"parts_count":9,"used_area":2470604,"waste_area":506196,"waste_percentage":17,"efficiency_percentage":83,"parts":[{"name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":313600,"x":0,"y":0,"rotated":false,"instance_id":"P1","texture_data":null},{"name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":313600,"x":570,"y":0,"rotated":false,"instance_id":"P2","texture_data":null},{"name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":313600,"x":1140,"y":0,"rotated":false,"instance_id":"P3","texture_data":null},{"name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":313600,"x":1710,"y":0,"rotated":false,"instance_id":"P4","texture_data":null},{"name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":0,"y":570,"rotated":false,"instance_id":"P5","texture_data":null},{"name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":500,"y":570,"rotated":false,"instance_id":"P6","texture_data":null},{"name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":1000,"y":570,"rotated":false,"instance_id":"P7","texture_data":null},{"name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":1500,"y":570,"rotated":false,"instance_id":"P8","texture_data":null},{"name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":2000,"y":570,"rotated":false,"instance_id":"P9","texture_data":null}]},{"material":"CHESTNUT_WOOD","stock_width":2440,"stock_height":1220,"parts_count":13,"used_area":2190785.000000001,"waste_area":786014.9999999991,"waste_percentage":26.4,"efficiency_percentage":73.6,"parts":[{"name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":0,"y":0,"rotated":false,"instance_id":"P10","texture_data":null},{"name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":500,"y":0,"rotated":false,"instance_id":"P11","texture_data":null},{"name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":1000,"y":0,"rotated":false,"instance_id":"P12","texture_data":null},{"name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","area":274400,"x":1500,"y":0,"rotated":false,"instance_id":"P13","texture_data":null},{"name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":2000,"y":0,"rotated":false,"instance_id":"P14","texture_data":null},{"name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":0,"y":570,"rotated":false,"instance_id":"P15","texture_data":null},{"name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":310,"y":570,"rotated":false,"instance_id":"P16","texture_data":null},{"name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":620,"y":570,"rotated":false,"instance_id":"P17","texture_data":null},{"name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":930,"y":570,"rotated":false,"instance_id":"P18","texture_data":null},{"name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":1240,"y":570,"rotated":false,"instance_id":"P19","texture_data":null},{"name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":1550,"y":570,"rotated":false,"instance_id":"P20","texture_data":null},{"name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","area":118604,"x":1860,"y":710,"rotated":false,"instance_id":"P21","texture_data":null},{"name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":54953,"x":2170,"y":710,"rotated":false,"instance_id":"P22","texture_data":null}]},{"material":"CHESTNUT_WOOD","stock_width":2440,"stock_height":1220,"parts_count":12,"used_area":1730793.0000000014,"waste_area":1246006.9999999986,"waste_percentage":41.86,"efficiency_percentage":58.14,"parts":[{"name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":0,"y":0,"rotated":false,"instance_id":"P23","texture_data":null},{"name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":310,"y":0,"rotated":false,"instance_id":"P24","texture_data":null},{"name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":620,"y":0,"rotated":false,"instance_id":"P25","texture_data":null},{"name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":930,"y":0,"rotated":false,"instance_id":"P26","texture_data":null},{"name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":1240,"y":0,"rotated":false,"instance_id":"P27","texture_data":null},{"name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":1550,"y":0,"rotated":false,"instance_id":"P28","texture_data":null},{"name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":208004,"x":1860,"y":0,"rotated":false,"instance_id":"P29","texture_data":null},{"name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":54953,"x":2170,"y":0,"rotated":false,"instance_id":"P30","texture_data":null},{"name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":54953,"x":2170,"y":310,"rotated":false,"instance_id":"P31","texture_data":null},{"name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":54953,"x":2170,"y":620,"rotated":false,"instance_id":"P32","texture_data":null},{"name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":54953,"x":0,"y":710,"rotated":false,"instance_id":"P33","texture_data":null},{"name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","grain_direction":"vertical","area":54953,"x":190,"y":710,"rotated":false,"instance_id":"P34","texture_data":null}]},{"material":"Oak (CPRTF8)","stock_width":2440,"stock_height":1220,"parts_count":5,"used_area":1848000,"waste_area":1128800,"waste_percentage":37.92,"efficiency_percentage":62.08,"parts":[{"name":"Left side2","width":560,"height":850,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":476000,"x":0,"y":0,"rotated":false,"instance_id":"P35","texture_data":null},{"name":"Left side2","width":560,"height":850,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":476000,"x":570,"y":0,"rotated":false,"instance_id":"P36","texture_data":null},{"name":"Left side2","width":560,"height":850,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":476000,"x":1140,"y":0,"rotated":false,"instance_id":"P37","texture_data":null},{"name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":1710,"y":0,"rotated":false,"instance_id":"P38","texture_data":null},{"name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":2020,"y":0,"rotated":false,"instance_id":"P39","texture_data":null}]},{"material":"Oak (CPRTF8)","stock_width":2440,"stock_height":1220,"parts_count":10,"used_area":1776000,"waste_area":1200800,"waste_percentage":40.34,"efficiency_percentage":59.66,"parts":[{"name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":0,"y":0,"rotated":false,"instance_id":"P40","texture_data":null},{"name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":310,"y":0,"rotated":false,"instance_id":"P41","texture_data":null},{"name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":620,"y":0,"rotated":false,"instance_id":"P42","texture_data":null},{"name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":930,"y":0,"rotated":false,"instance_id":"P43","texture_data":null},{"name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":1240,"y":0,"rotated":false,"instance_id":"P44","texture_data":null},{"name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":210000,"x":1550,"y":0,"rotated":false,"instance_id":"P45","texture_data":null},{"name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":168000,"x":1860,"y":0,"rotated":false,"instance_id":"P46","texture_data":null},{"name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":168000,"x":1860,"y":570,"rotated":false,"instance_id":"P47","texture_data":null},{"name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":90000,"x":2170,"y":0,"rotated":false,"instance_id":"P48","texture_data":null},{"name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":90000,"x":2170,"y":610,"rotated":false,"instance_id":"P49","texture_data":null}]},{"material":"Oak (CPRTF8)","stock_width":2440,"stock_height":1220,"parts_count":4,"used_area":516000,"waste_area":2460800,"waste_percentage":82.67,"efficiency_percentage":17.33,"parts":[{"name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":168000,"x":0,"y":0,"rotated":false,"instance_id":"P50","texture_data":null},{"name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":168000,"x":310,"y":0,"rotated":false,"instance_id":"P51","texture_data":null},{"name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":90000,"x":620,"y":0,"rotated":false,"instance_id":"P52","texture_data":null},{"name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","area":90000,"x":780,"y":0,"rotated":false,"instance_id":"P53","texture_data":null}]},{"material":"Plywood","stock_width":2440,"stock_height":1220,"parts_count":8,"used_area":1030399.9999999999,"waste_area":1946400,"waste_percentage":65.39,"efficiency_percentage":34.61,"parts":[{"name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":0,"y":0,"rotated":false,"instance_id":"P54","texture_data":null},{"name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":240,"y":0,"rotated":false,"instance_id":"P55","texture_data":null},{"name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":480,"y":0,"rotated":false,"instance_id":"P56","texture_data":null},{"name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":720,"y":0,"rotated":false,"instance_id":"P57","texture_data":null},{"name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":960,"y":0,"rotated":false,"instance_id":"P58","texture_data":null},{"name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":1200,"y":0,"rotated":false,"instance_id":"P59","texture_data":null},{"name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":1440,"y":0,"rotated":false,"instance_id":"P60","texture_data":null},{"name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","area":128800,"x":1680,"y":0,"rotated":false,"instance_id":"P61","texture_data":null}]},{"material":"Hardwood Plywood (4C2IOU)","stock_width":2440,"stock_height":1220,"parts_count":4,"used_area":1478400,"waste_area":1498400,"waste_percentage":50.34,"efficiency_percentage":49.66,"parts":[{"name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"any","area":369600,"x":0,"y":0,"rotated":false,"instance_id":"P62","texture_data":null},{"name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"any","area":369600,"x":570,"y":0,"rotated":false,"instance_id":"P63","texture_data":null},{"name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"any","area":369600,"x":1140,"y":0,"rotated":false,"instance_id":"P64","texture_data":null},{"name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"any","area":369600,"x":1710,"y":0,"rotated":false,"instance_id":"P65","texture_data":null}]},{"material":"Hardwood Plywood (4C2IOU)","stock_width":2440,"stock_height":1220,"parts_count":4,"used_area":672000,"waste_area":2304800,"waste_percentage":77.43,"efficiency_percentage":22.569999999999993,"parts":[{"name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"vertical","area":168000,"x":0,"y":0,"rotated":false,"instance_id":"P66","texture_data":null},{"name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"vertical","area":168000,"x":310,"y":0,"rotated":false,"instance_id":"P67","texture_data":null},{"name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"vertical","area":168000,"x":620,"y":0,"rotated":false,"instance_id":"P68","texture_data":null},{"name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"vertical","area":168000,"x":930,"y":0,"rotated":false,"instance_id":"P69","texture_data":null}]},{"material":"GRANITE","stock_width":2440,"stock_height":1220,"parts_count":4,"used_area":1415999.9999999998,"waste_area":1560800.0000000002,"waste_percentage":52.43,"efficiency_percentage":47.57,"parts":[{"name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","grain_direction":"any","area":354000,"x":0,"y":0,"rotated":false,"instance_id":"P70","texture_data":null},{"name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","grain_direction":"any","area":354000,"x":600,"y":0,"rotated":false,"instance_id":"P71","texture_data":null},{"name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","grain_direction":"any","area":354000,"x":1200,"y":0,"rotated":false,"instance_id":"P72","texture_data":null},{"name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","grain_direction":"any","area":354000,"x":1800,"y":0,"rotated":false,"instance_id":"P73","texture_data":null}]}];
        let g_reportData = {"parts_placed":[{"part_unique_id":"P1","name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":313600,"board_number":1,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P2","name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":313600,"board_number":1,"position_x":570,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P3","name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":313600,"board_number":1,"position_x":1140,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P4","name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":313600,"board_number":1,"position_x":1710,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P5","name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":1,"position_x":0,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P6","name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":1,"position_x":500,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P7","name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":1,"position_x":1000,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P8","name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":1,"position_x":1500,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P9","name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":1,"position_x":2000,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P10","name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":2,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P11","name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":2,"position_x":500,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P12","name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":2,"position_x":1000,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P13","name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","area":274400,"board_number":2,"position_x":1500,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P14","name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":2,"position_x":2000,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P15","name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":2,"position_x":0,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P16","name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":2,"position_x":310,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P17","name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":2,"position_x":620,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P18","name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":2,"position_x":930,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P19","name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":2,"position_x":1240,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P20","name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":2,"position_x":1550,"position_y":570,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P21","name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","area":118604,"board_number":2,"position_x":1860,"position_y":710,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P22","name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","area":54953,"board_number":2,"position_x":2170,"position_y":710,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P23","name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":3,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P24","name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":3,"position_x":310,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P25","name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":3,"position_x":620,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P26","name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":3,"position_x":930,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P27","name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":3,"position_x":1240,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P28","name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":3,"position_x":1550,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P29","name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","area":208004,"board_number":3,"position_x":1860,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P30","name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","area":54953,"board_number":3,"position_x":2170,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P31","name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","area":54953,"board_number":3,"position_x":2170,"position_y":310,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P32","name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","area":54953,"board_number":3,"position_x":2170,"position_y":620,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P33","name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","area":54953,"board_number":3,"position_x":0,"position_y":710,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P34","name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","area":54953,"board_number":3,"position_x":190,"position_y":710,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P35","name":"Left side2","width":560,"height":850,"thickness":20,"material":"Oak (CPRTF8)","area":476000,"board_number":4,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P36","name":"Left side2","width":560,"height":850,"thickness":20,"material":"Oak (CPRTF8)","area":476000,"board_number":4,"position_x":570,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P37","name":"Left side2","width":560,"height":850,"thickness":20,"material":"Oak (CPRTF8)","area":476000,"board_number":4,"position_x":1140,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P38","name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":4,"position_x":1710,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P39","name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":4,"position_x":2020,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P40","name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":5,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P41","name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":5,"position_x":310,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P42","name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":5,"position_x":620,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P43","name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":5,"position_x":930,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P44","name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":5,"position_x":1240,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P45","name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","area":210000,"board_number":5,"position_x":1550,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P46","name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","area":168000,"board_number":5,"position_x":1860,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P47","name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","area":168000,"board_number":5,"position_x":1860,"position_y":570,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P48","name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","area":90000,"board_number":5,"position_x":2170,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P49","name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","area":90000,"board_number":5,"position_x":2170,"position_y":610,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P50","name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","area":168000,"board_number":6,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P51","name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","area":168000,"board_number":6,"position_x":310,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P52","name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","area":90000,"board_number":6,"position_x":620,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P53","name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","area":90000,"board_number":6,"position_x":780,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P54","name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P55","name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":240,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P56","name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":480,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P57","name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":720,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P58","name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":960,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P59","name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":1200,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P60","name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":1440,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P61","name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","area":128800,"board_number":7,"position_x":1680,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P62","name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":369600,"board_number":8,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P63","name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":369600,"board_number":8,"position_x":570,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P64","name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":369600,"board_number":8,"position_x":1140,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P65","name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":369600,"board_number":8,"position_x":1710,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P66","name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":168000,"board_number":9,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P67","name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":168000,"board_number":9,"position_x":310,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P68","name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":168000,"board_number":9,"position_x":620,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P69","name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","area":168000,"board_number":9,"position_x":930,"position_y":0,"rotated":"No","grain_direction":"vertical"},{"part_unique_id":"P70","name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","area":354000,"board_number":10,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P71","name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","area":354000,"board_number":10,"position_x":600,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P72","name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","area":354000,"board_number":10,"position_x":1200,"position_y":0,"rotated":"No","grain_direction":"any"},{"part_unique_id":"P73","name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","area":354000,"board_number":10,"position_x":1800,"position_y":0,"rotated":"No","grain_direction":"any"}],"unique_part_types":[{"name":"Back board","width":560,"height":660,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"any","total_quantity":4,"total_area":1478400},{"name":"Component#4","width":179,"height":307,"thickness":30,"material":"CHESTNUT_WOOD","grain_direction":"vertical","total_quantity":6,"total_area":329718.0000000001},{"name":"CounterTop","width":590,"height":600,"thickness":45,"material":"GRANITE","grain_direction":"any","total_quantity":4,"total_area":1415999.9999999998},{"name":"Facade","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","total_quantity":4,"total_area":832016.000000001},{"name":"Facade2","width":298,"height":698,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"vertical","total_quantity":4,"total_area":832016.0000000006},{"name":"Facadea","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","total_quantity":4,"total_area":474416.00000000023},{"name":"Facadeaa","width":298,"height":398,"thickness":37.2,"material":"CHESTNUT_WOOD","grain_direction":"any","total_quantity":4,"total_area":474416.0000000005},{"name":"Left side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","total_quantity":4,"total_area":840000},{"name":"Left side2","width":560,"height":850,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","total_quantity":3,"total_area":1428000},{"name":"Lower board","width":300,"height":560,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","total_quantity":4,"total_area":672000},{"name":"Lower board`1","width":560,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","total_quantity":4,"total_area":1254400},{"name":"Plinth``1","width":150,"height":600,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","total_quantity":4,"total_area":360000},{"name":"Right side","width":300,"height":700,"thickness":20,"material":"Oak (CPRTF8)","grain_direction":"vertical","total_quantity":4,"total_area":840000},{"name":"Shelf 1","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","total_quantity":4,"total_area":515199.99999999994},{"name":"Shelf 1`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","total_quantity":4,"total_area":1097600},{"name":"Shelf 2","width":230,"height":560,"thickness":20,"material":"Plywood","grain_direction":"vertical","total_quantity":4,"total_area":515199.99999999994},{"name":"Shelf 2`1","width":490,"height":560,"thickness":20,"material":"CHESTNUT_WOOD","grain_direction":"any","total_quantity":4,"total_area":1097600},{"name":"Up board","width":300,"height":560,"thickness":20,"material":"Hardwood Plywood (4C2IOU)","grain_direction":"vertical","total_quantity":4,"total_area":672000}],"unique_board_types":[{"material":"CHESTNUT_WOOD","dimensions":"2440.0 x 1220.0mm","count":3,"total_area":8930400,"price_per_sheet":140,"total_cost":420},{"material":"GRANITE","dimensions":"2440.0 x 1220.0mm","count":1,"total_area":2976800,"price_per_sheet":0,"total_cost":0},{"material":"Hardwood Plywood (4C2IOU)","dimensions":"2440.0 x 1220.0mm","count":2,"total_area":5953600,"price_per_sheet":0,"total_cost":0},{"material":"Oak (CPRTF8)","dimensions":"2440.0 x 1220.0mm","count":3,"total_area":8930400,"price_per_sheet":145,"total_cost":435},{"material":"Plywood","dimensions":"2440.0 x 1220.0mm","count":1,"total_area":2976800,"price_per_sheet":44,"total_cost":44}],"boards":[{"board_number":1,"material":"CHESTNUT_WOOD","stock_size":"2440.0mm x 1220.0mm","parts_count":9,"used_area":2470604,"waste_area":506196,"waste_percentage":17,"efficiency":83},{"board_number":2,"material":"CHESTNUT_WOOD","stock_size":"2440.0mm x 1220.0mm","parts_count":13,"used_area":2190785,"waste_area":786015,"waste_percentage":26.4,"efficiency":73.6},{"board_number":3,"material":"CHESTNUT_WOOD","stock_size":"2440.0mm x 1220.0mm","parts_count":12,"used_area":1730793,"waste_area":1246007,"waste_percentage":41.86,"efficiency":58.14},{"board_number":4,"material":"Oak (CPRTF8)","stock_size":"2440.0mm x 1220.0mm","parts_count":5,"used_area":1848000,"waste_area":1128800,"waste_percentage":37.92,"efficiency":62.08},{"board_number":5,"material":"Oak (CPRTF8)","stock_size":"2440.0mm x 1220.0mm","parts_count":10,"used_area":1776000,"waste_area":1200800,"waste_percentage":40.34,"efficiency":59.66},{"board_number":6,"material":"Oak (CPRTF8)","stock_size":"2440.0mm x 1220.0mm","parts_count":4,"used_area":516000,"waste_area":2460800,"waste_percentage":82.67,"efficiency":17.33},{"board_number":7,"material":"Plywood","stock_size":"2440.0mm x 1220.0mm","parts_count":8,"used_area":1030400,"waste_area":1946400,"waste_percentage":65.39,"efficiency":34.61},{"board_number":8,"material":"Hardwood Plywood (4C2IOU)","stock_size":"2440.0mm x 1220.0mm","parts_count":4,"used_area":1478400,"waste_area":1498400,"waste_percentage":50.34,"efficiency":49.66},{"board_number":9,"material":"Hardwood Plywood (4C2IOU)","stock_size":"2440.0mm x 1220.0mm","parts_count":4,"used_area":672000,"waste_area":2304800,"waste_percentage":77.43,"efficiency":22.569999999999993},{"board_number":10,"material":"GRANITE","stock_size":"2440.0mm x 1220.0mm","parts_count":4,"used_area":1416000,"waste_area":1560800,"waste_percentage":52.43,"efficiency":47.57}],"summary":{"total_parts_instances":73,"total_unique_part_types":18,"total_boards":10,"total_stock_area":29768000,"total_used_area":15128982,"total_waste_area":14639018,"overall_waste_percentage":49.18,"overall_efficiency":50.82,"total_project_cost":899}};
        
        
        function renderDiagrams() {
    const container = document.getElementById('diagramsContainer');
    container.innerHTML = '';

    if (!g_boardsData || g_boardsData.length === 0) {
        container.innerHTML = '<p>No cutting diagrams to display.</p>';
        return;
    }

    g_boardsData.forEach((board, boardIndex) => {
        const card = document.createElement('div');
        card.className = 'diagram-card';

        const title = document.createElement('h3');
        title.textContent = `${board.material} Board ${boardIndex + 1}`;
        card.appendChild(title);

        const info = document.createElement('p');
        info.innerHTML = `Size: ${board.stock_width.toFixed(1)}x${board.stock_height.toFixed(1)}mm<br>
                          Waste: ${board.waste_percentage.toFixed(1)}% (Efficiency: ${board.efficiency_percentage.toFixed(1)}%)`;
        card.appendChild(info);

        const canvas = document.createElement('canvas');
        canvas.className = 'diagram-canvas';
        card.appendChild(canvas);

        container.appendChild(card);

        // Canvas Drawing
        const ctx = canvas.getContext('2d');
        const padding = 40;
        const maxCanvasDim = 600;
        const scale = Math.min(
            (maxCanvasDim - 2 * padding) / board.stock_width,
            (maxCanvasDim - 2 * padding) / board.stock_height
        );

        canvas.width = board.stock_width * scale + 2 * padding;
        canvas.height = board.stock_height * scale + 2 * padding;

        // Draw Board Outline (grayscale)
        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 2;
        ctx.strokeRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
        
        // Add board dimensions as text on the board
        ctx.fillStyle = '#333';
        ctx.font = `${Math.max(12, 14 * scale)}px Arial`;
        ctx.textAlign = 'center';
        ctx.fillText(`${board.stock_width.toFixed(0)}mm`, padding + (board.stock_width * scale) / 2, padding - 5);
        
        ctx.save();
        ctx.translate(padding - 15, padding + (board.stock_height * scale) / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText(`${board.stock_height.toFixed(0)}mm`, 0, 0);
        ctx.restore();

        // Draw Parts
        const parts = board.parts || [];
        parts.forEach((part, partIndex) => {
            const partX = padding + part.x * scale;
            const partY = padding + part.y * scale;
            const partWidth = part.width * scale;
            const partHeight = part.height * scale;

            // Blue part fill
            ctx.fillStyle = 'rgb(116, 185, 255)';
            ctx.fillRect(partX, partY, partWidth, partHeight);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(partX, partY, partWidth, partHeight);

            // Store part data for click detection
            canvas.partData = canvas.partData || [];
            canvas.partData.push({
                x: partX, y: partY, width: partWidth, height: partHeight,
                part: part, boardIndex: boardIndex
            });

            // Add part ID in center - properly aligned
            if (partWidth > 30 && partHeight > 20) {
                ctx.fillStyle = '#000';
                ctx.font = `${Math.max(8, 10 * scale)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const labelContent = part.instance_id || `P${partIndex + 1}`;
                ctx.fillText(labelContent, partX + partWidth / 2, partY + partHeight / 2);
            }
            
            // Add width dimension (horizontal) - inside piece
            if (partWidth > 50) {
                ctx.fillStyle = '#000';
                ctx.font = `${Math.max(8, 10 * scale)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText(`${part.width.toFixed(0)}mm`, partX + partWidth / 2, partY + 5);
            }
            
            // Add height dimension (vertical) - inside piece
            if (partHeight > 50) {
                ctx.save();
                ctx.translate(partX + 5, partY + partHeight / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillStyle = '#000';
                ctx.font = `${Math.max(8, 10 * scale)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText(`${part.height.toFixed(0)}mm`, 0, 0);
                ctx.restore();
            }
        });

        // Add click event listener
        canvas.addEventListener('click', (e) => handleCanvasClick(e, canvas));
        canvas.addEventListener('mousemove', (e) => handleCanvasHover(e, canvas));
        canvas.style.cursor = 'pointer';
    });
}
        function renderReport() {
    if (!g_reportData) return;

    // Summary Table
    const summaryTable = document.getElementById('summaryTable');
    summaryTable.innerHTML = `
        <tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Total Parts Instances</td><td>${g_reportData.summary.total_parts_instances || 0}</td></tr>
        <tr><td>Total Unique Part Types</td><td>${g_reportData.summary.total_unique_part_types || 0}</td></tr>
        <tr><td>Total Boards</td><td>${g_reportData.summary.total_boards || 0}</td></tr>
        <tr><td>Overall Efficiency</td><td>${(g_reportData.summary.overall_efficiency || 0).toFixed(2)}%</td></tr>
        <tr><td><strong>Total Project Cost</strong></td><td class="total-highlight"><strong>$${(g_reportData.summary.total_project_cost || 0).toFixed(2)}</strong></td></tr>
    `;

    // Materials Used Section - moved to top
    const materialsContainer = document.getElementById('materialsContainer');
    if (materialsContainer && g_reportData.unique_board_types) {
        materialsContainer.innerHTML = g_reportData.unique_board_types.map(board_type => `
            <div class="material-item">
                <div class="material-swatch" style="background: ${getMaterialTexture(board_type.material)}"></div>
                <span class="material-name">${board_type.material}</span>
                <span class="material-price">Price: $${(board_type.price_per_sheet || 0).toFixed(2)}</span>
            </div>
        `).join('');
    }

    // Unique Part Types Table
    const uniquePartTypesTable = document.getElementById('uniquePartTypesTable');
    if (uniquePartTypesTable) {
        uniquePartTypesTable.innerHTML = `
            <tr><th>Name</th><th>W (mm)</th><th>H (mm)</th><th>Thick (mm)</th><th>Material</th><th>Grain</th><th>Total Qty</th><th>Total Area (m²)</th></tr>
        `;
        if (g_reportData.unique_part_types) {
            g_reportData.unique_part_types.forEach(part_type => {
                uniquePartTypesTable.innerHTML += `
                    <tr>
                        <td>${part_type.name}</td>
                        <td>${part_type.width.toFixed(2)}</td>
                        <td>${part_type.height.toFixed(2)}</td>
                        <td>${part_type.thickness.toFixed(2)}</td>
                        <td>${part_type.material}</td>
                        <td>${part_type.grain_direction}</td>
                        <td class="total-highlight">${part_type.total_quantity}</td>
                        <td>${(part_type.total_area / 1000000).toFixed(3)}</td>
                    </tr>
                `;
            });
        }
    }

    // Unique Board Types Table
    const uniqueBoardTypesTable = document.getElementById('uniqueBoardTypesTable');
    if (uniqueBoardTypesTable) {
        uniqueBoardTypesTable.innerHTML = `
            <tr><th>Material</th><th>Dimensions</th><th>Count</th><th>Total Area (m²)</th><th>Price/Sheet</th><th>Total Cost</th></tr>
        `;
        if (g_reportData.unique_board_types) {
            g_reportData.unique_board_types.forEach(board_type => {
                uniqueBoardTypesTable.innerHTML += `
                    <tr>
                        <td>${board_type.material}</td>
                        <td>${board_type.dimensions}</td>
                        <td class="total-highlight">${board_type.count}</td>
                        <td>${(board_type.total_area / 1000000).toFixed(3)}</td>
                        <td>$${(board_type.price_per_sheet || 0).toFixed(2)}</td>
                        <td class="total-highlight">$${(board_type.total_cost || 0).toFixed(2)}</td>
                    </tr>
                `;
            });
        }
    }

    // Boards Table
    const boardsTable = document.getElementById('boardsTable');
    boardsTable.innerHTML = `
        <tr><th>Board#</th><th>Material</th><th>Size</th><th>Parts</th><th>Efficiency</th></tr>
    `;
    if (g_reportData.boards) {
        g_reportData.boards.forEach(board => {
            boardsTable.innerHTML += `
                <tr>
                    <td>${board.board_number}</td>
                    <td>${board.material}</td>
                    <td>${board.stock_size}</td>
                    <td class="total-highlight">${board.parts_count}</td>
                    <td>${board.efficiency.toFixed(2)}%</td>
                </tr>
            `;
        });
    }

    // Parts Placed Table
    const partsTable = document.getElementById('partsTable');
    partsTable.innerHTML = `
        <tr><th>Unique ID</th><th>Name</th><th>Dimensions</th><th>Material</th><th>Board#</th></tr>
    `;
    const parts_list = g_reportData.parts_placed || g_reportData.parts || [];
    parts_list.forEach(part => {
        partsTable.innerHTML += `
            <tr>
                <td>${part.part_unique_id || part.part_number}</td>
                <td>${part.name}</td>
                <td>${part.width.toFixed(0)} × ${part.height.toFixed(0)}mm</td>
                <td>${part.material}</td>
                <td>${part.board_number}</td>
            </tr>
        `;
    });
}
        function showPartModal(part) {
    const modal = document.getElementById('partModal');
    const modalCanvas = document.getElementById('modalCanvas');
    const modalInfo = document.getElementById('modalInfo');
    
    initThreeJS(part, modalCanvas);
    

    setupOrbitControls();
    
    // Set modal info
    modalInfo.innerHTML = `
        <h3>${part.name}</h3>
        <p><strong>Dimensions:</strong> ${part.width.toFixed(1)} × ${part.height.toFixed(1)} × ${part.thickness.toFixed(1)}mm</p>
        <p><strong>Area:</strong> ${(part.width * part.height / 1000000).toFixed(3)} m²</p>
        <p><strong>Material:</strong> ${part.material}</p>
        <p><strong>Grain Direction:</strong> ${part.grain_direction || 'Any'}</p>
        <p><strong>Rotated:</strong> ${part.rotated ? 'Yes' : 'No'}</p>
        <p style="color: #666; font-size: 12px;">Left drag: orbit | Middle/Shift+Left drag: pan | Scroll: zoom</p>
    `;
    
    // Setup button controls

    
    document.getElementById('projectionToggle').onclick = () => {
        isOrthographic = !isOrthographic;
        document.getElementById('projectionToggle').textContent = isOrthographic ? 'Perspective' : 'Orthographic';
        
        if (isOrthographic) {
            const distance = camera.position.distanceTo(controls.target);
            camera = new THREE.OrthographicCamera(-distance, distance, distance, -distance, 0.1, 1000);
        } else {
            camera = new THREE.PerspectiveCamera(75, renderer.domElement.width / renderer.domElement.height, 0.1, 1000);
        }
        camera.position.set(5, 5, 5);
        controls.object = camera;
    };
    
    currentPart = part;
    modal.style.display = 'block';
    animate();
}
        function initThreeJS(part, canvas) {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);
    
    camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
    camera.position.set(5, 5, 5);
    
    renderer = new THREE.WebGLRenderer({ canvas: canvas });
    renderer.setSize(canvas.width, canvas.height);
    
    // Create box with part dimensions
    const w = part.width / 100;
    const h = part.height / 100; 
    const d = part.thickness / 100;
    
    const geometry = new THREE.BoxGeometry(w, h, d);
    const material = new THREE.MeshBasicMaterial({ color: 0x74b9ff });
    cube = new THREE.Mesh(geometry, material);
    
    // Add subtle edges
    const edges = new THREE.EdgesGeometry(geometry);
    const edgeMaterial = new THREE.LineBasicMaterial({ color: 0x333333, linewidth: 1 });
    const wireframe = new THREE.LineSegments(edges, edgeMaterial);
    
    scene.add(cube);
    scene.add(wireframe);
}
        function setupOrbitControls() {
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.25;
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.enableRotate = true;
    controls.minDistance = 1;
    controls.maxDistance = 50;
}
        function animate() {
    if (!renderer || !scene || !camera) return;
    
    controls.update();
    renderer.render(scene, camera);
    
    if (document.getElementById('partModal').style.display === 'block') {
        requestAnimationFrame(animate);
    }
}
        function handleCanvasClick(e, canvas) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    if (canvas.partData) {
        for (let partData of canvas.partData) {
            if (x >= partData.x && x <= partData.x + partData.width &&
                y >= partData.y && y <= partData.y + partData.height) {
                showPartModal(partData.part);
                break;
            }
        }
    }
}
        function handleCanvasHover(e, canvas) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    let hovering = false;
    if (canvas.partData) {
        for (let partData of canvas.partData) {
            if (x >= partData.x && x <= partData.x + partData.width &&
                y >= partData.y && y <= partData.y + partData.height) {
                hovering = true;
                break;
            }
        }
    }
    canvas.style.cursor = hovering ? 'pointer' : 'default';
}
        function getMaterialColor(material) {
    // Generate consistent colors based on material name
    let hash = 0;
    for (let i = 0; i < material.length; i++) {
        hash = material.charCodeAt(i) + ((hash << 5) - hash);
    }
    const hue = Math.abs(hash) % 360;
    return `hsl(${hue}, 45%, 65%)`;
}
        function getMaterialTexture(material) {
    // Create a simple pattern based on material name
    if (material.toLowerCase().includes('wood') || material.toLowerCase().includes('chestnut')) {
        return 'repeating-linear-gradient(45deg, #8B4513, #8B4513 2px, #A0522D 2px, #A0522D 4px)';
    } else if (material.includes('240,240,240')) {
        return 'repeating-linear-gradient(90deg, #f0f0f0, #f0f0f0 3px, #e0e0e0 3px, #e0e0e0 6px)';
    }
    return getMaterialColor(material);
}
        function getPartColor(partIndex) {
    const colors = [
        'rgba(255,0,0,0.6)', 'rgba(0,0,255,0.6)', 'rgba(0,255,0,0.6)', 'rgba(255,255,0,0.6)',
        'rgba(255,165,0,0.6)', 'rgba(128,0,128,0.6)', 'rgba(0,255,255,0.6)', 'rgba(255,0,255,0.6)'
    ];
    return colors[partIndex % colors.length];
}
        function initResizer() {
    const resizer = document.getElementById('resizer');
    const leftSide = document.getElementById('diagramsContainer');
    const rightSide = document.getElementById('reportContainer');
    
    if (!resizer || !leftSide || !rightSide || resizerInitialized) return;
    
    let isResizing = false;
    resizerInitialized = true;
    
    // Set initial cursor style
    resizer.style.cursor = 'col-resize';
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        e.preventDefault();
        
        const container = document.querySelector('.container');
        const containerRect = container.getBoundingClientRect();
        const leftWidth = e.clientX - containerRect.left;
        const totalWidth = containerRect.width;
        const leftPercent = (leftWidth / totalWidth) * 100;
        const rightPercent = 100 - leftPercent;
        
        if (leftPercent > 15 && rightPercent > 25) {
            leftSide.style.flex = `0 0 ${leftPercent}%`;
            rightSide.style.flex = `0 0 ${rightPercent}%`;
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        resizer.style.cursor = 'col-resize';
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
    
    resizer.addEventListener('mousedown', (e) => {
        e.preventDefault();
        isResizing = true;
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    // Ensure resizer cursor is always visible
    resizer.addEventListener('mouseenter', () => {
        if (!isResizing) {
            resizer.style.cursor = 'col-resize';
        }
    });
}
        
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('partModal');
            const closeBtn = document.querySelector('.close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => modal.style.display = 'none');
            }
            window.addEventListener('click', (e) => {
                if (e.target === modal) modal.style.display = 'none';
            });
            initResizer();
        });
    
        

        
        document.addEventListener('DOMContentLoaded', () => {
            renderDiagrams();
            renderReport();
            
            const modal = document.getElementById('partModal');
            const closeBtn = document.querySelector('.close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => modal.style.display = 'none');
            }
            window.addEventListener('click', (e) => {
                if (e.target === modal) modal.style.display = 'none';
            });
        });
    </script>
</body>
</html>