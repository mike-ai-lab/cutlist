EXTENSION: AUTONESTCUT

FOLDER STRUCTURE:

Folder PATH listing for volume TOSHIBA EXT
Volume serial number is 1E5D-4E3F
F:\ALT_DRIVE\CUTLIST\AUTONESTCUT
¦   AUTONESTCUT_MERGED.txt
¦   loader.rb
¦   README.md
¦   
+---AutoNestCut
¦   ¦   compatibility.rb
¦   ¦   config.rb
¦   ¦   main.rb
¦   ¦   materials_database.rb
¦   ¦   util.rb
¦   ¦   
¦   +---exporters
¦   ¦       diagram_generator.rb
¦   ¦       report_generator.rb
¦   ¦       
¦   +---models
¦   ¦       board.rb
¦   ¦       part.rb
¦   ¦       
¦   +---processors
¦   ¦       model_analyzer.rb
¦   ¦       nester.rb
¦   ¦       
¦   +---resources
¦   ¦       icon.png
¦   ¦       
¦   +---ui
¦       ¦   dialog_manager.rb
¦       ¦   
¦       +---html
¦               app.js
¦               config.html
¦               diagrams_report.html
¦               diagrams_report.js
¦               diagrams_report_backup.js
¦               diagrams_style.css
¦               documentation.html
¦               main.html
¦               report.html
¦               style.css
¦               
+---extras
¦       placeholder_icon.txt
¦       
+---resources
        icon.png
        

CODEBASE MERGED FOR REFERENCE:

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AUTONESTCUT_MERGED.txt

EXTENSION: AUTONESTCUT

FOLDER STRUCTURE:

Folder PATH listing for volume TOSHIBA EXT
Volume serial number is 1E5D-4E3F
F:\ALT_DRIVE\CUTLIST\AUTONESTCUT
¦   AUTONESTCUT_MERGED.txt
¦   loader.rb
¦   README.md
¦   
+---AutoNestCut
¦   ¦   compatibility.rb
¦   ¦   config.rb
¦   ¦   main.rb
¦   ¦   materials_database.rb
¦   ¦   util.rb
¦   ¦   
¦   +---exporters
¦   ¦       diagram_generator.rb
¦   ¦       report_generator.rb
¦   ¦       
¦   +---models
¦   ¦       board.rb
¦   ¦       part.rb
¦   ¦       
¦   +---processors
¦   ¦       model_analyzer.rb
¦   ¦       nester.rb
¦   ¦       
¦   +---resources
¦   ¦       icon.png
¦   ¦       
¦   +---ui
¦       ¦   dialog_manager.rb
¦       ¦   
¦       +---html
¦               app.js
¦               config.html
¦               diagrams_report.html
¦               diagrams_report.js
¦               diagrams_report_backup.js
¦               diagrams_style.css
¦               documentation.html
¦               main.html
¦               report.html
¦               style.css
¦               
+---extras
¦       placeholder_icon.txt
¦       
+---resources
        icon.png
        

CODEBASE MERGED FOR REFERENCE:

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AUTONESTCUT_MERGED.txt



-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\loader.rb

require 'sketchup.rb'

module AutoNestCut
  EXTENSION_NAME = "AutoNestCut"
  EXTENSION_VERSION = "1.0.0"
  
  unless file_loaded?(__FILE__)
    # Use a path relative to this loader so the extension is portable across systems
    main_path = File.join(__dir__, 'AutoNestCut', 'main')
    ex = SketchupExtension.new(EXTENSION_NAME, main_path)
    ex.description = 'Automated nesting and cut list generation for sheet goods'
    ex.version = EXTENSION_VERSION
    ex.copyright = '2024'
    ex.creator = 'AutoNestCut'
    
    Sketchup.register_extension(ex, true)
    file_loaded(__FILE__)
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\README.md

# AutoNestCut SketchUp Extension

AutoNestCut is a SketchUp extension that automates the process of generating optimized cutting diagrams and detailed cut lists from 3D SketchUp models, specifically designed for sheet goods (plywood, MDF, etc.).

## Features

- **Automatic Part Extraction**: Intelligently identifies sheet good components from your SketchUp model
- **Material Management**: Supports multiple materials with configurable stock sizes
- **Optimized Nesting**: Uses advanced algorithms to minimize waste and reduce material costs
- **Visual Diagrams**: Generates clear cutting diagrams directly in SketchUp
- **Detailed Reports**: Comprehensive cut lists with part dimensions, positions, and material usage
- **Export Options**: Export cut lists to CSV for use in spreadsheets

## Installation

1. Copy the entire `AutoNestCut` folder to your SketchUp Plugins directory:
   - Windows: `C:\Users\[username]\AppData\Roaming\SketchUp\SketchUp 20XX\SketchUp\Plugins\`
   - Mac: `~/Library/Application Support/SketchUp 20XX/SketchUp/Plugins/`

2. Restart SketchUp

3. The extension will appear in the Plugins menu and as a toolbar button

## Usage

### Basic Workflow

1. **Model Your Project**: Create your furniture or cabinet project in SketchUp using components for individual parts

2. **Select Components**: Select the groups or components you want to include in your cut list

3. **Launch AutoNestCut**: Click the AutoNestCut toolbar button or go to Plugins > AutoNestCut

4. **Configure Settings**: 
   - Set kerf width (saw blade thickness)
   - Configure stock material sizes
   - Choose nesting preferences

5. **Generate Cut List**: Click "Generate Cut List" to process your selection

6. **Review Results**: 
   - View the visual cutting diagrams in SketchUp
   - Review the detailed report with part lists and material usage
   - Export to CSV if needed

### Component Setup

For best results, follow these guidelines when modeling:

#### Material Assignment
You can assign materials to components in three ways:

1. **Custom Attributes** (Recommended):
   ```ruby
   component.set_attribute('AutoNestCut', 'Material', 'Plywood_19mm')
   ```

2. **Component Names**: Include material name in component name
   - Example: "Door_Plywood_19mm", "Shelf_MDF_16mm"

3. **Layers/Tags**: Place components on layers named after materials

#### Grain Direction
For parts that require specific grain orientation:
```ruby
component.set_attribute('AutoNestCut', 'GrainDirection', 'fixed')
```

### Stock Materials

Default materials included:
- Plywood_19mm: 2440mm Ã— 1220mm
- Plywood_12mm: 2440mm Ã— 1220mm  
- MDF_16mm: 2800mm Ã— 2070mm
- MDF_19mm: 2800mm Ã— 2070mm

You can add custom materials in the configuration dialog.

### Part Filtering

AutoNestCut automatically filters components to identify sheet goods:
- Thickness between 3mm and 50mm
- Minimum surface area of 100mm Ã— 100mm
- Reasonable aspect ratios (not extremely long/thin parts)

## Configuration

### Settings File
Settings are stored in SketchUp's preferences and persist between sessions.

### Kerf Width
Set the kerf width to account for your saw blade thickness. This ensures proper spacing between parts in the nesting layout.

### Rotation
Enable/disable part rotation during nesting. Parts with fixed grain direction will not be rotated regardless of this setting.

## Output

### Visual Diagrams
- Creates a new SketchUp scene with cutting diagrams
- Each board shows nested parts with labels
- Color-coded parts for easy identification
- Waste areas clearly visible

### Cut List Report
- Complete parts list with dimensions and materials
- Board summary with efficiency calculations
- Overall project statistics
- Export to CSV for external use

## Troubleshooting

### No Parts Found
- Ensure selected components meet size criteria for sheet goods
- Check that components have proper dimensions (not zero-size)
- Verify components are not nested too deeply

### Poor Nesting Results
- Try adjusting kerf width
- Enable part rotation if grain direction allows
- Consider breaking large assemblies into individual components

### Dialog Issues
- Ensure SketchUp has proper permissions to create HTML dialogs
- Check that all HTML files are present in the ui/html folder

## Technical Details

### File Structure
```
AutoNestCut/
â”œâ”€â”€ loader.rb                    # Extension entry point
â”œâ”€â”€ AutoNestCut/
â”‚   â”œâ”€â”€ main.rb                  # Main logic
â”‚   â”œâ”€â”€ config.rb                # Settings management
â”‚   â”œâ”€â”€ models/                  # Data models
â”‚   â”œâ”€â”€ processors/              # Analysis and nesting
â”‚   â”œâ”€â”€ ui/                      # User interface
â”‚   â”œâ”€â”€ exporters/               # Report generation
â”‚   â””â”€â”€ util.rb                  # Utilities
â””â”€â”€ resources/                   # Icons and assets
```

### Algorithm
Uses a greedy bin-packing algorithm with the following approach:
1. Sort parts by area (largest first)
2. For each material, attempt to place parts on current board
3. Try both orientations if rotation is allowed
4. Create new board when current board is full
5. Optimize for minimal waste

## License

Copyright 2024 AutoNestCut. All rights reserved.

## Support

For issues and feature requests, please contact the development team.

## Packaging / Publishing Notes

When preparing the extension for distribution (a `.rbz` or as a packaged plugin folder), follow these simple notes:

- Include a valid PNG icon inside the extension package at `AutoNestCut/AutoNestCut/resources/icon.png` (24Ã—24 or 32Ã—32 pixels recommended) so the toolbar shows the proper icon.
- The loader (`loader.rb`) uses a path relative to the `AutoNestCut` folder â€” keep the folder structure intact when packaging.
- Non-essential development artifacts (exported reports, console logs, dev scripts) can be kept outside the final package or in a separate `dev_tools/` or `extras/` folder.

If the toolbar icon does not appear after installing the extension, make sure a valid PNG exists in one of these locations (the extension checks these):

1. `AutoNestCut/AutoNestCut/resources/icon.png` (preferred)
2. `AutoNestCut/resources/icon.png` (legacy)
3. `../icon.png` (repository root â€” used only as a fallback during development)

Restart SketchUp after installing the extension to ensure the toolbar loads correctly.

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\compatibility.rb

# Cross-platform and version compatibility utilities
module AutoNestCut
  module Compatibility
    
    # Check if running on Windows
    def self.windows?
      RUBY_PLATFORM =~ /mswin|mingw|windows/
    end
    
    # Check if running on Mac
    def self.mac?
      RUBY_PLATFORM =~ /darwin/
    end
    
    # Get SketchUp version as integer
    def self.sketchup_version
      Sketchup.version.to_i
    end
    
    # Check if HtmlDialog is available (SU2017+)
    def self.html_dialog_available?
      defined?(UI::HtmlDialog)
    end
    
    # Get appropriate dialog class
    def self.dialog_class
      html_dialog_available? ? UI::HtmlDialog : UI::WebDialog
    end
    
    # Create cross-platform file path
    def self.safe_path(*parts)
      File.join(*parts)
    end
    
    # Get desktop path for current platform
    def self.desktop_path
      if windows?
        File.join(ENV['USERPROFILE'] || ENV['HOME'], 'Desktop')
      else
        File.join(ENV['HOME'], 'Desktop')
      end
    end
    
    # Check if file exists with cross-platform handling
    def self.file_exists?(path)
      File.exist?(path)
    end
    
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\config.rb

module AutoNestCut
  module Config
    
    DEFAULT_SETTINGS = {
      'kerf_width' => 3.0,
      'allow_rotation' => true,
      'stock_materials' => {}
    }
    
    def self.load_settings
      settings = {}
      DEFAULT_SETTINGS.each do |key, value|
        read_value = Sketchup.read_default('AutoNestCut', key, value)
        
        if key == 'stock_materials'
          # Load from database first, then merge with saved settings
          database_materials = MaterialsDatabase.load_database
          saved_materials = read_value.is_a?(Hash) ? read_value : {}
          
          # Convert old array format if needed
          saved_materials = saved_materials.transform_values do |dims|
            if dims.is_a?(Array)
              { 'width' => dims[0].to_f, 'height' => dims[1].to_f, 'price' => 0 }
            else
              dims
            end
          end
          
          # Merge database with saved settings (saved settings take priority)
          settings[key] = database_materials.merge(saved_materials)
        else
          settings[key] = read_value
        end
      end
      settings
    end
    
    def self.save_settings(settings)
      settings.each do |key, value|
        Sketchup.write_default('AutoNestCut', key, value)
      end
    end
    
    def self.get_material_from_definition(component_definition, selected_entities = nil)
      get_material_from_component_definition(component_definition, selected_entities)
    end
    
    # Cache for loaded settings to avoid repeated database access
    @cached_settings = nil
    @material_cache = {}
    
    def self.get_cached_settings
      @cached_settings ||= load_settings
    end
    
    def self.get_material_from_component_definition(component_definition, selected_entities = nil)
      # Use cache to avoid repeated lookups
      cache_key = component_definition.entityID
      return @material_cache[cache_key] if @material_cache[cache_key]
      
      material = nil
      
      # 1. Try custom attribute first
      if component_definition.attribute_dictionaries && component_definition.attribute_dictionaries['AutoNestCut']
        material = component_definition.attribute_dictionaries['AutoNestCut']['Material']
        if material && !material.empty?
          @material_cache[cache_key] = material.to_s
          return material.to_s
        end
      end
      
      # 2. Check component instance material
      if selected_entities
        selected_entities.each do |entity|
          if entity.is_a?(Sketchup::ComponentInstance) && entity.definition == component_definition
            if entity.material
              material_name = entity.material.display_name || entity.material.name
              @material_cache[cache_key] = material_name
              return material_name
            end
          end
        end
      end
      
      # 3. Check faces inside component definition for material
      component_definition.entities.each do |entity|
        if entity.is_a?(Sketchup::Face) && entity.material
          material_name = entity.material.display_name || entity.material.name
          @material_cache[cache_key] = material_name
          return material_name
        end
      end
      
      # 4. Use component name as material ONLY if it looks like a material name
      if component_definition.name && !component_definition.name.empty?
        name = component_definition.name.to_s
        # Check if name contains common material keywords
        material_keywords = ['wood', 'plywood', 'mdf', 'oak', 'pine', 'maple', 'birch', 'cherry', 'walnut', 'mahogany', 'granite', 'marble', 'chestnut']
        if material_keywords.any? { |keyword| name.downcase.include?(keyword) }
          @material_cache[cache_key] = name
          return name
        end
      end

      # 5. Default fallback - use generic material name
      @material_cache[cache_key] = 'Sheet_Material'
      'Sheet_Material'
    end
    
    def self.get_material_texture_data(component_definition, selected_entities = nil)
      # Find material instance
      material = nil
      
      if selected_entities
        selected_entities.each do |entity|
          if entity.is_a?(Sketchup::ComponentInstance) && entity.definition == component_definition
            material = entity.material
            break if material
          end
        end
      end
      
      return nil unless material && material.texture
      
      # Get texture properties
      texture = material.texture
      {
        width: texture.width,
        height: texture.height,
        filename: texture.filename,
        # Note: In a real implementation, you'd need to export the texture image
        # For now, return basic texture info
        scale_x: 1.0,
        scale_y: 1.0
      }
    end
    
    def self.clear_cache
      @cached_settings = nil
      @material_cache = {}
    end
    
    def self.find_stock_material_match(material_name)
      material_lower = material_name.to_s.downcase
      get_cached_settings['stock_materials'].keys.each do |stock_material|
        return stock_material if material_lower.include?(stock_material.downcase) || stock_material.downcase.include?(material_lower)
      end
      nil
    end

    def self.get_grain_direction_from_definition(component_definition)
      # 1. Try custom attribute first
      if component_definition.attribute_dictionaries && component_definition.attribute_dictionaries['AutoNestCut']
        grain = component_definition.attribute_dictionaries['AutoNestCut']['GrainDirection']
        return grain.to_s.downcase if grain && !grain.empty?
      end
      
      # 2. Analyze component dimensions to suggest grain direction
      bounds = component_definition.bounds
      dimensions = [bounds.width.to_mm, bounds.height.to_mm, bounds.depth.to_mm].sort
      thickness = dimensions[0]
      width = dimensions[1]
      height = dimensions[2]
      
      # If one dimension is significantly larger, suggest grain along that direction
      if height > width * 1.5
        return 'vertical'  # Grain runs along height
      elsif width > height * 1.5
        return 'horizontal'  # Grain runs along width
      end
      
      # Default: allow rotation
      'any'
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\main.rb

require 'sketchup.rb'

# Check SketchUp version compatibility
if Sketchup.version.to_i < 20
  UI.messagebox("AutoNestCut requires SketchUp 2020 or later. Current version: #{Sketchup.version}")
  return
end

require_relative 'compatibility'
require_relative 'materials_database'
require_relative 'config'
require_relative 'models/part'
require_relative 'models/board'
require_relative 'processors/model_analyzer'
require_relative 'processors/nester'
require_relative 'ui/dialog_manager'
require_relative 'exporters/diagram_generator'
require_relative 'exporters/report_generator'
require_relative 'util'

module AutoNestCut

  def self.activate_extension
    model = Sketchup.active_model
    selection = model.selection

    if selection.empty?
      UI.messagebox("Please select components or groups to analyze for AutoNestCut.")
      return
    end

    begin
      analyzer = ModelAnalyzer.new
      part_types_by_material_and_quantities = analyzer.extract_parts_from_selection(selection)
      original_components = analyzer.get_original_components_data

      if part_types_by_material_and_quantities.empty?
        UI.messagebox("No valid sheet good parts found in your selection for AutoNestCut.")
        return
      end

      dialog_manager = UIDialogManager.new
  hierarchy_tree = analyzer.get_hierarchy_tree
  Util.debug("Hierarchy tree from analyzer: #{hierarchy_tree.inspect}")
  dialog_manager.show_config_dialog(part_types_by_material_and_quantities, original_components, hierarchy_tree)

    rescue => e
      UI.messagebox("An error occurred during part extraction:\n#{e.message}")
    end
  end



  def self.show_documentation
    # Use HtmlDialog for SU2017+ or WebDialog for older versions
    if defined?(UI::HtmlDialog)
      dialog = UI::HtmlDialog.new(
        dialog_title: "AutoNestCut Documentation",
        preferences_key: "AutoNestCut_Documentation",
        scrollable: true,
        resizable: true,
        width: 1000,
        height: 700
      )
    else
      dialog = UI::WebDialog.new(
        "AutoNestCut Documentation",
        true,
        "AutoNestCut_Documentation",
        1000,
        700,
        100,
        100,
        true
      )
    end
    
    html_file = File.join(__dir__, 'ui', 'html', 'documentation.html')
    dialog.set_file(html_file)
    dialog.show
  end

  # Create main menu (allow recreation on reload)
  menu = UI.menu('Extensions')
  begin
    autonest_menu = menu.add_submenu('AutoNestCut')
  rescue
    # Submenu might already exist, get it
    autonest_menu = menu
  end
  
  autonest_menu.add_item('Generate Cut List') { AutoNestCut.activate_extension }
  autonest_menu.add_separator
  autonest_menu.add_item('Documentation - How to...') { AutoNestCut.show_documentation }

  # Create toolbar with icon
  unless file_loaded?(__FILE__)
    toolbar = UI::Toolbar.new('AutoNestCut')
    cmd = UI::Command.new('AutoNestCut') { AutoNestCut.activate_extension }
    cmd.tooltip = 'Generate optimized cut lists and nesting diagrams for sheet goods'
    cmd.status_bar_text = 'AutoNestCut - Automated nesting for sheet goods'
    
    # Cross-platform icon lookup with a few sensible fallbacks.
    # Prefer a resources/icon.png located alongside this file, then the parent AutoNestCut/resources,
    # then the repository root icon.png. Also verify the file is a PNG by checking the signature.
    possible_icon_paths = [
      File.join(__dir__, 'resources', 'icon.png'),
      File.expand_path('../resources/icon.png', __dir__),
      File.expand_path('../../icon.png', __dir__)
    ]

    chosen_icon = possible_icon_paths.find { |p| Util.png_file?(p) }
    if chosen_icon
      cmd.small_icon = chosen_icon
      cmd.large_icon = chosen_icon
    else
      Util.debug("AutoNestCut: no valid icon found. Looked in: #{possible_icon_paths.join(', ')}")
    end
    
    toolbar.add_item(cmd)
    toolbar.show

    file_loaded(__FILE__)
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\materials_database.rb

require 'csv'

module AutoNestCut
  class MaterialsDatabase
    
    def self.database_file
      File.join(ENV['APPDATA'] || ENV['HOME'], 'AutoNestCut', 'materials_database.csv')
    end
    
    def self.ensure_database_folder
      folder = File.dirname(database_file)
      Dir.mkdir(folder) unless Dir.exist?(folder)
    end
    
    def self.load_database
      ensure_database_folder
      return {} unless File.exist?(database_file)
      
      materials = {}
      CSV.foreach(database_file, headers: true) do |row|
        materials[row['name']] = {
          'width' => row['width'].to_f,
          'height' => row['height'].to_f,
          'price' => row['price'].to_f,
          'supplier' => row['supplier'] || '',
          'notes' => row['notes'] || ''
        }
      end
      materials
    rescue => e
      Util.debug("Error loading materials database: #{e.message}")
      {}
    end
    
    def self.save_database(materials)
      ensure_database_folder
      CSV.open(database_file, 'w') do |csv|
        csv << ['name', 'width', 'height', 'price', 'supplier', 'notes']
        materials.each do |name, data|
          csv << [
            name,
            data['width'] || 2440,
            data['height'] || 1220,
            data['price'] || 0,
            data['supplier'] || '',
            data['notes'] || ''
          ]
        end
      end
    rescue => e
      Util.debug("Error saving materials database: #{e.message}")
    end
    
    def self.import_csv(file_path)
      return {} unless File.exist?(file_path)
      
      materials = {}
      CSV.foreach(file_path, headers: true) do |row|
        name = row['name'] || row['material'] || row['Material']
        next unless name
        
        materials[name] = {
          'width' => (row['width'] || row['Width'] || 2440).to_f,
          'height' => (row['height'] || row['Height'] || 1220).to_f,
          'price' => (row['price'] || row['Price'] || 0).to_f,
          'supplier' => row['supplier'] || row['Supplier'] || '',
          'notes' => row['notes'] || row['Notes'] || ''
        }
      end
      materials
    rescue => e
      Util.debug("Error importing CSV: #{e.message}")
      {}
    end
    
    def self.get_default_materials
      {
        'Plywood_19mm' => { 'width' => 2440, 'height' => 1220, 'price' => 45, 'supplier' => 'Local Supplier', 'notes' => '19mm Birch Plywood' },
        'Plywood_12mm' => { 'width' => 2440, 'height' => 1220, 'price' => 35, 'supplier' => 'Local Supplier', 'notes' => '12mm Birch Plywood' },
        'MDF_16mm' => { 'width' => 2800, 'height' => 2070, 'price' => 25, 'supplier' => 'Local Supplier', 'notes' => '16mm MDF Board' },
        'MDF_19mm' => { 'width' => 2800, 'height' => 2070, 'price' => 30, 'supplier' => 'Local Supplier', 'notes' => '19mm MDF Board' },
        'Oak_Veneer' => { 'width' => 2440, 'height' => 1220, 'price' => 85, 'supplier' => 'Hardwood Supplier', 'notes' => 'Oak Veneer on MDF' },
        'Melamine_White' => { 'width' => 2800, 'height' => 2070, 'price' => 40, 'supplier' => 'Local Supplier', 'notes' => 'White Melamine Board' }
      }
    end
    
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\util.rb

module AutoNestCut
  module Util
    
    def self.to_mm(length)
      length.to_mm
    end
    
    def self.from_mm(mm)
      mm.mm
    end
    
    def self.format_dimension(value_mm)
      "#{value_mm.round(1)}mm"
    end
    
    def self.get_dimensions(bounds)
      [bounds.width.to_mm, bounds.height.to_mm, bounds.depth.to_mm]
    end
    
    def self.is_sheet_good?(bounds, min_thickness = 3, max_thickness = 50, min_area = 10000)
      dimensions = get_dimensions(bounds).sort
      thickness = dimensions[0]
      width = dimensions[1]
      height = dimensions[2]
      
      return false if thickness < min_thickness || thickness > max_thickness
      return false if (width * height) < min_area
      
      true
    end
    
    def self.generate_part_id(name, index)
      clean_name = name.gsub(/[^a-zA-Z0-9]/, '_')
      "#{clean_name}_#{index}"
    end
    
    def self.safe_json(obj)
      begin
        obj.to_json
      rescue
        "{}"
      end
    end

    # Debug helper - controlled by environment variable AUTONESTCUT_DEBUG=1
    def self.debug(msg)
      if ENV['AUTONESTCUT_DEBUG'] == '1'
        begin
          puts "[AutoNestCut] #{msg}"
        rescue
          # best-effort
        end
      end
    end

    # Simple binary PNG signature check. Returns true when path exists and looks like a PNG file.
    def self.png_file?(path)
      return false unless path && File.exist?(path)
      return false unless File.size(path) > 8
      begin
        sig = File.binread(path, 8)
        return sig.start_with?("\x89PNG")
      rescue
        return false
      end
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\exporters\diagram_generator.rb

module AutoNestCut
  class DiagramGenerator
    def prepare_diagram_data(boards)
      boards.map(&:to_h)
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\exporters\report_generator.rb

require 'csv'

module AutoNestCut
  class ReportGenerator

    def generate_report_data(boards, settings = {})
      parts_placed_on_boards = []
      unique_part_types_summary = {}

      boards_summary = []
      unique_board_types = {}
      total_waste_area = 0
      overall_total_stock_area = 0

      global_part_instance_counter = 1

      boards.each_with_index do |board, board_idx|
        board_number = board_idx + 1
        board_info = {
          board_number: board_number,
          material: board.material,
          stock_size: "#{board.stock_width.round(1)}mm x #{board.stock_height.round(1)}mm",
          parts_count: board.parts_on_board.length,
          used_area: board.used_area.round(2),
          waste_area: board.waste_area.round(2),
          waste_percentage: board.calculate_waste_percentage,
          efficiency: board.efficiency_percentage
        }
        boards_summary << board_info

        # Track unique board types
        board_key = "#{board.material}_#{board.stock_width.round(1)}x#{board.stock_height.round(1)}"
        unique_board_types[board_key] ||= {
          material: board.material,
          dimensions: "#{board.stock_width.round(1)} x #{board.stock_height.round(1)}mm",
          count: 0,
          total_area: 0.0
        }
        unique_board_types[board_key][:count] += 1
        unique_board_types[board_key][:total_area] += board.total_area
        
        # Add pricing calculation
        stock_materials = settings['stock_materials'] || {}
        material_info = stock_materials[board.material]
        if material_info && material_info.is_a?(Hash)
          price = material_info['price'] || 0
          unique_board_types[board_key][:price_per_sheet] = price
          unique_board_types[board_key][:total_cost] = unique_board_types[board_key][:count] * price
        else
          unique_board_types[board_key][:price_per_sheet] = 0
          unique_board_types[board_key][:total_cost] = 0
        end

        total_waste_area += board.waste_area
        overall_total_stock_area += board.total_area

        board.parts_on_board.each do |part_instance|
          part_instance.instance_id = "P#{global_part_instance_counter}"
          global_part_instance_counter += 1

          parts_placed_on_boards << {
            part_unique_id: part_instance.instance_id,
            name: part_instance.name,
            width: part_instance.width.round(2),
            height: part_instance.height.round(2),
            thickness: part_instance.thickness.round(2),
            material: part_instance.material,
            area: part_instance.area.round(2),
            board_number: board_number,
            position_x: part_instance.x.round(2),
            position_y: part_instance.y.round(2),
            rotated: part_instance.rotated ? "Yes" : "No",
            grain_direction: part_instance.grain_direction || "Any"
          }

          unique_part_types_summary[part_instance.name] ||= {
            name: part_instance.name,
            width: part_instance.width.round(2),
            height: part_instance.height.round(2),
            thickness: part_instance.thickness.round(2),
            material: part_instance.material,
            grain_direction: part_instance.grain_direction || "Any",
            total_quantity: 0,
            total_area: 0.0
          }
          unique_part_types_summary[part_instance.name][:total_quantity] += 1
          unique_part_types_summary[part_instance.name][:total_area] += part_instance.area
        end
      end

      overall_waste_percentage = overall_total_stock_area > 0 ? (total_waste_area.to_f / overall_total_stock_area * 100).round(2) : 0
      
      # Calculate total project cost
      total_project_cost = unique_board_types.values.sum { |board| board[:total_cost] || 0 }

      {
        parts_placed: parts_placed_on_boards,
        unique_part_types: unique_part_types_summary.values.sort_by { |p| p[:name] },
        unique_board_types: unique_board_types.values.sort_by { |b| b[:material] },
        boards: boards_summary,
        summary: {
          total_parts_instances: parts_placed_on_boards.length,
          total_unique_part_types: unique_part_types_summary.keys.length,
          total_boards: boards.length,
          total_stock_area: overall_total_stock_area.round(2),
          total_used_area: (overall_total_stock_area - total_waste_area).round(2),
          total_waste_area: total_waste_area.round(2),
          overall_waste_percentage: overall_waste_percentage,
          overall_efficiency: (100.0 - overall_waste_percentage).round(2),
          total_project_cost: total_project_cost.round(2)
        }
      }
    end

    def export_csv(filename, report_data)
      CSV.open(filename, 'w') do |csv|
        csv << ["UNIQUE PART TYPES SUMMARY"]
        csv << ["Name", "Width(mm)", "Height(mm)", "Thickness(mm)", "Material", "Grain Direction", "Total Quantity", "Total Area(mmÂ²)"]
        (report_data[:unique_part_types] || []).each do |part_type|
          csv << [
            part_type[:name].to_s,
            (part_type[:width] || 0).to_f,
            (part_type[:height] || 0).to_f,
            (part_type[:thickness] || 0).to_f,
            part_type[:material].to_s,
            part_type[:grain_direction].to_s,
            (part_type[:total_quantity] || 0).to_i,
            (part_type[:total_area] || 0).to_f.round(2)
          ]
        end
        csv << []

        csv << ["PARTS PLACED (DETAILED LIST)"]
        csv << ["Unique ID", "Name", "Width(mm)", "Height(mm)", "Thickness(mm)", "Material", "Area(mmÂ²)", "Board#", "X Pos(mm)", "Y Pos(mm)", "Rotated", "Grain Direction"]
        (report_data[:parts_placed] || []).each do |part_instance|
          csv << [
            part_instance[:part_unique_id].to_s,
            part_instance[:name].to_s,
            (part_instance[:width] || 0).to_f,
            (part_instance[:height] || 0).to_f,
            (part_instance[:thickness] || 0).to_f,
            part_instance[:material].to_s,
            (part_instance[:area] || 0).to_f,
            (part_instance[:board_number] || 0).to_i,
            (part_instance[:position_x] || 0).to_f,
            (part_instance[:position_y] || 0).to_f,
            part_instance[:rotated].to_s,
            part_instance[:grain_direction].to_s
          ]
        end
        csv << []

        csv << ["BOARDS SUMMARY"]
        csv << ["Board#", "Material", "Stock Size", "Parts Count", "Used Area(mmÂ²)", "Waste Area(mmÂ²)", "Waste %", "Efficiency %"]
        (report_data[:boards] || []).each do |board|
          csv << [
            (board[:board_number] || 0).to_i,
            board[:material].to_s,
            board[:stock_size].to_s,
            (board[:parts_count] || 0).to_i,
            (board[:used_area] || 0).to_f,
            (board[:waste_area] || 0).to_f,
            (board[:waste_percentage] || 0).to_f,
            (board[:efficiency] || 0).to_f
          ]
        end
        csv << []

        summary = report_data[:summary] || {}
        csv << ["OVERALL SUMMARY"]
        csv << ["Total Parts Instances", (summary[:total_parts_instances] || 0).to_i]
        csv << ["Total Unique Part Types", (summary[:total_unique_part_types] || 0).to_i]
        csv << ["Total Boards", (summary[:total_boards] || 0).to_i]
        csv << ["Total Stock Area (mmÂ²)", (summary[:total_stock_area] || 0).to_f]
        csv << ["Total Used Area (mmÂ²)", (summary[:total_used_area] || 0).to_f]
        csv << ["Total Waste Area (mmÂ²)", (summary[:total_waste_area] || 0).to_f]
        csv << ["Overall Waste %", (summary[:overall_waste_percentage] || 0).to_f]
        csv << ["Overall Efficiency %", (summary[:overall_efficiency] || 0).to_f]
      end
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\models\board.rb

module AutoNestCut
  class Board
    attr_accessor :material, :stock_width, :stock_height, :parts_on_board
    
    def initialize(material, stock_width, stock_height)
      @material = material
      @stock_width = stock_width
      @stock_height = stock_height
      @parts_on_board = []
    end
    
    def add_part(part, x, y)
      part.x = x
      part.y = y
      @parts_on_board << part
    end
    
    def used_area
      @parts_on_board.sum(&:area)
    end
    
    def total_area
      @stock_width * @stock_height
    end
    
    def waste_area
      total_area - used_area
    end
    
    def calculate_waste_percentage
      return 0 if total_area == 0
      (waste_area.to_f / total_area * 100).round(2)
    end
    
    def efficiency_percentage
      100 - calculate_waste_percentage
    end
    
    def can_fit_part?(part, x, y, kerf_width = 0)
      part_right = x + part.width + kerf_width
      part_bottom = y + part.height + kerf_width
      
      return false if part_right > @stock_width || part_bottom > @stock_height
      
      # Check for overlaps with existing parts
      @parts_on_board.each do |existing_part|
        existing_right = existing_part.x + existing_part.width + kerf_width
        existing_bottom = existing_part.y + existing_part.height + kerf_width
        
        # Check if rectangles overlap
        if !(x >= existing_right || part_right <= existing_part.x ||
             y >= existing_bottom || part_bottom <= existing_part.y)
          return false
        end
      end
      
      true
    end
    
    def find_best_position(part, kerf_width = 0)
      return nil if part.width + kerf_width > @stock_width || part.height + kerf_width > @stock_height
      
      # Simple bottom-left placement
      (0..(@stock_height - part.height - kerf_width)).step(10) do |y|
        (0..(@stock_width - part.width - kerf_width)).step(10) do |x|
          return [x, y] if can_fit_part?(part, x, y, kerf_width)
        end
      end
      nil
    end
    
    def to_h
      {
        material: @material,
        stock_width: @stock_width,
        stock_height: @stock_height,
        parts_count: @parts_on_board.length,
        used_area: used_area,
        waste_area: waste_area,
        waste_percentage: calculate_waste_percentage,
        efficiency_percentage: efficiency_percentage,
        parts: @parts_on_board.map(&:to_h)
      }
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\models\part.rb

module AutoNestCut
  class Part
    attr_accessor :name, :width, :height, :thickness, :material, :grain_direction
    attr_reader :original_definition
    attr_accessor :x, :y, :rotated, :instance_id

    def initialize(component_definition, selected_entities = nil)
      @original_definition = component_definition
      @name = component_definition.name

      dimensions_mm = Util.get_dimensions(component_definition.bounds).sort
      @thickness = dimensions_mm[0]
      @width = dimensions_mm[1]
      @height = dimensions_mm[2]

      @material = Config.get_material_from_component_definition(component_definition, selected_entities)
      @grain_direction = Config.get_grain_direction_from_definition(component_definition)
      @texture_data = Config.get_material_texture_data(component_definition, selected_entities)

      @x = 0.0
      @y = 0.0
      @rotated = false
      @instance_id = nil
    end

    def create_placed_instance
      placed_part = Part.new(@original_definition)
      placed_part.instance_id = nil
      placed_part.x = 0.0
      placed_part.y = 0.0
      placed_part.rotated = false
      placed_part
    end

    def area
      @width * @height
    end

    def rotate!
      return false if @grain_direction && ['fixed', 'vertical', 'horizontal'].include?(@grain_direction.downcase)
      @width, @height = @height, @width
      @rotated = !@rotated
      true
    end

    def can_rotate?
      return false if @grain_direction && ['fixed', 'vertical', 'horizontal'].include?(@grain_direction.downcase)
      true
    end

    def fits_in?(board_width, board_height, kerf_width = 0)
      w_with_kerf = @width + kerf_width
      h_with_kerf = @height + kerf_width

      return true if w_with_kerf <= board_width && h_with_kerf <= board_height
      if can_rotate?
        return true if h_with_kerf <= board_width && w_with_kerf <= board_height
      end
      false
    end

    def to_h
      {
        name: @name,
        width: @width.round(2),
        height: @height.round(2),
        thickness: @thickness.round(2),
        material: @material,
        grain_direction: @grain_direction,
        area: area.round(2),
        x: @x.round(2),
        y: @y.round(2),
        rotated: @rotated,
        instance_id: @instance_id,
        texture_data: @texture_data
      }
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\processors\model_analyzer.rb

require 'set'

module AutoNestCut
  class ModelAnalyzer

    def extract_parts_from_selection(selection)
      definition_counts = {}
      @selected_entities = selection.to_a
      @original_components = []
      @hierarchy_tree = []
      @processed_entities = Set.new

      # Build hierarchy tree first
      selection.each do |entity|
        tree_node = build_simple_tree(entity, 0)
        if tree_node
          @hierarchy_tree << tree_node
          Util.debug("Added tree node: #{tree_node[:name]} (#{tree_node[:type]})")
        end
      end
      Util.debug("Total hierarchy nodes: #{@hierarchy_tree.length}")
      
      # AGGRESSIVE RECURSIVE SEARCH through ALL levels
      selection.each do |entity|
        deep_recursive_search(entity, definition_counts, Geom::Transformation.new)
      end

      part_types_by_material = {}

      # Process only sheet goods and batch create parts
      definition_counts.each do |definition, total_count_for_type|
        if Util.is_sheet_good?(definition.bounds)
          part_type = Part.new(definition, @selected_entities)
          material = part_type.material
          part_types_by_material[material] ||= []
          part_types_by_material[material] << { part_type: part_type, total_quantity: total_count_for_type }
        end
      end

      part_types_by_material
    end

    def get_original_components_data
      @original_components || []
    end
    
    def get_hierarchy_tree
      @hierarchy_tree || []
    end

    private

    # AGGRESSIVE DEEP RECURSIVE SEARCH - Goes through ALL nesting levels
    def deep_recursive_search(entity, definition_counts, transformation = Geom::Transformation.new)
      # Prevent infinite loops
      return if @processed_entities.include?(entity.entityID)
      @processed_entities.add(entity.entityID)
      
      if entity.is_a?(Sketchup::ComponentInstance)
        # Count instances
        definition_counts[entity.definition] ||= 0
        definition_counts[entity.definition] += 1
        
        # Collect original components (only for sheet goods)
        bounds = entity.definition.bounds
        if Util.is_sheet_good?(bounds)
          combined_transform = transformation * entity.transformation
          
          @original_components << {
            name: entity.definition.name,
            entity_id: entity.entityID,
            definition_id: entity.definition.entityID,
            width: (bounds.width * 25.4).round(2),
            height: (bounds.height * 25.4).round(2), 
            depth: (bounds.depth * 25.4).round(2),
            position: {
              x: (combined_transform.origin.x * 25.4).round(2),
              y: (combined_transform.origin.y * 25.4).round(2),
              z: (combined_transform.origin.z * 25.4).round(2)
            },
            rotation: {
              x: Math.atan2(combined_transform.yaxis.z, combined_transform.zaxis.z),
              y: Math.atan2(-combined_transform.xaxis.z, Math.sqrt(combined_transform.yaxis.z**2 + combined_transform.zaxis.z**2)),
              z: Math.atan2(combined_transform.xaxis.y, combined_transform.xaxis.x)
            },
            material: Config.get_material_from_definition(entity.definition, @selected_entities)
          }
        end
        
        # SEARCH INSIDE COMPONENT DEFINITION
        component_transform = transformation * entity.transformation
        entity.definition.entities.each { |child| deep_recursive_search(child, definition_counts, component_transform) }
        
      elsif entity.is_a?(Sketchup::Group)
        # SEARCH INSIDE GROUP
        group_transform = transformation * entity.transformation
        entity.entities.each { |child| deep_recursive_search(child, definition_counts, group_transform) }
        
      elsif entity.is_a?(Sketchup::Face) || entity.is_a?(Sketchup::Edge)
        # Skip geometry - we only want components
        return
      end
    end
    
    # Simple tree builder that always creates nodes
    def build_simple_tree(entity, level)
      if entity.is_a?(Sketchup::ComponentInstance)
        {
          type: 'component',
          name: entity.definition.name || 'Unnamed Component',
          level: level,
          material: Config.get_material_from_definition(entity.definition, @selected_entities),
          dimensions: get_component_dimensions(entity.definition),
          children: []
        }
      elsif entity.is_a?(Sketchup::Group)
        children = []
        entity.entities.each do |child|
          if child.is_a?(Sketchup::ComponentInstance) || child.is_a?(Sketchup::Group)
            child_node = build_simple_tree(child, level + 1)
            children << child_node if child_node
          end
        end
        
        {
          type: 'group',
          name: entity.name || "Group_#{entity.entityID}",
          level: level,
          material: 'Container',
          dimensions: '',
          children: children
        }
      end
    end
    
    def get_component_dimensions(definition)
      bounds = definition.bounds
      "#{(bounds.width * 25.4).round(1)}Ã—#{(bounds.height * 25.4).round(1)}Ã—#{(bounds.depth * 25.4).round(1)}mm"
    end
    
    # Build actual hierarchy tree structure
    def build_hierarchy_tree(entity, level)
      if entity.is_a?(Sketchup::ComponentInstance)
        children = []
        entity.definition.entities.each do |child|
          child_node = build_hierarchy_tree(child, level + 1)
          children << child_node if child_node
        end
        
        bounds = entity.definition.bounds
        if Util.is_sheet_good?(bounds)
          {
            type: 'component',
            name: entity.definition.name || 'Unnamed Component',
            level: level,
            material: Config.get_material_from_definition(entity.definition, @selected_entities),
            dimensions: "#{(bounds.width * 25.4).round(1)}Ã—#{(bounds.height * 25.4).round(1)}Ã—#{(bounds.depth * 25.4).round(1)}mm",
            children: children
          }
        elsif children.any?
          {
            type: 'component',
            name: entity.definition.name || 'Assembly',
            level: level,
            material: 'Assembly',
            dimensions: '',
            children: children
          }
        else
          nil
        end
      elsif entity.is_a?(Sketchup::Group)
        children = []
        entity.entities.each do |child|
          child_node = build_hierarchy_tree(child, level + 1)
          children << child_node if child_node
        end
        
        {
          type: 'group',
          name: entity.name || "Group_#{entity.entityID}",
          level: level,
          material: 'Container',
          dimensions: '',
          children: children
        }
      else
        nil
      end
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\processors\nester.rb

module AutoNestCut
  class Nester

    def optimize_boards(part_types_by_material_and_quantities, settings)
      boards = []
      stock_materials_config = settings['stock_materials']
      kerf_width = settings['kerf_width'].to_f || 3.0
      allow_rotation = settings['allow_rotation'] || true

      part_types_by_material_and_quantities.each do |material, types_and_quantities_for_material|
        stock_dims = stock_materials_config[material]
        if stock_dims.nil?
          # Auto-assign default sheet size for detected materials
          stock_width, stock_height = 2440.0, 1220.0
          Util.debug("Using default sheet size for material: #{material}")
          stock_materials_config[material] = { 'width' => stock_width, 'height' => stock_height, 'price' => 0 }
        elsif stock_dims.is_a?(Hash)
          stock_width = stock_dims['width'].to_f
          stock_height = stock_dims['height'].to_f
        elsif stock_dims.is_a?(Array) && stock_dims.length == 2
          stock_width, stock_height = stock_dims[0].to_f, stock_dims[1].to_f
        else
          stock_width, stock_height = 2440.0, 1220.0
        end

        all_individual_parts_to_place = []
        types_and_quantities_for_material.each do |entry|
          part_type = entry[:part_type]
          total_quantity = entry[:total_quantity]
          total_quantity.times do
            individual_part_instance = part_type.create_placed_instance
            all_individual_parts_to_place << individual_part_instance
          end
        end

        material_boards = nest_individual_parts(all_individual_parts_to_place, material, stock_width, stock_height, kerf_width, allow_rotation)
        boards.concat(material_boards)
      end
      boards
    end

    private

    def nest_individual_parts(individual_parts_to_place, material, stock_width, stock_height, kerf_width, allow_rotation)
      boards = []
      remaining_parts = individual_parts_to_place.dup

      remaining_parts.sort_by! { |part_instance| -part_instance.area }

      while !remaining_parts.empty?
        board = Board.new(material, stock_width, stock_height)
        parts_successfully_placed_on_this_board = []
        parts_that_could_not_fit_yet = []

        remaining_parts.each do |part_instance|
          if try_place_part_on_board(part_instance, board, kerf_width, allow_rotation)
            parts_successfully_placed_on_this_board << part_instance
          else
            parts_that_could_not_fit_yet << part_instance
          end
        end
        remaining_parts = parts_that_could_not_fit_yet

        if !parts_successfully_placed_on_this_board.empty?
          boards << board
        else
          UI.messagebox("Warning: Could not place #{remaining_parts.length} parts of material '#{material}' on a new board. They might be too large or the nesting algorithm failed.") if !remaining_parts.empty?
          break
        end
      end
      boards
    end

    def try_place_part_on_board(part_instance, board, kerf_width, allow_rotation)
      original_width = part_instance.width
      original_height = part_instance.height
      original_rotated_state = part_instance.rotated

      position = board.find_best_position(part_instance, kerf_width)
      if position
        board.add_part(part_instance, position[0], position[1])
        return true
      end

      if allow_rotation && part_instance.can_rotate?
        part_instance.rotate!
        position = board.find_best_position(part_instance, kerf_width)
        if position
          board.add_part(part_instance, position[0], position[1])
          return true
        else
          part_instance.rotate!
          part_instance.width = original_width
          part_instance.height = original_height
          part_instance.rotated = original_rotated_state
        end
      end
      false
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\resources\icon.png

‰PNG

   IHDR         ôxÔú   	pHYs     šœ   ´eXIfII*                V       ^   (              i‡    f       H      H            0210‘           0100     ÿÿ                      ‘_ñÚ    IDATxœìÝ	œÌõÿð×ÌììÎÞ;{#GR"¥ôS)G¤(…(’»C¥äf¥S9sD$)Ò…¢RJQäÊ¹kï{wfþÏ·ô§ìÎgfç»ó=^ÏÇc">ûÝÏ˜ù¼¿ŸãýˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆˆÈ7¨Ã
 @”J×'"sq8 4 ×:ùÙÈëÅà:Dg’ €eÐ	À‹ ¶(ú»³|ðÁzäxùï××ØvÊõ
 , äçõ:ÿýyì>Œÿ( °Às Úý}“t"êàþøàƒs<vHöñ³jÈß³gºÞ )>^oP%×ãƒÊ ‰ ¹ÀQüCðÁæ{¬ðá³ªÁßSý•]o¥×« Dÿ|ðñ'€[á'¦¢,ðªQ3Q ÜâÃRÀ] ì^Útóa) €PÉ¶Djªõwðº@„¯_âc{ñùÀÅ¾~#"¢ ²Ý{m›žÓzß¼Ý[ÃzŒ»êpV®×ëïpUÏçî¸åG‰ëµ‘¸QuAnC 7 ÈTã@,€ šù×?"¢Àù¦óE¸8ÁûA£;¾ø¯ïK÷Únsçæ¸$!:`×#
‚ï ´ýûä@À– ¬O3pð'¢ ‹AS§Üþ§+RÄ½Kåbí!h'w½+%®G$— xMöæ^6 x@‡ªõ‹ˆ(0F6>¡V¹	Ì>õ“Q'2¬òë59a6¹Ã>õSP/Ê!Õ–(Ä2À2eÞAç Ø€?ñDtý¤`n«ó 9þ+~Ê*ÀŸîÀ¡Âÿæý¹ëœÌ»Ü·ëíÈ.ÀõëÏ|="y.øû¸`…d~ä—èíëwERRìvo›o‰Èû÷ï—nŸâ°#2DäìÒŸH»ÄF(wßj9ýºFvi9fþzëd#·Ì…†1áU¾Þ¬_`ý‘,)*E¹[œÊ"
œR·Ç‹K•_ý Nô¯J PÀï¾œhÛ¶-†‚+¯¼R	ˆH=·ÝvÖ®]+Õ¶×ÙÉXr…Ø(LDzQârcÃ±Ìøå>:”åË—–ý³Bä
ð+ `’Ìwr8˜1cn¹EÏ%¢êðóÏ?£M›6p»ERºÊ‰)î-[ Y|Ð’‡Q¼¹?wõ
Ê]²_2Àý¥·ùÀé2É~l6–,Y‚.]ºÈvŠˆ 99ûöíÃŽb›NåÄ$â¾‚bô®ïk]"Ò‚â"”£¯âªä¢@ìßõ3Î¨²m¯"ËVS™ïpÏ=÷ cÇŽrÝ!¢€=z4ÂÂ*ßå~Ò'‡³ðéÑlÕûDDê¸¶¦÷5ª)Ûü" N€e6	ŠM~>(jQ0œuÖY0`€tûQ[÷ÊÞ=‘jR[ö¬­²y«—^µnÝ‰‰þVç$¢@Axl¬\‚š­'òñ3ÙéVB˜Ý—„Tçú ÄÉ\¹Q£F² "•8NÜÿýÒíÇnÛ§ì.&"}j+½™×¯%€p©+;ý;CKD5xð`Ô¬)·6¸7¿ów‹jÞD¤G	éÓù‘þ R‹/õ„ˆH-â(î¨Q£¤ÛOÙ~@IˆCDúc‘¯åg©j- "Òž={âüóÏ—j›^\†çwV˜#„ˆŽ ‘ˆœcÇŽ•nÿÜÎC8ZÄ|öDfÄ €È`:wîŒ+®¸Bª­È(&–ˆÈ| Ð„	¤÷çÌÿý(våªÞ'"Ò DtñÅ+32Ê=LúQ¾ª  "Ï„„Èzk6§çªÞ'"Ò DÕ AôêÕKª­HüØ¶}ª÷‰ˆ´ƒ ‘‰¼ ááR9½ðÅ±|x(Sõ>‘60  2°ÔÔT%C ¬Ç¶îƒËÃRADfÀ €ÈàD€øøx©¶;²°ìãª÷‰ˆ‚O:™0éSLLŒR-P6AÐ¸ö¡{½$„Ûx £°Ü¿Â›û3p  n?gP¢ì6\žƒ‡.8'DAk>=šé»)Õ$‹ü,$bµàì(z×OÆÀskÀ.WÒ¶Ú¤—aÚÎ?ñÁŸ™8R…Yña!h›‡‘Mj£~”ZÅ €È€ùóçcß>ïý–bö¯‡ñàgUKßôLÖþ¤ÌœTUVi9¤cÕþÌlÕ w7H…VˆdQâ¨¨'@ÿfßfä)Óûm#2D”¬¾Ù…è´î'@fLñZîÉ;Šå{ÓñÖÕ ]©âºÕŽ!>‘	„††âÑG•nÿÄO‘YR®jŸŒ ÿW¿dðÿw^†a›wc[f>´àƒC™˜ Áÿß›NþîhA™Ûƒ[7îÈàªürnû|—ôh‘.f >üðC¬\¹û÷ï‡‡”Hƒj×®®]»¢[·n°ZµWwïÞ³gÏÆöíÛ¥î`ÄTèãÕ«–¾éÑÏÙªšAÀó;aÉlÏþ¬^Á¨E»!í¢zH³«ö=d¼{ð~Ë-RåÚÙ¥åxù÷£Ý´6´FÓ@YY„wÞy'Ø]!ªÔ?ü€Õ«WcÙ²eXºt)""" 5"0û zôè!ÕþÅ]‡0ø¼¨¦zßôè›Œ<•¯¯ÄL[T|ž"ÐùþD>:Öt"˜¾5ÉkùoÚ¼UùÛÔ©S9ø“®lØ°#GŽ„VµoßmÚ´‘j[ìr#…‚*äVy2Ò¥ÉNÑÿ¶ûÉÓÂ±S·Ê}ÐÂsÔU ››‹9sæ»D>[±b…²\¥UãÇ—.´xÏ1esýWóøH]__†ø)¹Ð©êõ›ÇÿÄC3•ûp‘3øÏQWÀÖ­[QRRìnùÌívãë¯¿†V]tÑE¸ñÆ¥ï\Æ0Eð]œVI1ªŒ÷ž_Zpïù5U»ö-uQ3<ÁvsÕúá°Y1à¼Ð"Í EEêlÈ ªÅÅÅÐ21 NÈXýç	l<–£zŸôFÒb“ÞYß#1¾Y]´I‰…ô:;÷œø#‰ÄFà¥Ë@"ClX~U#DÛ{$1ÄbÁüÿ‡ºÝG£Ù  aÃàï~%ò×ùçŸ-«W¯úöí+Ýþ±­{~ÌD’—o®oŽ!kTy'»ÍbQ½}ÍwahÉìVçbQë†Êt}Us÷ÔŠÅ#ÏÂ—×5úîÿSµNŽÁ7/Âmõ’UÅÜa6«²±ñóNÍp{½$h•fOÔ¯_W^y%¾øâ‹`w…È'5BË–-¡u<ò^ýuäççKí’~÷À	ÜT'¡Zú¦')ŽPÌ¸´òç¾Å™rÄØmJ U}ê'+±s?¯Ìå×5Â¬VD„hö¾çÅ„cÙ•ï¹e.¿7ï9C5;´žFÓ½œ>}::vìˆãÇ™›œô“vWl^µÙ´‘Ý¬2‰‰‰6lžzê)©öc¶íÅµã•iM:³ªÞ9êxýõ2ÀUEL€—´H»¡€ºuëbýúõJrÙõJ¢`		Q‚UñóÚ´iSèÅðáÃ‘œœ,Õö×Ü"¼²û˜ê}"¢ê¡ù0®V­ZX°`²)ðÀÜHš¦dŒŠÒæQŸÊDFFâ¡‡’N,òÁ÷<;I3ùÛ‰ÈÀÀIáááÜH¤‚»îºóæÍÃž={¼¶Ò¦ÿr5Ñ^ZS"2Ð ©Ïn·côèÑÒíŸÞqÇ5ZÜ„ˆä1  "ÜtÓM¸ä’K¤ÚŠà" "}c @DJjà	&H·ŸõëaìÉÓv²#"ª "R´nÝmÛ¶•j[êö`òvíÖ; "ï Ñ?&Mš¤”–±|ïqlËôžDˆˆ´‰ ý£qãÆ¸õÖ[¥ÚŠ„w,D¤_ ˆè4âD€Èm ã“ÃYX{8Kõ>Qà1  ¢ÓÔ©Sýû÷—n?ä›Ý((÷/7< "ú|P©k c_~1Üò‡ê}"¢Àb @Dÿ‘€ûî»Oºý‚ÝGñìÏªÚ'"
, DtFC‡EÍš5¥ÛÚº£·îUµOD8 ˆèŒÆçÓ×<ýóŸ¸uãN¤3U0‘æ1  ¢
õèÑmÚ´ñékÞ9p®þ/ì:„"—[µ¾QÕ0  ¢JSO›6M™ð…˜xø»?PÕ·¸ïÛ=øìh¶RC€ˆ´C7å€‰(8ê×¯gžy÷Þ{¯Ï_+Q7@<¬ ^¤‰;¢í6UúJdûò«^‹ƒ yÕ»woüöÛo˜1c†ß×™ÿÈ/VD|\ ")¢Z`—.]‚Ý"
 D$E	Z¸p!úöíì®Q 0  "i6›Ï?ÿ<FŒì®Q1  "ŸOˆü +W®Djjj°»CD~b @D~i×®>ÿüsÜxãÁî
ù ù-11‹-Â_|Á@€Hg Q•5nÜX	Ö­[§”Å„ˆHÛ˜€ˆ¦E‹Êã‰'žÀÆñÕW_aÛ¶møá‡““ìîÑ) QÀÙív´oß^y™™™ÈÎÎFVV


‚ÝE"]{óÍ7±lÙ²*]ƒ UËÉ±,À¥¢Àøî»ïª|î ""2! DDD&Ä €ˆˆÈ„ ™ """b @DDdB ˆˆˆLˆ ‘	1  ""2! DDD&Ä €ˆˆÈ„ ™ """b @DDdB ˆˆˆL(:±cÇìÛ·.—+Ø]!Ò«ÕŠZµj¡yóæÊïÕtèÐ!åýX\\¬ê÷!Ò+§Ó‰–-["<<Z¦ù `ëÖ­¸ÿþûñóÏ?»+DšW§N<ûì³hß¾}À¯žžŽ#Fàƒ>øµ‰Œ&22?ü0î»ï>X,h‘Uëƒÿ7ÜÀÁŸHÒÐ³gO¼ÿþû½nvv6:wîÌÁŸHRAA&Mš„Ç{Z¥Ù Àãñ(wþœf$òX&{è¡‡” @yúé§±gÏž€]È,æÍ›‡o¿ýZ¤Ù `çÎ¼ó'ªÂtýúõëv½•+WìZDf³bÅ
h‘f€½{÷»Dº¶{÷î€\'//'NœÈµˆÌè?þ€i6 (++vˆt-Pï¡ÒÒÒ€\‡È¬J5úÒl @DDDêa @DDdB ˆˆˆLHó‰€¼©•‚–„»Dª)*vããÍEÐº0»×µŽv7ˆâÀÑrlý¥F¦û à²&aX8>)ØÝ RÍÓK²u DEXñÊD¾Iÿ¾Þ^Œ>ãÓat\ Ò°ô,f¬Èv7ˆLã•Õyèúà1dd¿îŒîg ˆŒ,m~6ò
ÜÁî‘á•»<33sW™'àf @¤Q¿ì+Ãkå»D†—™ëÆ]ãó­æJ=Ï €H£ÆÌÌD¹ñg!‰‚jç¥è9æ8ö)‡Ùp ‘­û¶ë·hã‘ž}°©×?ê×àoµ]¯Ò÷©Î iŒËŒŸ“ìnÚœ7s1zV&Ü~l±‰·bîèD$ÄZñÞç…Ð+Î iÌ«kò”iI"
¼âR?‘Q/ù7ø‹Ü3¼˜Š®Ô÷Ý¿À ")(rãÉW²ƒÝ"C:šáBïqÇñý.ÿü´j†WÓ’‘ä´Á iÈó¯åàè	îü#
´í¿ÿµÙïÐqÿ6ûÝyC4ž¹?¡vŒ‚ ‘FÉpaæJóœA&ª.o}Z€aOe ¸Äãó×†Ø€±w;ñ@¯X "˜4/EÅ¾@Ñ™y<ÀS‹³•‡ø½¯œ1"½u2Ú´pÀˆ iÀO»KñÆºü`wƒÈPûiî™’¡õóGƒÚv,ŸšŒskÛaT ˆ4`ôLùÉË_w6Dtfû—ãöÑÇ”lšþhi8ŒOBl”±ÊûÙé€¸Cùb›\
R›’|$Rõ>é¹’_‡aGüüßƒO¦~ðŒÿ‰4^€dòËòIîêFgwJ’(•üDM_…Ù-˜5*OÞ¯Úf`’§I¤MÞÍ“¾S‰Š°â‘;ãTï‘Þˆ@zÔŒL<0íÊÊ}_KM°aÍôTôê3á ¢ ÉÉwãéÅ9Òíº#)ñÆH@B(Y¹nÜY…J~M„bùãÉ8+Å|Ã¡ùž1‘F<ûjNäÈMUÖL
Áà›cTï‘žü~°½FW~õG·k"1ëÑD„;Œ“ÜÇ ˆ‚@T›·J>éÏ¤ANÓ~HÉÚoŠp÷ätäøžÐ_œ¤¹¿g,&ÜãT~oV ˆ‚`â¼,””É­U^xn(niËÿD¬äwƒŠùT ¢jöÝ®¼³¡@ºýS÷Æ+µÇ‰ÌNÍ÷?{¯ì_Ò,±”&Öû›ð¾é ¢j6vf¦t"Ÿ.WEàò™†”¨º+ù-IKF²A*ù ¢jôögØ¼CîÌbÁÄNÕûD¤‡J~½ÆÇŸÇXÉ/ U“Ò2ÒægK·pS4Î9‹IÈÜV‰J~OgøU(K$ô7À˜•ü Q5™»*’;®mÅÈ¾LúCæˆJ~‹&$áê‹ÃÕèž!0  ªÙyn<·L>éÏ#}ãÃdÞJ~ÏÀš/ý«ä'fÎD%¿óêp­2 ˆªÁ‹²•Œe2êÕÁÝ7E«Þ'"­Vòë9æ8ví-õëëÍRÉ/ ©lïár,Z'Ý~òàx¥0	‘Ùlþ©}Æ§ûUÌçd%¿Ç‡™§˜OU1  RÙ˜™™Ê@—6C&(!“Vòùb¦_Å|DÀüüC	¦+æSU ˆT´éÇb|°InS¤$MoêÔ¤dÎJ~Sdã…×ä÷Èœ*1Î†%“’ð¿fÌ—á+ D*;—ÇÎÊ’n/Òý^Ö$LÕ>i‰Øs×ÄãØX…J~¯=žŒÚ&¬äüW#RÉŠµùØö«\ÒG¨ãïaÒ2ÝËÐ³
•ünº:³GU­’Ÿ%4V{<îRxJöÃãö/Ë ^1  RAqÉ_Óš²ßƒ:©|;’9»’ŸøCSzÂâ¨÷ÏŸ‰Áß•µå™kÅÿÁø‰C¤‚—ÞÈ•N[*Ö0ìÍLedU­ä7ç±D¥F†¿,ö$„Ö¾ëé×°XÃ’Ð–8”fÀ €(ÀÄ¦_—ßÐ4ê®8ÄDòÜ¿’ßÓN`ùGþWòëýÍ«XÉÏž|ëÿSÙbÿWÞwpý£ã§Q€=¾0y’S›çÖ¶ãÎxt‰Œ_ÉïúûŽú=ø‹J~æÕ¨òà[¬çyo}	Ì€3 Dôëþ2,ý@>éOÚP§RõÈ¨~Ú]ªdöó·’_ßë£ñì©äg±'ˆÿJ´K„0  
pÒŸrÉ$fW4w ÓåLúCÆ¥µJ~‹M²aÌÀÏ’¨|¾µë¾-’jkµS†Æ«Þ'"=VòÕ0_™ÈJ~jc @ bGóØÙ™Òío¿6ªêë™DÄJ~úÁ €( –~˜‡í¿ËU/s„Y0¦œê}"ªn‡ŽÿUÉOö½ðoíZ†cáVò«. ˆpÇ3u¡|ÒŸûoE­d¾õÈXªZÉï®.mö±qSluá§Q½¸<GOÈ}è%;m¸÷¶ÕûDTÝ•ü™._õòß•üž{0½¯Sÿ8¬|ï<0 DUp$Ã…—ÞOú#v5GEpz“Œ¡ª•übmxur5Vò+—;¢ëqÉåÕ3 DU0y~
%85>'½ªá.‡H•üšœªlö«ÎJ~ž²xÊNü bî‚_`¼!òÓŽ=¥Xñ‰|f³´ÁNål3‘*ù];ìˆßƒ¿¨ä·vf ”ñõ <ã½J§øÝ%‡áÊýfÀ#"?•%]Ð¤ÃeáhÛ’gšIÿD®‹¶ƒøUÆWTï‰}ŽOªRßªpåÿˆ²ã« Ï3º‹¢ìð\ñ;˜— ˆüðÑW…Øð½\Òq×?y°Sõ>UG%¿1³2áòc|ŒpX0wtR•*ùŠ+ç¸w(9ÿ­öx<Epî†+»i6 
 ˆüØø4q^–tû¾7D£ÑÙLúCúöÐó'°à]ÿ6Ç‰©~±Þ/ÖýµÂS–…òÌµ03.ùhÑ{ùøe_™týrQî—HÏV¬Í÷{ð¿üB>›[CSƒ?ý… ‘òÝxf‰|ÒŸ{Ç"%^² 	‘FÍ|#×ïJ~ïNKAbßZÄ% "<ójŽKf:«‘hÃÐ[™ô‡ôM$÷'^|bû«ØÕà[øó¯e ˆ|Ès>w•üÐÄAÎ ít&
•üMHÂ5—ðÔ‹Öq	€HÒø9Y(.‘û8¼ðÜPtoÇ¤?¤"Uoãúrë÷¢‚ßúÙ58øë "	ßï*ÁªÏ
¤Û§‰‡•ï.2ˆa=¼Oå·¿4ëf×PÊù’>ð#ŠHÂ˜YYðHÎ…^EÚ´¨¦ÜæDÕàök£Ð¿kt…É}†ßƒO¦ &’CŠžp ‘ïn,PJÊ°‡X0i“þñˆŠ}W^äÀÜUyØöK	BB,hÕ$÷õŒeÀ«S ˆ¼ì€žü²ü±¿»oŒFƒÚœ%cêvM¤ò0
Kh
¬ö$xÜ¥ð”ì‡Ç]3a @T‰—ßÎÃž?å’þÄFY1²o¬ê}"¢ªü¡)=aqÔûçÏÄàïÊZÿwv@s¤f @Tì<7¦-•¿ûÙ'N©oNDÚe±'!´öý°XO¯I`±†!$¡3,!q(;þÌ€;6ˆ*ðäâldæÊU=©[#÷Ü|æMRD¤öä[ÿ3øŸÊû?XÃëÃ Á¾ÃåXäCîs±ñOœ—&"³EÁqž÷fÑ—À¸@tcgg¢¤Ln°åa¸±ÄÆ([$Bœí`‹j*>a W\ù?Á•¹waÕ;MD•²ØÄ%Ú%Â ýË·?—`Í—r²864^ùµÒvö„Ö‹ý”#‚VBœma‹jŽÒC/ÁS–YÅžQe,É=:s\ :…Hö3jF¦tÒq$Jœ…®œöÔ;OüOý[{<BSûJÝ™
 ¢S¬\W€­¿Èµ[0n€÷¤?bC‘ÕQ§Ò6â8’5üÿ$© ÑßŠK=H›Ÿ%Ý^”:=»¦÷©Boƒÿ?íÂ Qõa @ô·Y+sqðX¹T[gŒ#zI&ý±z["ø›M²Q 0  ‘íÂ¯åH·¬_œé•9¶:y1ua6rä’þœ[ÛŽ~]˜ô‡äËé¯çâ“Í…8žéBíÔÜtu$ßƒpGÕ6}N/Ç¯åâÓïŠ•ëF½š!èÞ>R©Ú'ö§TÅÞÃâÚ9Ø¸µEœS+½®‹Bïë¢acÜk Èô~;P†%kä“þLìTªþUæ×ýe¸é¡£8’áúçÏ2sKñão¥xk}Þ{>ñ~Î"}¿«Ý=vZ¦Ê9.åÏßÙPˆUÏ¤ ÂÏ cãÖbôsEÿíô,6ï(Áš/
ñjZr•ÒÆrdzcge¢üÿ?£+Õº™×µ®8(‘Pîò ïøã§þ§Ú±§÷>á×µ‹=¸cÜñ
ÓT‹ÒÕ½ä_N	DÜ9áôÁÿTo.Â‹äëc¶1  Sûb[1>Ù\$ÕÖj¦õ~ìèã¯‹”€ÊˆdS»ÊUš<ÕÊuù'-ý OÌ}µdM¾R«2óÞÎCq‰9ªå 2-·û¯”¿²ztˆÂEýØ©/[cÜe®ZäF&¦âe|'Ùîôk—zmãrÛ~õÞî?ýÙé½?bv`×>ß¯MÚÃ €Lëµò•õXŽ0Æöóëû¸‹ÿ”kWzÀ¯ë“öäÊÝ!Ën<=íÚLÏÿçÚù~\»PòÚœ0 dJb
ó‰Wä×2ïí‹³RüÛ3ë.ÚwIåA€»ø Ü…øu}""0  Szay—Kú“ä´á¾ÛcªðÝ<(;²×™óxÊ³Qvt‰ÒŽˆ¨ºð ™ÎÑq6[>éÏØ»ãYµXÙS–Ž’ÏÂî¼Ö¨¦°„ÄÁSžwþv”e~¸ò«t}Ò–ˆp¹crQá¾ÿ\Éï‹ŒðãÚ’ý‰”|~¤m ÈtÒd)G©d4¬kGïë¢óËóP–þ dhM„Jµkvn¨*×å©›IöáT6Å‡›*/…f· Q=»Ï×&íá ™Š8ýúÇòwÛS‡Ç#ÄÆ»òÍõWDxÝ3rEsŸãû }[‡(¯i¨ol‰ÔD›Ï×î{}”×…wtŽB¤3¤=|ÉTÆÍÎRŽHÉ¸ª…íZ†«Ý%2 G¨¯LLBLKGuRC0wt¢_×Ž‹¶bÁ¸¤
êóëÙñÜƒ	~]»Vrf=šXa¦ËK…)™0É iˆ,fŸ}'—ôGä;rx¼ê}"ãƒåÆ—k¢G‡Èö$;mJéój*ƒ­¿Ú¶Ç§³k ëUÿì	¨™¢T¨\;³†ß)†…n×Dâã—RÑ±U¸È¢Î€(€õþ©¼û7î SwýæÈ'ý¹£s4.¨ïûô,Ñ©Î®‚yc’”ß—”y”õó@itv(–LNVåÚ-ÎÃŠ'ST¹6iC92…WVçá—}riWÅŽ¸Û!
$5ï’˜[    IDATQ½^›‚‹ žÈnöôbù¤?ôŠAj‚ï¨ˆˆô„ Þ´¥98–)W¥F¢ÃºÇªÞ'"¢`c @†v8½sVåJ·ŸpÓï:êDDzÂ €mÂÜ,I&ý	VDÅ?""3à) 2¬í¿—â­O¤Û§qÂªfHl‹Dˆ³lQM[4àÊƒ+ÿ'¸2×Áã®<ûQ 1  ÃztF&Ü’I®k«/V/éÅž€ÐZÃa±Ÿ’DÅê@ˆ³-lQÍQzè%xÊä)U— ÈV^ˆ¯·Kµ±ýµö¯ì©wž>øŸú·öx„¦öUÚU d8eåLœ—%Ý¾×%}ªZ¬áõauÔ©´ÅQÖðzªõˆèß áÌ'{þ”KúaÅÃ}Õ=öçmðÿ§] "ª> ÈP²óÜxf‰|ÒŸGúÆ*ùÙUe“kg“lGD ÜH†òô’ldæÊíüÙÞ£zŸÈV}Z€×>ÊÇî?ËaE›‹Þ#–Y%I³ aì;\ŽïäI·Ÿ8ÐùOµ3¢ª¤šøx>ØtúQÎŸv—béùxãÉ\Ú˜³;¤=\ Ã?'S©\&[ªU”=%ªjÐÙ~è‘ÿþ§.Iõw\ù•Hk !|ûs	V!ŸLgÊP',¼ù§*øò‡b´|Øk•IQ‡bÙ‡ùÕÖ/"Y H÷<`ÜìLåW7]‰VMjw‹lá{yèöð1éý&›wÈå¤ ªNÜ@º'Òý~³£Dªm¨Ý‚ñ÷Ä©Þ'2nŽ‰Q32±àÝ<¿Nµ.ù éZi™/Oú3ðæhÔ¯¥^Ò2.q·ç„ãøb›ïwó6U¥ODUÁ €tmÖÊ\ì=,w{mÅC½y÷O¾ëü=G“þY;•#Ì‚Þ×±Ê$i÷ ned»ðÜ²éö£îŠƒ3†?òä›¾.D‡aGüüEuÉçG$ nÞk‘öð§’tëÉW²‘[ ·	ëìš!èß5Zõ>‘±Ìy3£gÉW•<U„Ã‚¹£“Ðåª5ºFTe H—~?X†ÅïË­š24^Ù H$Cä“x`Ú	,ÿÈ¿ã{5“BðÚãÉh~×þI» .›•¥ìÈ–ñ¿f\ïÂHÎÑ.Ü1ö8¾Û%w²äßZ5	Ã’´dõkLU Òe±.+C$û™2Ä©zŸÈDúÞžcŽãÏcþÛë{}4ž}€³M¤ HWÄZìØY™Òí{´B‹ó™‡¼{û³}*EÅ’¥Na³ã8ñ@/uKK Ò•×?ÉÇ¿•Jµ…~Æà±?ªœÈ ùÔâlå!›MòTÑ‘V¼<6.ç2é Òâ_˜-Ý~XÔNá8U¬ ÈAS3ð¾u$NuÎYv,ŸšŒóê0¹é?I7^|=‡ŽË­Í&9mx '§c©bâg©×ØãøQrFéßÚµÇÂ	Iˆbn	Ò' ¤Ç³\˜±"Wºýè~qÊÔ,Ñ™lÞQ¢”éMÏrùõõwuùk³_ˆ›ýH¿ .¤ÍÏB~¡\6–†uíès=S¯Ò™-~?#_ÌTêHø*ÌnÁs&0µ/ ÒEv_²ˆ¤?¼3£+wy0eA6^xM>}ô©bmX29	­›±”4 Ò¼Ñ33Q.9S{U:\®v—Hg²rÝ¸kâqlÜê{%?¡É9¡Êf?n*%#áO3iÚÚoŠðé–"éÂ+iƒãUïéËîƒeè5æ8~;Pæ××ßØ&sKD¸ƒ³Jd, H³\n`üœ,éöb]¶s¯Ó)Ö}[„»'§#'ß÷j>"‹äý=c1~€S	.‰Œ† iÖ’÷ó°k¯Ü­Èp+ÆôgÊ_:½’ß˜Y™J éO%¿9£“Ð••üÈÀ f´ˆr¿²î»=©	,¾BUò1í^c%?¢J1  MznYŽeÊíüKM´áÞÛ˜ô‡þªä'Î÷oÙé_%¿Ëš„áUVò#“` @šs$Ã…YoÊ'ýk´bÊ–Ì­ª•üDîˆi$°’™ Òœ‰s³¤+²‰ãY·_Ë¤,fÇJ~D¾c @š²ý÷R¬\/¿v›6„;´ÍLTï{qy&½œÅJ~D>b @š2nv&Ü’»¶Å‡ö5—0éY¢’ŸØì'RG™ ÒŒ5_JgjÓ¶ñØŸYN/WÖûý­ä×¶e8±’™ ÒLžöÉ/Ë'ýé×5ç×ã›Y+ùõw\©éVò#ú Ò„ùïäá×ýr©Z£"¬xäÎ8ÕûDÚ³dM~ÁÿJ~ÓF$àŽÎÜ4J$0   iZŸY"_¡íá;byNÛdD6?Qš•üˆ‡ Ý3¯fãDŽK:KÛ ›cTïi«’_¿IéØð½\Q¨k|N(^g%?¢ÿà;‚‚jÿ‘r¼¼*Oºý¤ANVe3‘=–¡çèªUò›ýX"E 
ªY+s•Üí2Zœ†[ÛEªÞ'Ò†õ[ŠÐ+ù©… •/Óºu*ìd|¯¬›ýN Üþ¬äG$‡ UnÜÝ]—«"pù…ÜÀetU­äW#Ñ†åSSü®äg±†ÃÙ–Ð$ñ?~]ƒ´ËÂtÏ§b @Aun»Rü§2¢8‹Xû'cAûŒOÇW?Ê%ƒ:S%¿%““‘ïß	[T3„¤Ü‹•3dq)¨zuò~&ûžnÑ¨_‹IŒlÇžR\=ðˆßƒ‘x÷¹T¿kÄy°§ÞÉÁŸL… Õm¢Ð¹uÅºžŠ±ýy÷odïl(@‡aGpÐ2¾JJèNÌ“G¨ÿDB’ºqÊŸL‡?ñTbSß+“0²OœR™íÔ¬mwÞ÷_Hå±?ƒÕûDbŸþ“Óý*ã+~^–=ž\å2¾{¬¡5ªt"=â 
:±Æ?æî8<tG,vüQŠòr×=-  c),ö`ÐÔt¬þÜ¿J~bIhùÔ Uò³150ý›u&ô† i†#Ì‚K…»T•üz9ŽªPÉoáø$ÄE(@,÷/½0—§,fÀ[,"ªÖJ~b³Ÿ¿ƒ¿¨ä÷Æ“ÉüÅ‡}y6<Å{v=Ò?Wþ0 DTm•üºŽ8êW_±LôÒ#‰xá¡UÊø–¥¯‚Çã_ºa2WÞpì‚0  "Õ+ùMœ—…ûž9áW_QÉïígST-ãë.>ˆÒC³á)ËPí{ÆyÜpålBÙ±WaÜ@DªÉ+pãž)øèëB¿+ù-<uRÕÿ¨òý’ýSauÔ‡%¬,ÿ²	’ÞxàvåÀS¸GY2 D¤
]Vòó¸á.Úˆ‘Á1  ¢€c%?"íc @Dš©ä'²ùM™¨¤ö%"u1  ¢€(wy0ôÉ¿+ù•¢¬÷7mÀµw¢êÀ	6"
1Ýïïàiã0¬Ÿ]ƒƒ?Q5b @DAÕ½}$Þ«B%?"ò— ˆ((D%¿qœU.æCDþa @DÕ.*ÂŠùcÑé—‚&"u1  ¢jÐJ~Dä7 DT­Óþm.v`ùÇþm$ÒZeK=c @DÕZ`Ñ{yÁîñ ‘91  ""2! DDD&Ä €ˆ*Â­BDF|1  ¢JÅÄÄ ...ØÝ Ò­:uê@‹ Q¥,ºuëìnéÖ7Þ-b @D^5
5kÖv7ˆt§K—.hß¾=´ˆ y•””„5kÖàÒK/vWˆtÁf³¡ÿþ˜7o´J›;ˆHsêÖ­‹?ü?üð¶oßŽììì`w‰Hs¬V+RRRÐºukÔªUZÆ À rÜø~W	JJ=8¿^(êÕÜK™ëÆÖ_JPîò é9¡¨•¸kËtáÇßJ•ß7oŠd'KÄjm?ÀE]¤<ˆHß LY¹ió³1÷­\””yþùók.	Çô‘	¨âÿK^TìÁ˜Y™X²&å®¿þÌb:·ŽÀ% ©
ƒuN¾#_<7×ÀíþëÏ¬V {»(<ó@<b"¹ZEDHüT5è?9Ó_Ï9mð>û®×;‚£Ü~=;†…ïýÿàò{®ù²×ÝwTÄý,º>xo¬ýÿÁ_¿_±6]GEqÉéÏ‡ˆˆª†€¬þ¢«?/¬ðïd¸0an–_×~õƒ||±­¸Â¿ß}°O-öoMø¥•9ÿLûŸÉ¿•bæÊ\¿®MDDgÆ À@ÞXë½Äê»Ÿ ¸Ô÷»iqwîÍÊuÞÛœñë¤®Íò±DDÄ À@öö^›ZL¥‹™ _í;\æµMz–ynUúýÇ!}×Ý&"Ò R^.wg_ú¯ý2Ê$ÇßÒr®íQ¥ÏDDT1 DDD&Ä À@Ä‘<âxj×–mèãµýé3UŒ«’g“lýI®#sÆßjAl”ï?R2ýaB "¢Àb ` í.÷Úæ’Fa~Òí.uxmsõ%á~Ý©·•è·Ìs#""y dÀÑ¨“Zq¦?›˜0Ðé×µï½-¶ÒY q÷?önÿjÆì‹¨ˆŠ£#­Ù‡õè‰ˆ‰€ˆrÕ3)8¯Žý?á°`î˜$\ÑÜûü™¤ÄÛðæS)gL%mÅ’ÉÉhrN¨_×®_ËŽ7žH>ã4¿ø¾+ŸLh-""b- ÃiPÛŽ/ÔÄ»ñÕöb•xÐ¸¾=:D)ƒiU4;/[–ÔRòõoÙY¢ßÖ£}œ1U‹%ÿ×Ìï—ÖÂÊõJ¡!áâóÃÐ½}d¥³DDä j·(§xš#Ì‚;:G)5f0úwVDD¤.ÞZ™ """â ù,33¹¹¬Ð¨†ÐÐP$%%Ánÿïf^5ðµ,«ÕŠääd8þm¸®N ˆHJyy9^zé%,X° ‡
vwM;wÆ¸qãP·nÝ€_Ÿ¯¥ºDÐ²eKŒ=W^y%´ŠK D$5`ÜqÇ˜<y2ŒjP\\ŒU«V¡]»vØ¹sg@¯Í×R}n·ß|óºuë†eË–A« ‘WsæÌÁ'Ÿ|ìn˜Ž˜ž0` \.ßKxW„¯eõ?ü0öíÛ-b @D^-Z´(Ø]0­_~ù_~ùeÀ®Ç×²z•””`É’%Ð" DT©¢¢"ìÝ»7ØÝ0µíÛ·ä:|-õýú "ªTaaa°»`zzøZGQQ´ˆ ‘	1  ""2! DDD&ÄD@D6+P;•)ÞNw¡´Ì-ãk	dåº‘“ï†‘™û&Ò¡¸h¹‰;§Ó‰êmÃ¯U­ßSoöüY†Vwv7¼2ûk¹îÛ"HK‡Ñ1  Ò™ÖÍärŒ·nÝZõ¾o_˜²rmßý›™Ç¼¸<ió³à2öÍ¿‚{ ˆt¦iƒPtnQi›.]º qãÆÕÖ'òîç=¥xgCA°»A((rã®‰é˜8Ïƒ¿À €H‡fJD«&agü»V­ZaúôéÕÞ'ªœXÜ&Xôfïártvïn4W€Æ% "îxÿÅT¬\[€Õ_âp¶µê5Çõ×_îÝ»Ãf³»‹tŠÍ?cí7ÚLcv¿ì+ÃEFvàê-è "
±YÐ³S”òð¤R¤Mió³ƒÝª`Í@Zº_ƒ¿Å\{Y8>Þ¬ßÀŽ ‘Š>úª›~,v7è¾Þ^Œ{J}þºÈp+f?–ˆ¤8«® î "R‰Xó;ÿI›vüáûà_¿–ëf¥¢ëU•oÄÕ DD*Y¹>?íö}¡ê[FóEûKÃñéœhtv(Œ€K DD*çýŸ\Ä»-kUÁIš3­÷ßß3ã8•,‰Fa §BD¤‹ßÏWŽ—‘v]P?.¯|*?ÂaÁÂñI˜8ÐXƒ¿`°§CD|Å%L[Ê»=˜9*ž{æ)ý³k†`íÌèvM$ŒˆK DD6ëÍ\É0ß¹r=Jˆµaí¬XønÞÝP€£™.$ÅÙÐùŠ¾9áßö	è	 "¢ äf¬È	v7Èav†Ü£<Ì„K D:—çÆï{Ó‘Í)g-xáµ¥”,‘Ö1 0¨­¿”àîÉéhÜãOœ×í nì8ÖoÑoÂ
ú/q¼¬ëƒGQÿÆ¸´óshÐ ºuë†;v»k¦uô„sWå¼²#‘ Ð¢÷òÐaè¼õi/Çñ,>úº·Œ<†ñs²‚Ý=
€¯~,F‡aGðùÖâ
Ì¸ÝnlÜ¸;vÄæÍ›ƒÝESzfI6
‹åÊý¶kŽ+/b @ÁÃ À`¶ýZ‚‘/ž¨°œåô×s°êSsU¼2š’2NÍPvšŸIQQŒ’’’jï›™í?RŽW?È—>W>ºœê}"ª ƒ¶5#å^6‹ €ôë³-EøóXåçË8€6T[Ÿ˜² ¥erwÿ7]‰‹É%¡!R µ¬¿Ùáý®oûîR—Ê}P‘6Ë—Êøõ×_Uïýeç¥Ê’›‘LfÔ]¼û§àc ` iá‰ó²¤g
Àñ_·arç’®/W—É/gÿ³Ã›Þ×E£a]»Ú]"òŠ€A¼¼*û$ÓŽžWÇ.=ˆöÈîoÝºµê}!`óŽe“­G¨Þ«zŸˆd0dæºñ¬iGûuVµ?¤®¦BÑ¹u>ØTñ Ó¥K4nÜ¸ZûeVSæËŸ¬Ð-µ’ÿ±›[àÆŒ×sñÞçJFÄÄ8®kŽ½b•ßË³•¯œÅïça×¾2%€ºüB‡rfçùV‘ï»]%JŽ†ow” ´Ü£Ôèß5·¶3fš_ÆÿI4§^ÉV’ÁÈ¨W3„€Ì•ˆÛ;¦Ü}þ[«V­0}úô ôËl>Ù\„/(–jnÅý·ÿîÿh†7Œ8ŠÝËNf¾Q¦œ@zïùTœ[ÛûˆXR¹gJúi{+Äöåw6`Í—…˜ùh"zt¼_]“¦eœv:ê«‹•Çgßá¥G•“fÃ% ÕÆ­Î“n?yp¼’ö’ô-.ÚŠ÷_LÅìQ‰Êl@óÆµpýõ×cÖ¬YX½z5bc?Ð›¸;;ÿeÝw{’œòw¿z5pjúiƒÿ©ÄlÀÒ+<¦|ª™+s*ÜX)J-ßûtF…ßçT?ï)ÅˆçNüOµìÃ|,|Oþ3ÔH8 scffJ=º´qº\YyéKÒ›=;E)OÊ åAÕgÕgØþ{©tÁ™aÝŸg^ü{ˆäTÞNL|º¥.¯4¸š¹2×ëÆçy«òðôýñ•¶›ýV®×£Ñ/­ÈÁÝ7šof”3 :¶éÇâJ×O%¦·Ò†Ä›rš‹(ÐÊ]eéMÖÈ>±ˆŠ0þÇí÷»JÒîpz¹²” “òÜ{›R©™ÔLÖo0þO¤A‰yì,ùéÇ[ÚFâ²&L<BbMù·rùj§„ ŸIî.Šäf#ó‹*ló%¯“Wè}Ð.ðò½NÊ+` @:±bm¾’öWF¨Ý‚1w;Uï‘ˆ$ZÏ¼*ŸMó±~qÜwCšÄ @‡Dø)ä§‡vÁÙ5¹Ýƒ(æ¾•«LQË»ÝewªU7 :ôÒ¹^sÁŸ$ÎÜ>Ø›;Â‰Ag{q¹üÝÿ„Ne³¦YD†Ë=×¨ðÊ‡ž(ÙëHì«ˆpÈsÑ‘æÍ÷Œu.=Ë…}(æ#rŽÇ˜ð›H¢–ìf±‹†áú+ÌuêF69Oó†•·«‘‚”xïG&/òr™ïurŸF|Œù>'Í÷Œuîñ…ÙÒ›UÄôã7D©Þ'"3ÈÈvaÎ[òçÅ'ršîÔM‹óÃÐÊËfc‘Š¼]ËŠ 
V+0ðæÊMÚC,p“÷£•ƒnŽQ
0y[&5# :òëþ2,ý@þ(m¨Sy“QÕ=½8ù»Î…«/G›æ,Æôò¸$åŽúLD"¤W&&I}.Ýß3×µ>óŠÐ§ˆÇùõ¼gl~^(¦W‚Š3¹¹m¤$˜ 7;ÓkB‹“®¼ÈN—›kúÑ¬ròÝØ½/99òKCä›GË•|ô²ÆÜmÞr¿bðßørM¹5æŸºb:ÿ®.ÑøüåšJ~bïÄÒ´d<sŸŠ›XÏ·(	„ÖL¯¾×Ë­ü»ÓRqÍ%áwX” äÂsCñâÃ	X0.©ÂàÀè¸5\'D¾j‘w\†øa~|håÙ±Hÿvì)UrA|¾­n÷4X­Ïãª«®BZZØÔ…ÙJæ9]¯Š@ËÌsC¬§?1<^yT…¸Ó¿§[´ò¨*qS$ôÿL÷è‹Èa=v¶|ÒŸÛ®R¢[2®¯·£Ã°#Øð½üÿú3·Û6 cÇŽøæ›o‚ÝEÃøe_V®Ë—°F÷gÎÒ :ðÚ‡ùJAbzkœ‰§Í@Ü‰|<EÅg¾#-,,ÄàÁƒQZ*÷3C•›ür–TñáöŽQRëÒDZÀ @ãDËÇÊßýßÛ#5“¸²cdŸm)ÂA/y öïß¯ÌPÕˆœõ~U(qó‘¾¾I? hÜŒ¹8zBnç_j‚MÙ9KÆŸ’–±k×.Õûbt“^ÎRênÈÕäêÖ`ðMúÁ @ÃDíl‘xDÖ˜þNDzÉ°EÆÈE/Õ®¸ò²¬T¹õ[Š¼–¶=I¼ïF0ã&éG›<?…¬óþ›XwìÙ‰9Ç‰AÜõ‹ÿ²î½-ÉNï™ëˆ´„€†x­øDnç±0uX¼©rŽ©éÝÒµíbmfÒLr¤o 4Jœï>y¼Ë‘£­—ÔšD$Gìøb‘üÝ¿(¶eÆB2¤Ü±¢A}U¨œï–=w<y0ÏÊ²ó”´Û2j$Ú”ÍfÍŽ8ó\lú±XÙ—Ò¸~(úuRÒ “>0 ÐàÝÇÄyòÇþúÞFg3éQ ˆì©ÅòoG÷sÂf¾¥·7×àþgO(Ç”OÚ}°LY:Ö#S†Ä›®’qÞJc½—'}ÌKì<å~‰(0æ¿‡CÇ+Ï±pRƒÚæÛx+nPÆÍÎÂ€´ôÓÿS‰YeÊï_¢àa  !¢ÒØÓ‹}[{”©™MDÞ‰íEŽÝŽgª·Y¹nÜúÈ1ÌXáýßè¹e,L¥ 4äÙ¥98žå’^{z+wÊô×s‘.ùþ%f»^ež»‘ŠüšÁ‡•¢d2þ8T†c™’¥K)h hÄáôrÌ]•+Ý~â §’÷ŸˆªîDŽ3WÊ¿ÿÆßã4Í÷;
”ÂSûË-œT*Y=‘‚‡› 5büœ¬
‹»ü›¨ô×½]”ê}"2‹iKs”%8W4w˜âØ­XïŸ2?/,Ï‘N‡|j9àZ¬I¢y|…4@$yëÓéöiCâaåÜQ@—xðêò›Ö&4þ±ÛÒrnuë¾•›òÿ·»ºDó3JøiÀØÙòG®¿"mZ8Ôî‘iˆ3ÿyrwÿ[G åa0:ñïáïàßªI«"ê€ {ïóB|½]®àˆ=Ä‚IƒŒ÷ATdg·Å­ØùO»¹m$V=›jÊÜzÄ%€ ›d&ùôGdg‰(pÖ±#ÂañZx«G‡(&Ýª$#é¸NÜß3Ö4›#€3 A4ÿ<ìùS.éOl”#û²Ü(Q ‰Ó4wÞí5éÖ˜þ¼û?gŒ+ŸJÁ½8øë€ ÉÎsãÙWå“þŒì§T#¢À?À‰ÿ5sT¸ô6û±DÔNá„é¿]P?ŸÍ©iŠSFÄŸè yjq62så6Õ­‚{n6gÁ¢êšxwZ
æ¼õWÛß”)wýbÃí£wÆ¡iNýŸIfŽ7=|f®¡g ‚@$ÔXønžt{±ñ/ÌÎ¹5"5‰;ý{o‹U$çè	fûÓ3.Á¸9™(‘Ì’%ŽÝØÆ<)G‰ˆ¨z0 ¨fßþ\‚÷¿(”j+6Ô¤eYM""
< ÕH$û7;S:éO·k"•¤DDDÆ  ½¹¾ ßì(‘jj·(çj‰ˆ%<œ»õƒÁáÐföV Õ¸[tòËòIßƒ³kr&NDDêÕ«ìn˜N£F E ªÉì7sqðX¹tb½¸™ˆ¯_¿~Áî‚©Øl6ôéÓZÄ  dd»ðü²éöõ‹S‚ "¢@2dÚ¶mìn˜‚ÅbÁäÉ“Ñ°aChG™jðÄ¢läJV;·¶ýº0é©#$$Ë—/Ç¨Q£””ìîÖ\€¥K—*—Vq‘Ye"£Ø’5òµÆ'v*	IˆˆÔb·ÛñÈ#à¡‡Â±cÇPZZì.JTT¡u T6nV&ÊÊåÎýµnæÀu­#TïÑÉõéš5k»$\PÑÛŠññæ"éZãS†òØUÎ ¨Äíþ+é,Qkü¢†LúCtèx9–~˜í¿—*Ëa"ö£”’Ø¾(.ñàõOò±éÇbäzp~=;zuŠÂyuì>÷ií7EJÏc™.¤&ØpÃ•h)ÏÔ“¾1 PÉòóñÃorëjŽ0Æ²Ö8‘’,køÓÊà}Ò;
ðÂò¼š–,ó×ýe¸ý±cØ{øÿÞ~ôðÒŠLá·ÅH]§¨ØƒþiéøpÓéé»_Y‡Î«l$Ã  ÌIDAT­#°p|’òþ%Ò#.¨@|xM]”-ÝþÞ±8‹µÆÉäD–ÌÁSÓOüOJÏr)úátï¹4
ŠÜèþèéƒÿIå.`ììL%¨1âùÿüOú`S!|þ„Ôuˆ´ˆ€
ÄÝŠ˜Æ”‘ä´á¾ÛåîFˆŒ~\VÐÉÎscúë¹^¯³øý|8Zùû/m~¶Ô	žŸä{éÛ}°Ìëµˆ´ˆ@€ÍpaúëòIÆÞ‡èH¾dnå.²VïÍ†ï½oªÝ(ÑfÏŸe^3snü¾Øká.ñ÷·zï7‘qä	°)³PX,wì¯a];z_¥zŸˆ´.·À#u\6#Û{B­9rI·Ä²Bå×qä:DZÅ  €~ÞSŠåÉ'ý™:<!6n "òHÖÈ–i&Ym[º,7‘Q1  qs²à’»ùÀU-h×’Çˆˆˆ(8 È'›‹ðé¹¤?6+ðäðxÕûD¤av¹™°P‰#ü²©´ÃB+ojÌuˆ´Š@ ˆ»þ	s³¤ÛßÑ9ÔUµODzaEJ¼Ík»s%’ø4¨íýH­ÜëÕ¨¼]ƒÚvé^DzÄ   ¿Ÿ‡]{å’þD†[•r¿Dtºž¼oˆíÕ10mº\¡•™þ’•%"háRé€*Ê/tã©Wä“þ<Ð+FI%JD§Ù'MÎ©xfLdÞ)³½ù_3v«8·FÍ¤<>Ìû\„Ã‚é#RÁÛUüùôGîà é€*znYŽ’\FD†uU½ODz$fÇÖ¼˜ªäë?u_ÄÝ‹Å“’”¢Y2žº/S‡ÅÃóÿ_ ¾Vëg×Â;ý/o?›ªÔ8U£³CñÎ´TtlÅ»Ò/æŸ­‘–tö[Þ3“4á§òaFDg&
þÌ•¨Þ¿ì+…ÍfAÓsB}Î·o± C»ÇàžnÑØ±§TÉéß ŽÝë”þ™\y‘›_©¥dü;’áRyÙýDZÆ  
&ÎËR>Xd4m*5}ID@\´­š:ª|1“¨*›bÐçÀOFÂ% ?‰R¥¢r™¬´!NééK"""µqHòÓ¨—2á–Lús]ë\}1×
‰ˆH; øáý/
ñ•Dá’“;…ÅÚ?‘–0 ð‘(X"ÖþeõïóŸÄDDDÁÆ ÀGÞÉ“®ÿ-<Ü—ÇþˆˆH{ ø 'ß§—È'ýy¤o¬_ÇŽˆˆˆÔÆ ÀbðÏÌ•ÛùW'5o®8Q01 ´ÿH9æ¿'Ý~â@'¬FDDÅ @Òø9Y()“KúsI£0t»&Rõ>ù‹€„-;KðÞçòI¦u*©H‰ˆˆ´Š©€½ðx€q³2•_eÜtud@R˜ÑéDÚíõ[Š”S8	±6´»Ô¡Tö#"ÿðÝãÅªÏ
°yG‰TÛP»ãï‰S½ODfóîÆŒ˜vâ´M¸6+0è–LìDˆSnD¾b P‰Ò2¦Ì—Oú3ðæhÔ¯Å¤?DôÑ×…è7)ý?©·]n`ÖÊ\yðâÃ	Áê‘nq@%f¿™‹½‡Ë¥«—=Ô›wÿDT\âÁƒÏU^wcñûyØö«Ü,ý? 8‘ãÂ´¥9ÒíGÝgÿ9‰éåwrq8Ý{¾úóÂjé‘‘pÄªÀ“¯d#·@.éÏÙ5CÐ¿k´ê}"2ñþ{~™\~8Ã¥zˆŒ†Àü~°¯¬Î—n?eh¼²ˆç¥¹Ò™7k$0å6‘¯ œÁ¸ÙYJÕ?—5	CçÖª÷‰ÈLŽg¹0se®tûÎWð=Hä+ ÿòåÅøè+¹õD‘ìç‰áñLúC`Ó^ÍAA‘ÜÝëf´¼ Lõ>€SˆÆcgeJ·ïÑ>
-ÎçQ <VŽWVûPwcSÕþ€S¬ø$?üV*ÕVú;€Çþˆíñ…ÙÒu7º\Á»"?1 8å¼ñã‹²¥ÛëƒÚ)Ì£DH¿(Ã›ëä6àŠL€cúóîŸÈ_ þ6}Eþ<&—ô'ÉiÃ=cUï‘ÙLœ›…rÉ}·wŒÂùõ˜y“È_¼…žåÂŒò;ŽG÷‹Ct$c'¢@ÚúK	>”Ü€+ŽÝ>Ò—Kpzáv»±nÝ:lÚ´	¹¹òŸµzƒ+®¸íÛ·‡E»Ã  H›Ÿ<É¤?ëÚÑçú(ÕûDd6çeIWÝìc4êÖàÇ—=z}úôÁ÷ß3˜1cZ¶l‰Å‹#55ZfúÛØ_ö•áµò|JúÃÊcDõé–"|¾µXªmd¸öæœ”––¢{÷î¦üOÚ²en»í6åùk™é€133¥×¯já@‡ËÂÕî‘©ˆ»þ©å7àïƒd'3ÿéÁòåËñóÏ?ÃŒ~úé'¬X±Zfê `Ý·EX¿¥Hª­Õ
¤ŽW½ODfóîÆ|·K®š_|ŒU	 HÖ®]3[«ñçoÚ @Ô?'Kº}ïë¢Ðì¼PUûDdÆ÷á>¿}°77àêIf¦|b5#:qâ´Ì´ï¤W×äaç¥ÒkŽ<oLx¯}˜_÷—IµMM´aÀM¬º©'µk×†™Õ©SZfÊ @äå~eÝw{RYmŒ( ŠK=xjI¶OÇoaÜ€«'7ß|3Ìì–[n–™2 xþµ=á’¾ë¸÷6î8&
´ïäI'ßjPÛŽ^xüVo:vìˆo¼fÔ­[7%€–™. 8’á[™Ññœˆpð®ƒ(Ð³p/,Ï‘n?öî8¿Õ©¹sçbèÐ¡°ÛÍ‘µ144Ã‡Çœ9s u¦Ë¤1i^ŠŠå²49'·_Ë»¢@™7ENÙ÷a×«"Uï©7 N™2#FŒÀ·ß~‹ãÇÃ¨’““qÙe—!>^'ÆL ü´»oHÒ†8•ãD8'r|›…›<˜ïC#HHHÀu×]ìnÐ)Lõ¶;+n¹Œ¿èty®¹„IˆíÙWs¤So_~¡m[ò}H¤Ó l*ÄFÉT£¢ÌèÄA<öG¤ÆœE«åSoOÈ÷!‘ZL ”»<˜ü²|ÒŸ~]£Yf”HSd¡¸DnNçÖ¸¬I˜ê}"2+S ÞÍSŠþÈˆŠ°â‘;Yf”(Ðv,ÃŠOäöàˆ5ÿÑýù>$R“á€œ|7ž^,Üèá;bYh„HbN¶ðVQÊî"RÕŽÄ®c5“B0èf!
´m¿–`õ…Rmí!Œâ,‘ê ì?RŽy«|;nÎ¤?D7i^¶RöWF¿.Ñ¨WÓT'”‰‚ÂÐÀÄyY()“ûÔ¹¸QniËd#DöÕÅØð½\Ùm‘uó¡>L½MT ˆúâïl(n?eˆÞü©ˆËÚ=)ñÜƒCT Œ™)=åØõª%áÖû_âÛŸK¤ÚÆFY1¼ïþ‰ª‹!€·?+Àær:¡v&0ÙQÀ¹Üû—õ`ïXÄEò#‰H“·Ó¦´Ìƒ´ùò5ÆÜsÎbÒ¢@gþeóo¤&Ø0°OàÕÎ;ñüóÏcÓ¦MHOO‡Ë%yTGl6’’’pÅW(…5j­3\¸=wU.þ8$÷¡#î6îÃãFDjâO/‘Ä½3Ž'pjõêÕh×®Þzë-=zÔƒ¿ ž—x~o¾ù&Ú¶m‹5kÖ@ë5çÆsËr|úÐ‰ñ=²XÃaqÔQ~%òÆš
³Yø^ö.—j[·Fz_Ç²ÛFtðàA<%%rK²FQRR‚Aƒá›o¾A­Zµ U†
 žX”¬\¹*câœqÿ£}ü6„$uAHÜ•Êï‰è¿
ŠÜxn©| >þ§²‡ŒgáÂ…(*’;j4………Êó7n´Ê0ÀÞÃå>UK0Ÿ>t,°×ì[d¿úGd3Wæâx–Ü4ïõCÑíjæß0ªmÛ¶ÁÌ¶nÝ
-3Ì€133•uG—6ÃWFøt}[ôEü‰$–áf­Ìõ©Ü¯(üCÆä‘=‹MAaˆ·Þ¦‹ñÁ&¹<ã"ÙOÚxŸ“þX£/ö¯sD&2miŽÈhÕÔk[q‘5kÖfÖ¼ysh™î ·;Kþ¬ñ­í"ýª1n	Iðùkˆ|¢ó»¥‚b7^~Ç—»žÀ1º~ýú!,Ì÷Ï[#Ã]wÝ-Ó} ðé–"¥Ò˜G¨ãø™ôÇmÎ,T}<.ùÁS‹ŠK<ÊCF§Ë#” 2¶³Ï>Ó§OGHˆa¶›I±Ûíxé¥—P·n]h™î€Ü¹éFaÈ­1¨“êß¢»p—__G$Åã†»ð7˜Xós7ïþÍ¢{÷îøè£Ð©S'DEû¸gTT”ò<Åó½å–[ u¦	ËãlÑÛÿ<ã®ìÏa‹½–¦¦Àsål‚§ìÌ@TÝlÚ 4ØÝ jÔ¢E¼öÚkÁîm@ÖcýâéÿÓõ¸‹Qzh<eéí‘+÷”¥¿3°‡X”÷"Ÿ)f Î«cGßë«>õä)=†’}OÂÓ6Ç9€Í·£„Dÿð¸á)Ï†+ÿGxŠ÷Ã,Äû°~-ÖÞ ÒS iCã•;ÀpÁû½ò "yŽ0ºƒå~‰´ÂðK W^ä@Gž5&
º!·Ä f’)î9ˆtÁjôÝÆ"éWl”÷ÝÎ»"-1t Ð³cšŸÇÝÆDÁvÏX8ý¨¼IDê±y½q4w]j‚ƒo‰	v7ˆÈ,À=cQ+™ëDÁöpŸ8D8Xî—Hk $;mÞƒwDÁ&2oâ.ž!€ñ÷8aÈ§F¤+"åo¨wÿDZd¸Q²ñ9¡èÙ‰wDÁÖèìPtoÇ÷"‘Vn‘¼õ…¬þ¼ ØÝ RÍ/ûÊ ­š†á=¾ñZB~~>¾ÿþ{dggÃ¨âââpÉ%— 22z`¸ `ÞÛ¹˜÷v°{AD‹ÞËSdn.—O=õ”R·¸¸Fçp8pß}÷aäÈ‘°ÙlÐ2Ã DD¤Ã‡ÇŠ+`ÅÅÅxúé§ñçŸ*A–n iÃ§Ÿ~jªÁÿT¢üñÆ¡e ˆˆHo¾ù&ÌlåÊ•Ð2Í V‘ÈŸˆüf±æøß‹Æy-«Ûþýæ)u}&{÷î…–iö””ì.éZJJJ@®ƒ°°°€\‹‚ûZV·ØXs€r:Ð2Í _|±æÿñˆ´Jì>nÓ¦MÀ®Õ¶mÛ€\‹‚ûZV7³ÿÜ´Õøó×l  î8ÆŽìnéR¿~ýP¯^½€]oôèÑÊñ&ª~ýû÷èkYúôéƒsÏ=fÔ°aCôîÝZ¦Ù àä‡˜øà		áiE"Y½zõÂ”)SzÍÆcÙ²eˆèu©rb IKKƒ^‰9±®I“&0“¦M›â7ÞÐüÒ™æGÖ‡~ÝºuSv“Š%%%Áî‘æˆ ù¬³ÎB—.]Ð¢EU¾Ç5×\ƒï¾ûîÿÚ»Ÿ—ØÊ8ŽãŸñwd‘6.B0BZL’·î"jQ!\¸M
™\)­Ê¸ÿ@þÀ×åA/(
A‚¥à&RÓB„‘Â2-5ƒ›uý1c<ÃÀ½Ømæ9Ç3Ü3ž÷¾¸ð9ßópFù~çœçœ#ó¿¸¶¶¦“žò—­Ï²²²2ùYšK¡¹®ªª*y;àÜÜœ–––ttt¤›*«±±Qmmm¾PN4 FuuµúûûŸö4€À3:F£O{ÈÁ¦¦½½=ð__   ÙA  @ Ñ   @4      D  @ Ñ   @4      D  @ Ñ   @é€K›——VÃ  €GÔÞK7À?6™m'  <pxxh;ôo7€UeßÜÜ´  ðÀÖÖ–íÐc7@Ì&óòòò~¿3  ~ûöoj¯¥m7Àº¤D¦Ìggg±  ¸†ááaŸŸÛM¤jù…2l¼&éV¦=äççkbbBMMM6  .ÌÏÏ«££CñxÜføw’Þp{à”ÍÌD:;;533c3  8455¥®®.ÛâoÜO÷ËLg ^N­(°Ý[kk«zzzÔÐÐ ¢¢"ÛÍ  À§§§Z\\ÔØØ˜äÀ…¤W%ýä¶0>“ô¾*,,TEEM€¤²²2ÕÖÖ&£H$â*G,Óøø¸VWW•H$’ù¢Ñ¨jjj\åÛÞÞNæ[YYa' ø´øèâÂÔrÇ>—ô^º6À+’~ôŒ›à‘‚‚&/—8199©¾¾¾äÃÕµêîîv|©··÷?ù  7ÂCI¯Iúñº€ñ±¤oæl¦hÏÎÎª®®ÎjüúúºZZZþwÅg^^ž¦§§U__o•occCÍÍÍ¶+H ¹çŽ¤O½zÀ ¤/®?'˜Åæ[£££i‹µ¹044äY> @NûÒö»í ãyI_IzÓý¼`”––jggÇj¬¹Æ¿··—vLII‰vww
…<É ÈIßKj”ô§×€–4'é-wsƒ
…Î÷÷÷#ÅÅÅßæP^^þm"‘x!Ã°x,‹„Ãá¸Gù  ¹eEÒ;’~·ÝÀi`<+én¦Õ…HkUÒmË±_KzÛ¢ë{ÝÃ| €Ü1!éIœld»àq'©Û;$q.ÙÓ@Ù÷8Ÿ“±  ÿúM’¹­ì]§Åß¥’>’ôKêÃDæ¸ï°ñ2giî¥Ég¿˜ïa>‚ B¾Ž_%}"é9ù€)hÍæ’¾‘ô—ßÂœ-éwX¬?¾JúùJ¾;NžÒx¥	0ùv|p\‚ ¥©ÚjÞ¼×â²Ž<±dƒÉûbêÎH§©‚ñíŠÇõ¥ÔO/ó•\3  ;ÌŠþ?²”                                         È‰Êh½ëÎÄÜH    IEND®B`‚

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\dialog_manager.rb

module AutoNestCut
  class UIDialogManager
    
    def show_config_dialog(parts_by_material, original_components = [], hierarchy_tree = [])
      @parts_by_material = parts_by_material
      @original_components = original_components
      @hierarchy_tree = hierarchy_tree
      settings = Config.load_settings
      
      # Use HtmlDialog for SU2017+ or WebDialog for older versions
      if defined?(UI::HtmlDialog)
        @dialog = UI::HtmlDialog.new(
          dialog_title: "AutoNestCut",
          preferences_key: "AutoNestCut_Main",
          scrollable: true,
          resizable: true,
          width: 1200,
          height: 750
        )
      else
        @dialog = UI::WebDialog.new(
          "AutoNestCut",
          true,
          "AutoNestCut_Main",
          1200,
          750,
          100,
          100,
          true
        )
      end
      
      html_file = File.join(__dir__, 'html', 'main.html')
      @dialog.set_file(html_file)
      
      # Send initial data to dialog
      @dialog.add_action_callback("ready") do |action_context|
        # Auto-load detected materials into settings
        settings['stock_materials'] ||= {}
        parts_by_material.keys.each do |material|
          unless settings['stock_materials'][material]
            settings['stock_materials'][material] = { 'width' => 2440, 'height' => 1220, 'price' => 0 }
          end
        end
        
        data = {
          settings: settings,
          parts_by_material: serialize_parts_by_material(parts_by_material),
          original_components: original_components,
          model_materials: get_model_materials,
          hierarchy_tree: @hierarchy_tree
        }
        @dialog.execute_script("receiveInitialData(#{data.to_json})")
      end
      
      # Handle settings save and process
      @dialog.add_action_callback("process") do |action_context, settings_json|
        begin
          new_settings = JSON.parse(settings_json)
          Config.save_settings(new_settings)
          
          nester = Nester.new
          boards = nester.optimize_boards(@parts_by_material, new_settings)
          
          if boards.empty?
            @dialog.execute_script("showError('No boards could be generated.')")
            return
          end
          
          report_generator = ReportGenerator.new
          report_data = report_generator.generate_report_data(boards, new_settings)
          
          data = {
            diagrams: boards.map(&:to_h),
            report: report_data,
            boards: boards.map(&:to_h),
            original_components: @original_components,
            hierarchy_tree: @hierarchy_tree
          }
          @dialog.execute_script("showReportTab(#{data.to_json})")
        rescue => e
          @dialog.execute_script("showError('Error processing: #{e.message}')")
        end
      end
      
      @dialog.add_action_callback("export_csv") do |action_context, report_data_json|
        begin
          if report_data_json && !report_data_json.empty?
            report_data = JSON.parse(report_data_json, symbolize_names: true)
            export_csv_report(report_data)
          else
            UI.messagebox("Error exporting CSV: No report data available")
          end
        rescue => e
          UI.messagebox("Error exporting CSV: #{e.message}")
        end
      end
      
      @dialog.add_action_callback("export_html") do |action_context|
        # HTML export is handled entirely in JavaScript
        # This callback exists for potential future server-side HTML generation
      end
      
      @dialog.add_action_callback("back_to_config") do |action_context|
        @dialog.execute_script("showConfigTab()")
      end
      
      @dialog.add_action_callback("load_default_materials") do |action_context|
        defaults = MaterialsDatabase.get_default_materials
        MaterialsDatabase.save_database(defaults)
        @dialog.execute_script("location.reload()")
      end
      
      @dialog.add_action_callback("import_materials_csv") do |action_context|
        file_path = UI.openpanel("Select Materials CSV File", "", "CSV Files|*.csv||")
        if file_path
          imported = MaterialsDatabase.import_csv(file_path)
          unless imported.empty?
            existing = MaterialsDatabase.load_database
            merged = existing.merge(imported)
            MaterialsDatabase.save_database(merged)
            @dialog.execute_script("location.reload()")
            UI.messagebox("Imported #{imported.keys.length} materials successfully!")
          else
            UI.messagebox("No valid materials found in CSV file.")
          end
        end
      end
      
      @dialog.add_action_callback("export_materials_database") do |action_context|
        desktop_path = Compatibility.desktop_path
        filename = "AutoNestCut_Materials_Database_#{Time.now.strftime('%Y%m%d')}.csv"
        file_path = File.join(desktop_path, filename)
        
        materials = MaterialsDatabase.load_database
        MaterialsDatabase.save_database(materials)
        
        # Copy to desktop
        require 'fileutils'
        FileUtils.cp(MaterialsDatabase.database_file, file_path)
        UI.messagebox("Materials database exported to Desktop: #{filename}")
      end
      
      @dialog.add_action_callback("highlight_material") do |action_context, material_name|
        highlight_components_by_material(material_name)
      end
      
      @dialog.add_action_callback("clear_highlight") do |action_context|
        clear_component_highlight
      end
      
      @dialog.show
    end
    
    private
    
    def serialize_parts_by_material(parts_by_material)
      result = {}
      parts_by_material.each do |material, parts|
        result[material] = parts.map do |part_entry|
          if part_entry.is_a?(Hash) && part_entry[:part_type]
            part_type = part_entry[:part_type]
            {
              name: part_type.name,
              width: part_type.width,
              height: part_type.height,
              thickness: part_type.thickness,
              total_quantity: part_entry[:total_quantity] || 1
            }
          else
            {
              name: part_entry.name,
              width: part_entry.width,
              height: part_entry.height,
              thickness: part_entry.thickness,
              total_quantity: 1
            }
          end
        end
      end
      result
    end
    
    def get_model_materials
      materials = []
      Sketchup.active_model.materials.each do |material|
        materials << {
          name: material.display_name || material.name,
          color: material.color ? material.color.to_a[0..2] : [200, 200, 200]
        }
      end
      materials
    end
    
    def highlight_components_by_material(material_name)
      model = Sketchup.active_model
      selection = model.selection
      
      # Clear current selection
      selection.clear
      
      # Find components with matching material
      matching_components = []
      
      if @original_components && !@original_components.empty?
        @original_components.each do |comp_data|
          if comp_data[:material] == material_name
            # Find component by entity ID in all entities
            found_entity = find_entity_by_id(model, comp_data[:entity_id])
            if found_entity
              matching_components << found_entity
            end
          end
        end
      end
      
      # Add matching components to selection for highlighting
      matching_components.each { |comp| selection.add(comp) }
      
      # Zoom to selection if components found
      if matching_components.any?
        model.active_view.zoom_extents
        UI.messagebox("Highlighted #{matching_components.length} components with material: #{material_name}")
      else
        UI.messagebox("No components found with material: #{material_name}")
      end
    end
    
    def find_entity_by_id(model, entity_id)
      # Search in main model entities
      model.entities.each do |entity|
        return entity if entity.entityID == entity_id
        
        # Search in groups recursively
        if entity.is_a?(Sketchup::Group)
          found = find_entity_in_group(entity, entity_id)
          return found if found
        end
      end
      nil
    end
    
    def find_entity_in_group(group, entity_id)
      group.entities.each do |entity|
        return entity if entity.entityID == entity_id
        
        if entity.is_a?(Sketchup::Group)
          found = find_entity_in_group(entity, entity_id)
          return found if found
        end
      end
      nil
    end
    
    def clear_component_highlight
      Sketchup.active_model.selection.clear
    end
    
    def export_csv_report(report_data)
      model_name = Sketchup.active_model.title.empty? ? "Untitled" : Sketchup.active_model.title.gsub(/[^\w]/, '_')
      
      # Auto-generate filename with incrementing number
      base_name = "Cutting_List_#{model_name}"
      counter = 1
      
      # Cross-platform desktop path
      desktop_path = if RUBY_PLATFORM =~ /mswin|mingw|windows/
                       File.join(ENV['USERPROFILE'] || ENV['HOME'], 'Desktop')
                     else
                       File.join(ENV['HOME'], 'Desktop')
                     end
      
      loop do
        filename = "#{base_name}_#{counter}.csv"
        full_path = File.join(desktop_path, filename)
        
        unless File.exist?(full_path)
          begin
            ReportGenerator.new.export_csv(full_path, report_data)
            UI.messagebox("Cut list exported to Desktop: #{filename}")
            return
          rescue => e
            UI.messagebox("Error exporting CSV: #{e.message}")
            return
          end
        end
        
        counter += 1
      end
    end
  end
end

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\app.js

let currentSettings = {};
let partsData = {};
let modelMaterials = [];
let showOnlyUsed = false;

function receiveInitialData(data) {
    currentSettings = data.settings;
    partsData = data.parts_by_material;
    window.hierarchyTree = data.hierarchy_tree || [];
    // Debug logging removed for production
    
    populateSettings();
    displayPartsPreview();
}

function addMaterial() {
    const container = document.getElementById('materials_list');
    const materialName = `New_Material_${Date.now()}`;
    
    currentSettings.stock_materials = currentSettings.stock_materials || {};
    currentSettings.stock_materials[materialName] = {
        width: 2440,
        height: 1220,
        price: 0
    };
    
    displayMaterials();
}

function removeMaterial(material) {
    delete currentSettings.stock_materials[material];
    displayMaterials();
}

function updateMaterialName(input, oldName) {
    const newName = input.value;
    if (newName !== oldName) {
        currentSettings.stock_materials[newName] = currentSettings.stock_materials[oldName];
        delete currentSettings.stock_materials[oldName];
    }
}

function updateMaterialWidth(input, material) {
    if (!currentSettings.stock_materials[material]) {
        currentSettings.stock_materials[material] = { width: 2440, height: 1220, price: 0 };
    }
    const data = currentSettings.stock_materials[material];
    if (Array.isArray(data)) {
        currentSettings.stock_materials[material] = { width: parseFloat(input.value), height: data[1], price: 0 };
    } else {
        currentSettings.stock_materials[material].width = parseFloat(input.value);
    }
}

function updateMaterialHeight(input, material) {
    if (!currentSettings.stock_materials[material]) {
        currentSettings.stock_materials[material] = { width: 2440, height: 1220, price: 0 };
    }
    const data = currentSettings.stock_materials[material];
    if (Array.isArray(data)) {
        currentSettings.stock_materials[material] = { width: data[0], height: parseFloat(input.value), price: 0 };
    } else {
        currentSettings.stock_materials[material].height = parseFloat(input.value);
    }
}

function updateMaterialPrice(input, material) {
    if (!currentSettings.stock_materials[material]) {
        currentSettings.stock_materials[material] = { width: 2440, height: 1220, price: 0 };
    }
    const data = currentSettings.stock_materials[material];
    if (Array.isArray(data)) {
        currentSettings.stock_materials[material] = { width: data[0], height: data[1], price: parseFloat(input.value) };
    } else {
        currentSettings.stock_materials[material].price = parseFloat(input.value);
    }
}

function populateSettings() {
    document.getElementById('kerf_width').value = currentSettings.kerf_width || 3.0;
    document.getElementById('allow_rotation').checked = currentSettings.allow_rotation !== false;
    
    // Initialize stock_materials if it doesn't exist
    if (!currentSettings.stock_materials) {
        currentSettings.stock_materials = {};
    }
    
    // Auto-load materials from detected parts
    const detectedMaterials = new Set();
    Object.keys(partsData).forEach(material => {
        detectedMaterials.add(material);
    });
    
    // Add detected materials to stock_materials if not already present
    detectedMaterials.forEach(material => {
        if (!currentSettings.stock_materials[material]) {
            currentSettings.stock_materials[material] = { width: 2440, height: 1220, price: 0 };
        }
    });
    
    displayMaterials();
}

function displayMaterials() {
    const container = document.getElementById('materials_list');
    container.innerHTML = '';
    
    currentSettings.stock_materials = currentSettings.stock_materials || {};
    const materials = currentSettings.stock_materials;
    
    const usedMaterials = new Set();
    Object.keys(partsData).forEach(material => {
        usedMaterials.add(material);
    });
    
    // Get sort option
    const sortBy = document.getElementById('sortBy')?.value || 'alphabetical';
    
    // Create material entries with usage info
    let materialEntries = Object.keys(materials).map(material => {
        const data = materials[material];
        const isUsed = usedMaterials.has(material);
        const usageCount = isUsed ? (partsData[material]?.length || 0) : 0;
        
        return {
            name: material,
            data: data,
            isUsed: isUsed,
            usageCount: usageCount
        };
    });
    
    // Sort materials
    if (sortBy === 'alphabetical') {
        materialEntries.sort((a, b) => a.name.localeCompare(b.name));
    } else if (sortBy === 'usage') {
        materialEntries.sort((a, b) => b.isUsed - a.isUsed || a.name.localeCompare(b.name));
    } else if (sortBy === 'mostUsed') {
        materialEntries.sort((a, b) => b.usageCount - a.usageCount || a.name.localeCompare(b.name));
    }
    
    // Filter if showing only used
    if (showOnlyUsed) {
        materialEntries = materialEntries.filter(entry => entry.isUsed);
    }
    
    materialEntries.forEach(entry => {
        const { name: material, data, isUsed } = entry;
        let width, height, price;
        
        if (Array.isArray(data)) {
            width = data[0] || 2440;
            height = data[1] || 1220;
            price = 0;
        } else {
            width = data.width || 2440;
            height = data.height || 1220;
            price = data.price || 0;
        }
        
        const div = document.createElement('div');
        div.className = `material-item ${isUsed ? 'material-used' : 'material-unused'}`;
        // structured layout: name + dims + price + actions
        div.innerHTML = `
            <input type="text" value="${material}" onchange="updateMaterialName(this, '${material}')" placeholder="Material Name">
            <input type="number" value="${width}" onchange="updateMaterialWidth(this, '${material}')" placeholder="Width (mm)">
            <input type="number" value="${height}" onchange="updateMaterialHeight(this, '${material}')" placeholder="Height (mm)">
            <input type="number" value="${price}" step="0.01" onchange="updateMaterialPrice(this, '${material}')" placeholder="Price per sheet">
            <div class="material-actions">
                <button class="icon-btn" title="Remove material" onclick="removeMaterial('${material}')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
                        <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <button class="icon-btn" title="Highlight material" onclick="highlightMaterial('${material}')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="12" r="3" fill="currentColor"/>
                    </svg>
                </button>
            </div>
            <div class="material-status">${isUsed ? '<span class="used-indicator">âœ“ Used</span>' : '<span class="unused-indicator">Not Used</span>'}</div>
        `;
        container.appendChild(div);
    });
    
    // Add gradient effect if folded
    if (showOnlyUsed && Object.keys(materials).length > materialEntries.length) {
        container.classList.add('folded');
    } else {
        container.classList.remove('folded');
    }
}



function displayPartsPreview() {
    const container = document.getElementById('parts_preview');
    // Render a structured parts preview: material cards with a compact table of parts
    container.innerHTML = '';
    const header = document.createElement('h3');
    header.textContent = 'Parts Found';
    container.appendChild(header);

    Object.keys(partsData).forEach(material => {
        const parts = partsData[material] || [];
        const card = document.createElement('div');
        card.className = 'parts-card';
        const title = document.createElement('div');
        title.className = 'parts-card-title';
        title.textContent = `${material} (${parts.length} parts)`;
        card.appendChild(title);

        if (parts.length === 0) {
            const empty = document.createElement('div');
            empty.className = 'parts-empty';
            empty.textContent = 'No parts for this material.';
            card.appendChild(empty);
        } else {
            const table = document.createElement('table');
            table.className = 'parts-preview-table';
            table.innerHTML = `<thead><tr><th>Name</th><th>W (mm)</th><th>H (mm)</th><th>Thick (mm)</th><th>Qty</th></tr></thead>`;
            const tbody = document.createElement('tbody');
            parts.forEach(part => {
                const name = part.name || 'Unnamed Part';
                const width = part.width || 0;
                const height = part.height || 0;
                const thickness = part.thickness || 0;
                const quantity = part.total_quantity || part.quantity || 1;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${escapeHtml(name)}</td>
                    <td>${width > 0 ? width.toFixed(1) : '-'}</td>
                    <td>${height > 0 ? height.toFixed(1) : '-'}</td>
                    <td>${thickness > 0 ? thickness.toFixed(1) : '-'}</td>
                    <td>${quantity}</td>
                `;
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            card.appendChild(table);
        }

        container.appendChild(card);
    });
}

// Small HTML escape used by parts preview
function escapeHtml(str) {
    return String(str).replace(/[&<>\"']/g, function (c) {
        return {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":"&#39;"}[c];
    });
}

function processNesting() {
    // Update settings from form
    currentSettings.kerf_width = parseFloat(document.getElementById('kerf_width').value);
    currentSettings.allow_rotation = document.getElementById('allow_rotation').checked;
    
    // Convert stock_materials to proper format for Ruby
    const convertedSettings = {
        kerf_width: currentSettings.kerf_width,
        allow_rotation: currentSettings.allow_rotation,
        stock_materials: {}
    };
    
    Object.keys(currentSettings.stock_materials || {}).forEach(material => {
        const data = currentSettings.stock_materials[material];
        convertedSettings.stock_materials[material] = {
            width: data.width || 2440,
            height: data.height || 1220,
            price: data.price || 0
        };
    });
    
    // Send to SketchUp
    callRuby('process', JSON.stringify(convertedSettings));
}

function loadDefaults() {
    callRuby('load_default_materials');
}

function importCSV() {
    callRuby('import_materials_csv');
}

function exportDatabase() {
    callRuby('export_materials_database');
}

function toggleFold() {
    showOnlyUsed = !showOnlyUsed;
    const button = document.getElementById('foldToggle');
    button.textContent = showOnlyUsed ? 'Show All Materials' : 'Show Used Only';
    displayMaterials();
}

function highlightMaterial(material) {
    callRuby('highlight_material', material);
}

function clearHighlight() {
    callRuby('clear_highlight');
}

function callRuby(method, args) {
    if (typeof sketchup === 'object' && sketchup[method]) {
        sketchup[method](args);
    } else {
        // Debug logging removed for production
    }
}

// Initialize when page loads
window.addEventListener('load', function() {
    callRuby('ready');
});

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\config.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AutoNestCut Configuration</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>AutoNestCut Configuration</h1>
        
        <div class="buttons-top">
            <button type="button" onclick="processNesting()" class="primary">Generate Cut List</button>
            <button type="button" onclick="window.close()">Cancel</button>
        </div>
        
        <div class="section">
            <h2>General Settings</h2>
            <div class="form-group">
                <label for="kerf_width">Kerf Width (mm):</label>
                <input type="number" id="kerf_width" step="0.1" min="0" max="10">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="allow_rotation"> Allow part rotation
                </label>
            </div>
        </div>
        
        <div class="section">
            <h2>Stock Materials & Pricing</h2>
            <div id="materials_list"></div>
            <button type="button" onclick="addMaterial()">Add Material</button>
        </div>
        
        <div class="section">
            <h2>Parts Preview</h2>
            <div id="parts_preview"></div>
        </div>
    </div>
    
    <script src="app.js"></script>
</body>
</html>

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\diagrams_report.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AutoNestCut Diagrams & Report</title>
    <link rel="stylesheet" href="diagrams_style.css">
</head>
<body>
    <div class="header">
        <h1>AutoNestCut Diagrams & Report</h1>
        <button id="backButton">â† Back to Configuration</button>
        <button id="printButton">Print / Save as PDF</button>
        <button id="exportCsvButton">Export CSV Report</button>
        <button id="exportHtmlButton">Export Interactive HTML</button>
    </div>

    <div class="container">
        <div id="diagramsContainer" class="diagrams-container">
            <p>Loading diagrams...</p>
        </div>
        <div class="resizer" id="resizer"></div>
        <div id="reportContainer" class="report-container">
            <h2>Overall Summary</h2>
            <table id="summaryTable"></table>

            <h2>Materials Used</h2>
            <div id="materialsContainer"></div>

            <h2>Unique Part Types</h2>
            <table id="uniquePartTypesTable"></table>

            <h2>Unique Board Types</h2>
            <table id="uniqueBoardTypesTable"></table>

            <h2>Boards Summary</h2>
            <table id="boardsTable"></table>

            <h2>Parts Placed (Detailed)</h2>
            <div class="tree-controls">
                <button type="button" id="treeToggle" onclick="toggleTreeView()">Show Tree Structure</button>
                <div class="tree-search" id="treeSearchContainer" style="display: none;">
                    <input type="text" id="treeSearch" placeholder="Search components..." oninput="filterTree()">
                    <button type="button" onclick="clearTreeSearch()">Clear</button>
                    <button type="button" onclick="expandAll()">Expand All</button>
                    <button type="button" onclick="collapseAll()">Collapse All</button>
                </div>
            </div>
            <div id="treeStructure" class="tree-structure" style="display: none;"></div>
            <table id="partsTable"></table>
        </div>
    </div>

    <!-- Modal for enlarged part view -->
    <div id="partModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-controls">
                <button id="projectionToggle">Orthographic</button>
            </div>
            <canvas id="modalCanvas" width="500" height="400"></canvas>
            <div id="modalInfo"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="diagrams_report.js"></script>
</body>
</html>

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\diagrams_report.js

function callRuby(method, args) {
    if (typeof sketchup === 'object' && sketchup[method]) {
        sketchup[method](args);
    } else {
        // Debug logging removed for production
    }
}

let g_boardsData = [];
let g_reportData = null;

function receiveData(data) {
    // Debug logging removed for production
    g_boardsData = data.diagrams;
    g_reportData = data.report;
    window.originalComponents = data.original_components || [];
    window.hierarchyTree = data.hierarchy_tree || [];
    
    renderDiagrams();
    renderReport();
}

function renderDiagrams() {
    const container = document.getElementById('diagramsContainer');
    container.innerHTML = '';

    if (!g_boardsData || g_boardsData.length === 0) {
        container.innerHTML = '<p>No cutting diagrams to display.</p>';
        return;
    }

    g_boardsData.forEach((board, boardIndex) => {
        const card = document.createElement('div');
        card.className = 'diagram-card';

        const title = document.createElement('h3');
        title.textContent = `${board.material} Board ${boardIndex + 1}`;
        title.id = `diagram-${board.material.replace(/[^a-zA-Z0-9]/g, '_')}-${boardIndex}`;
        card.appendChild(title);

        const info = document.createElement('p');
        info.innerHTML = `Size: ${board.stock_width.toFixed(1)}x${board.stock_height.toFixed(1)}mm<br>
                          Waste: ${board.waste_percentage.toFixed(1)}% (Efficiency: ${board.efficiency_percentage.toFixed(1)}%)`;
        card.appendChild(info);

        const canvas = document.createElement('canvas');
        canvas.className = 'diagram-canvas';
        card.appendChild(canvas);

        container.appendChild(card);

        const ctx = canvas.getContext('2d');
        const padding = 40;
        const maxCanvasDim = 600;
        const scale = Math.min(
            (maxCanvasDim - 2 * padding) / board.stock_width,
            (maxCanvasDim - 2 * padding) / board.stock_height
        );

        canvas.width = board.stock_width * scale + 2 * padding;
        canvas.height = board.stock_height * scale + 2 * padding;

        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 2;
        ctx.strokeRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
        
        ctx.fillStyle = '#333';
        ctx.font = `${Math.max(12, 14 * scale)}px Arial`;
        ctx.textAlign = 'center';
        ctx.fillText(`${board.stock_width.toFixed(0)}mm`, padding + (board.stock_width * scale) / 2, padding - 5);
        
        ctx.save();
        ctx.translate(padding - 15, padding + (board.stock_height * scale) / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText(`${board.stock_height.toFixed(0)}mm`, 0, 0);
        ctx.restore();

        const parts = board.parts || [];
        parts.forEach((part, partIndex) => {
            const partX = padding + part.x * scale;
            const partY = padding + part.y * scale;
            const partWidth = part.width * scale;
            const partHeight = part.height * scale;

            ctx.fillStyle = getMaterialColor(part.material);
            ctx.fillRect(partX, partY, partWidth, partHeight);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(partX, partY, partWidth, partHeight);

            canvas.partData = canvas.partData || [];
            canvas.partData.push({
                x: partX, y: partY, width: partWidth, height: partHeight,
                part: part, boardIndex: boardIndex
            });

            if (partWidth > 30 && partHeight > 20) {
                // Larger, centered white labels for readability
                ctx.fillStyle = '#ffffff';
                ctx.font = `bold ${Math.max(12, 14 * scale)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const labelContent = String(part.instance_id || `P${partIndex + 1}`);
                const maxChars = Math.max(6, Math.floor(partWidth / 8));
                const displayLabel = labelContent.length > maxChars ? labelContent.slice(0, maxChars - 1) + 'â€¦' : labelContent;
                ctx.fillText(displayLabel, partX + partWidth / 2, partY + partHeight / 2);
            }

            if (partWidth > 50) {
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.max(10, 11 * scale)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText(`${Math.round(part.width)}mm`, partX + partWidth / 2, partY + 5);
            }

            if (partHeight > 50) {
                ctx.save();
                ctx.translate(partX + 5, partY + partHeight / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.max(10, 11 * scale)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText(`${Math.round(part.height)}mm`, 0, 0);
                ctx.restore();
            }
        });

        canvas.addEventListener('click', (e) => handleCanvasClick(e, canvas));
        canvas.addEventListener('mousemove', (e) => handleCanvasHover(e, canvas));
        canvas.style.cursor = 'pointer';
    });
}

function renderReport() {
    if (!g_reportData) return;

    const summaryTable = document.getElementById('summaryTable');
    summaryTable.innerHTML = `
        <tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Total Parts Instances</td><td>${g_reportData.summary.total_parts_instances || 0}</td></tr>
        <tr><td>Total Unique Part Types</td><td>${g_reportData.summary.total_unique_part_types || 0}</td></tr>
        <tr><td>Total Boards</td><td>${g_reportData.summary.total_boards || 0}</td></tr>
        <tr><td>Overall Efficiency</td><td>${(g_reportData.summary.overall_efficiency || 0).toFixed(2)}%</td></tr>
        <tr><td><strong>Total Project Cost</strong></td><td class="total-highlight"><strong>$${(g_reportData.summary.total_project_cost || 0).toFixed(2)}</strong></td></tr>
    `;

    const materialsContainer = document.getElementById('materialsContainer');
    if (materialsContainer && g_reportData.unique_board_types) {
        materialsContainer.innerHTML = g_reportData.unique_board_types.map((board_type, index) => `
            <div class="material-item" onclick="scrollToDiagram('${board_type.material}')" style="cursor: pointer;">
                <div class="material-swatch" style="background: ${getMaterialColor(board_type.material)}"></div>
                <span class="material-name">${board_type.material}</span>
                <span class="material-price">Price: $${(board_type.price_per_sheet || 0).toFixed(2)}</span>
            </div>
        `).join('');
    }

    const uniquePartTypesTable = document.getElementById('uniquePartTypesTable');
    if (uniquePartTypesTable) {
        uniquePartTypesTable.innerHTML = `
            <tr><th>Name</th><th>W (mm)</th><th>H (mm)</th><th>Thick (mm)</th><th>Material</th><th>Grain</th><th>Total Qty</th><th>Total Area (mÂ²)</th></tr>
        `;
        if (g_reportData.unique_part_types) {
            g_reportData.unique_part_types.forEach(part_type => {
                uniquePartTypesTable.innerHTML += `
                    <tr>
                        <td>${part_type.name}</td>
                        <td>${part_type.width.toFixed(2)}</td>
                        <td>${part_type.height.toFixed(2)}</td>
                        <td>${part_type.thickness.toFixed(2)}</td>
                        <td>${part_type.material}</td>
                        <td>${part_type.grain_direction}</td>
                        <td class="total-highlight">${part_type.total_quantity}</td>
                        <td>${(part_type.total_area / 1000000).toFixed(3)}</td>
                    </tr>
                `;
            });
        }
    }

    const uniqueBoardTypesTable = document.getElementById('uniqueBoardTypesTable');
    if (uniqueBoardTypesTable) {
        uniqueBoardTypesTable.innerHTML = `
            <tr><th>Material</th><th>Dimensions</th><th>Count</th><th>Total Area (mÂ²)</th><th>Price/Sheet</th><th>Total Cost</th></tr>
        `;
        if (g_reportData.unique_board_types) {
            g_reportData.unique_board_types.forEach(board_type => {
                uniqueBoardTypesTable.innerHTML += `
                    <tr>
                        <td>${board_type.material}</td>
                        <td>${board_type.dimensions}</td>
                        <td class="total-highlight">${board_type.count}</td>
                        <td>${(board_type.total_area / 1000000).toFixed(3)}</td>
                        <td>$${(board_type.price_per_sheet || 0).toFixed(2)}</td>
                        <td class="total-highlight">$${(board_type.total_cost || 0).toFixed(2)}</td>
                    </tr>
                `;
            });
        }
    }

    const boardsTable = document.getElementById('boardsTable');
    boardsTable.innerHTML = `
        <tr><th>Board#</th><th>Material</th><th>Size</th><th>Parts</th><th>Efficiency</th></tr>
    `;
    if (g_reportData.boards) {
        g_reportData.boards.forEach(board => {
            boardsTable.innerHTML += `
                <tr>
                    <td>${board.board_number}</td>
                    <td>${board.material}</td>
                    <td>${board.stock_size}</td>
                    <td class="total-highlight">${board.parts_count}</td>
                    <td>${board.efficiency.toFixed(2)}%</td>
                </tr>
            `;
        });
    }

    const partsTable = document.getElementById('partsTable');
    partsTable.innerHTML = `
        <tr><th>Unique ID</th><th>Name</th><th>Dimensions</th><th>Material</th><th>Board#</th></tr>
    `;
    const parts_list = g_reportData.parts_placed || g_reportData.parts || [];
    parts_list.forEach(part => {
        partsTable.innerHTML += `
            <tr>
                <td>${part.part_unique_id || part.part_number}</td>
                <td>${part.name}</td>
                <td>${part.width.toFixed(0)} Ã— ${part.height.toFixed(0)}mm</td>
                <td>${part.material}</td>
                <td>${part.board_number}</td>
            </tr>
        `;
    });
}

function getMaterialColor(material) {
    let hash = 0;
    for (let i = 0; i < material.length; i++) {
        hash = material.charCodeAt(i) + ((hash << 5) - hash);
    }
    const hue = Math.abs(hash) % 360;
    return `hsl(${hue}, 45%, 65%)`;
}

function getMaterialTexture(material) {
    if (material.toLowerCase().includes('wood') || material.toLowerCase().includes('chestnut')) {
        return 'repeating-linear-gradient(45deg, #8B4513, #8B4513 2px, #A0522D 2px, #A0522D 4px)';
    } else if (material.includes('240,240,240')) {
        return 'repeating-linear-gradient(90deg, #f0f0f0, #f0f0f0 3px, #e0e0e0 3px, #e0e0e0 6px)';
    }
    return getMaterialColor(material);
}

function scrollToDiagram(material) {
    // Sanitize material name for ID matching
    const sanitizedMaterial = material.replace(/[^a-zA-Z0-9]/g, '_');
    const diagrams = document.querySelectorAll(`[id^="diagram-${sanitizedMaterial}-"]`);
    if (diagrams.length > 0) {
        diagrams[0].scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}

function handleCanvasClick(e, canvas) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    if (canvas.partData) {
        for (let partData of canvas.partData) {
            if (x >= partData.x && x <= partData.x + partData.width &&
                y >= partData.y && y <= partData.y + partData.height) {
                showPartModal(partData.part);
                break;
            }
        }
    }
}

function handleCanvasHover(e, canvas) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    let hovering = false;
    if (canvas.partData) {
        for (let partData of canvas.partData) {
            if (x >= partData.x && x <= partData.x + partData.width &&
                y >= partData.y && y <= partData.y + partData.height) {
                hovering = true;
                break;
            }
        }
    }
    canvas.style.cursor = hovering ? 'pointer' : 'default';
}

let scene, camera, renderer, controls, cube;
let showTexture = false, isOrthographic = false, currentPart = null;

function showPartModal(part) {
    const modal = document.getElementById('partModal');
    const modalCanvas = document.getElementById('modalCanvas');
    const modalInfo = document.getElementById('modalInfo');
    
    initThreeJS(part, modalCanvas);
    setupOrbitControls();
    
    modalInfo.innerHTML = `
        <h3>${part.name}</h3>
        <p><strong>Dimensions:</strong> ${part.width.toFixed(1)} Ã— ${part.height.toFixed(1)} Ã— ${part.thickness.toFixed(1)}mm</p>
        <p><strong>Area:</strong> ${(part.width * part.height / 1000000).toFixed(3)} mÂ²</p>
        <p><strong>Material:</strong> ${part.material}</p>
        <p><strong>Grain Direction:</strong> ${part.grain_direction || 'Any'}</p>
        <p><strong>Rotated:</strong> ${part.rotated ? 'Yes' : 'No'}</p>
        <p style="color: #666; font-size: 12px;">Left drag: orbit | Middle/Shift+Left drag: pan | Scroll: zoom</p>
    `;
    
    document.getElementById('projectionToggle').onclick = () => {
        isOrthographic = !isOrthographic;
        document.getElementById('projectionToggle').textContent = isOrthographic ? 'Perspective' : 'Orthographic';
        
        if (isOrthographic) {
            const distance = camera.position.distanceTo(controls.target);
            camera = new THREE.OrthographicCamera(-distance, distance, distance, -distance, 0.1, 1000);
        } else {
            camera = new THREE.PerspectiveCamera(75, renderer.domElement.width / renderer.domElement.height, 0.1, 1000);
        }
        camera.position.set(5, 5, 5);
        controls.object = camera;
    };
    
    currentPart = part;
    modal.style.display = 'block';
    animate();
}

function initThreeJS(part, canvas) {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);
    
    camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
    camera.position.set(5, 5, 5);
    
    renderer = new THREE.WebGLRenderer({ canvas: canvas });
    renderer.setSize(canvas.width, canvas.height);
    
    const w = part.width / 100;
    const h = part.height / 100; 
    const d = part.thickness / 100;
    
    const geometry = new THREE.BoxGeometry(w, h, d);
    const material = new THREE.MeshBasicMaterial({ color: 0x74b9ff });
    cube = new THREE.Mesh(geometry, material);
    
    const edges = new THREE.EdgesGeometry(geometry);
    const edgeMaterial = new THREE.LineBasicMaterial({ color: 0x333333, linewidth: 1 });
    const wireframe = new THREE.LineSegments(edges, edgeMaterial);
    
    scene.add(cube);
    scene.add(wireframe);
}

function setupOrbitControls() {
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.25;
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.enableRotate = true;
    controls.minDistance = 1;
    controls.maxDistance = 50;
}

function animate() {
    if (!renderer || !scene || !camera) return;
    
    controls.update();
    renderer.render(scene, camera);
    
    if (document.getElementById('partModal').style.display === 'block') {
        requestAnimationFrame(animate);
    }
}

let resizerInitialized = false;

function initResizer() {
    const resizer = document.getElementById('resizer');
    const leftSide = document.getElementById('diagramsContainer');
    const rightSide = document.getElementById('reportContainer');
    
    if (!resizer || !leftSide || !rightSide || resizerInitialized) return;
    
    let isResizing = false;
    resizerInitialized = true;
    
    resizer.style.cursor = 'col-resize';
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        e.preventDefault();
        
        const container = document.querySelector('.container');
        const containerRect = container.getBoundingClientRect();
        const leftWidth = e.clientX - containerRect.left;
        const totalWidth = containerRect.width;
        const leftPercent = (leftWidth / totalWidth) * 100;
        const rightPercent = 100 - leftPercent;
        
        if (leftPercent > 15 && rightPercent > 25) {
            leftSide.style.flex = `0 0 ${leftPercent}%`;
            rightSide.style.flex = `0 0 ${rightPercent}%`;
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        resizer.style.cursor = 'col-resize';
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
    
    resizer.addEventListener('mousedown', (e) => {
        e.preventDefault();
        isResizing = true;
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    resizer.addEventListener('mouseenter', () => {
        if (!isResizing) {
            resizer.style.cursor = 'col-resize';
        }
    });
}

function exportInteractiveHTML() {
    if (!g_boardsData || g_boardsData.length === 0 || !g_reportData) {
        alert('No data to export. Please generate a report first.');
        return;
    }

    const htmlContent = `<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AutoNestCut Interactive Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .container { display: flex; gap: 20px; }
        .diagrams-container { flex: 1; }
        .report-container { flex: 1; }
        .resizer { width: 5px; background: #ddd; cursor: col-resize; flex-shrink: 0; }
        .diagram-card { border: 1px solid #ddd; margin: 10px 0; padding: 10px; }
        .diagram-canvas { border: 1px solid #ccc; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 0.8em; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        th { background-color: #f2f2f2; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 2% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 900px; max-height: 90vh; overflow-y: auto; }
        .modal-controls { margin-bottom: 10px; }
        .modal-controls button { margin-right: 10px; padding: 5px 10px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
        #modalCanvas { border: 1px solid #ddd; }
        #modalInfo { margin-top: 15px; }
        .material-item { display: flex; align-items: center; margin: 5px 0; cursor: pointer; }
        .material-swatch { width: 20px; height: 20px; margin-right: 10px; border: 1px solid #ccc; }
        .total-highlight { font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>AutoNestCut Interactive Report</h1>
        <button onclick="window.print()">Print / Save as PDF</button>
    </div>
    <div class="container">
        <div id="diagramsContainer" class="diagrams-container"></div>
        <div class="resizer" id="resizer"></div>
        <div id="reportContainer" class="report-container">
            <h2>Overall Summary</h2>
            <table id="summaryTable"></table>
            <h2>Materials Used</h2>
            <div id="materialsContainer"></div>
            <h2>Unique Part Types</h2>
            <table id="uniquePartTypesTable"></table>
            <h2>Unique Board Types</h2>
            <table id="uniqueBoardTypesTable"></table>
            <h2>Boards Summary</h2>
            <table id="boardsTable"></table>
            <h2>Parts Placed (Detailed)</h2>
            <table id="partsTable"></table>
        </div>
    </div>
    <div id="partModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-controls">
                <button id="projectionToggle">Orthographic</button>
            </div>
            <canvas id="modalCanvas" width="500" height="400"></canvas>
            <div id="modalInfo"></div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        let g_boardsData = ${JSON.stringify(g_boardsData)};
        let g_reportData = ${JSON.stringify(g_reportData)};
        ${getCompleteJSContent()}
        document.addEventListener('DOMContentLoaded', () => {
            renderDiagrams();
            renderReport();
            const modal = document.getElementById('partModal');
            const closeBtn = document.querySelector('.close');
            if (closeBtn) closeBtn.addEventListener('click', () => modal.style.display = 'none');
            window.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });
            initResizer();
        });
    </script>
</body>
</html>`;

    downloadHTML(htmlContent, 'AutoNestCut_Interactive_Report.html');
}

function getCompleteJSContent() {
    const smoothScrollToDiagram = `function scrollToDiagram(material) {
        const sanitizedMaterial = material.replace(/[^a-zA-Z0-9]/g, '_');
        const diagrams = document.querySelectorAll(\`[id^="diagram-\${sanitizedMaterial}-"]\`);
        if (diagrams.length > 0) {
            diagrams[0].style.scrollMarginTop = '20px';
            diagrams[0].scrollIntoView({ behavior: 'smooth', block: 'start' });
            setTimeout(() => diagrams[0].style.scrollMarginTop = '', 800);
        }
    }`;
    return `${renderDiagrams.toString()}\n${renderReport.toString()}\n${getMaterialColor.toString()}\n${getMaterialTexture.toString()}\n${smoothScrollToDiagram}\n${handleCanvasClick.toString()}\n${handleCanvasHover.toString()}\n${showPartModal.toString()}\n${initThreeJS.toString()}\n${setupOrbitControls.toString()}\n${animate.toString()}\n${initResizer.toString()}`;
}

function downloadHTML(content, filename) {
    const blob = new Blob([content], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    alert('Interactive HTML report exported successfully!');
}

let showTreeView = false;
let treeNodeId = 0;
let expandedNodes = new Set();
let searchTerm = '';
function toggleTreeView() {
    showTreeView = !showTreeView;
    const button = document.getElementById('treeToggle');
    const treeContainer = document.getElementById('treeStructure');
    const searchContainer = document.getElementById('treeSearchContainer');
    
    if (showTreeView) {
        button.textContent = 'Hide Tree Structure';
        treeContainer.style.display = 'block';
        searchContainer.style.display = 'flex';
        renderTreeStructure();
    } else {
        button.textContent = 'Show Tree Structure';
        treeContainer.style.display = 'none';
        searchContainer.style.display = 'none';
    }
}

function renderTreeStructure() {
    const container = document.getElementById('treeStructure');
    if (!window.hierarchyTree || window.hierarchyTree.length === 0) {
        container.innerHTML = '<p>No hierarchy data available.</p>';
        return;
    }

    treeNodeId = 0;
    let html = '<div class="tree-header">Model Structure:</div>';
    html += '<div class="tree">';

    window.hierarchyTree.forEach(node => {
        html += renderTreeNode(node, 1);
    });

    html += '</div>';
    container.innerHTML = html;

    // Attach click handlers to buttons for toggling nodes
    container.querySelectorAll('button.node-button').forEach(btn => {
        const id = btn.dataset.nodeId;
        if (!id) return;
        // Only add listener for nodes that have a children container
        const children = document.getElementById(`children-${id}`);
        if (children) {
            btn.addEventListener('click', () => toggleNode(id));
        }
    });

    if (searchTerm) {
        filterTreeNodes();
    }
}

function renderTreeNode(node, level) {
    const hasChildren = node.children && node.children.length > 0;
    const nodeId = `tree-node-${treeNodeId++}`;

    let html = `<div class="tree-node" data-node-id="${nodeId}" data-level="${level}">`;
    html += `<div class="tree-item level-${Math.min(level,7)}">`;

    const btnClass = hasChildren ? '' : 'no-children';
    // Use a button for accessibility and consistent focus behavior
    html += `<button class="node-button ${btnClass}" data-node-id="${nodeId}">${escapeHtml(node.name || '')}</button>`;
    html += `</div>`;

    if (hasChildren) {
        html += `<div class="children" id="children-${nodeId}">`;
        node.children.forEach(child => {
            html += renderTreeNode(child, level + 1);
        });
        html += `</div>`;
    }

    html += `</div>`;
    return html;
}

// Simple HTML escape to avoid injection from model names
function escapeHtml(str) {
    return str.replace(/[&<>\"']/g, function (c) {
        return {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":"&#39;"}[c];
    });
}

function toggleNode(nodeId) {
    const childrenContainer = document.getElementById(`children-${nodeId}`);
    const button = document.querySelector(`button[data-node-id="${nodeId}"]`);

    if (!childrenContainer || !button) return;

    const isExpanded = childrenContainer.classList.contains('expanded');
    if (isExpanded) {
        childrenContainer.classList.remove('expanded');
        button.classList.remove('expanded');
        expandedNodes.delete(nodeId);
    } else {
        childrenContainer.classList.add('expanded');
        button.classList.add('expanded');
        expandedNodes.add(nodeId);
    }
}

function expandAll() {
    document.querySelectorAll('.children').forEach(child => child.classList.add('expanded'));
    document.querySelectorAll('button.node-button').forEach(btn => btn.classList.add('expanded'));
    document.querySelectorAll('.tree-node').forEach(node => {
        const id = node.dataset.nodeId;
        if (id) expandedNodes.add(id);
    });
}

function collapseAll() {
    document.querySelectorAll('.children').forEach(child => child.classList.remove('expanded'));
    document.querySelectorAll('button.node-button').forEach(btn => btn.classList.remove('expanded'));
    expandedNodes.clear();
}

function filterTree() {
    searchTerm = document.getElementById('treeSearch').value.toLowerCase();
    filterTreeNodes();
}

function filterTreeNodes() {
    const nodes = document.querySelectorAll('.tree-node');

    if (!searchTerm) {
        nodes.forEach(node => {
            node.style.display = 'block';
            node.classList.remove('search-highlight');
        });
        return;
    }

    nodes.forEach(node => {
        const button = node.querySelector('.node-button');
        const text = (button ? button.textContent : '').toLowerCase();
        const matches = text.includes(searchTerm);

        if (matches) {
            node.style.display = 'block';
            node.classList.add('search-highlight');
            expandParentNodes(node);
        } else {
            node.style.display = 'none';
            node.classList.remove('search-highlight');
        }
    });
}

function expandParentNodes(node) {
    let parent = node.parentElement;
    while (parent) {
        if (parent.classList && parent.classList.contains('children')) {
            parent.classList.add('expanded');
            const parentNode = parent.previousElementSibling;
            if (parentNode) {
                const btn = parentNode.querySelector('button.node-button');
                if (btn) btn.classList.add('expanded');
            }
            const nodeId = parent.id && parent.id.replace('children-', '');
            if (nodeId) expandedNodes.add(nodeId);
        }
        parent = parent.parentElement;
    }
}

function clearTreeSearch() {
    const input = document.getElementById('treeSearch');
    if (input) input.value = '';
    searchTerm = '';
    filterTreeNodes();
}

document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('partModal');
    const closeBtn = document.querySelector('.close');
    
    if (closeBtn) {
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
    }
    
    window.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });

    initResizer();
    setTimeout(() => {
        callRuby('ready');
    }, 100);
});

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\diagrams_report_backup.js

function callRuby(method, args) {
    if (typeof sketchup === 'object' && sketchup[method]) {
        sketchup[method](args);
    } else {
        // Debug logging removed for production
    }
}

// receiveData: Removed verbose logging
function receiveData(data) {
    g_boardsData = data.diagrams;
    g_reportData = data.report;
    
    renderDiagrams();
    renderReport();
}

let g_boardsData = [];
let g_reportData = null;

// alternative receiveData (backup) - verbose logging removed
function receiveData(data) {
    g_boardsData = data.diagrams;
    g_reportData = data.report;
    window.originalComponents = data.original_components || [];
    
    renderDiagrams();
    renderReport();
}

function renderDiagrams() {
    const container = document.getElementById('diagramsContainer');
    container.innerHTML = '';

    if (!g_boardsData || g_boardsData.length === 0) {
        container.innerHTML = '<p>No cutting diagrams to display.</p>';
        return;
    }

    g_boardsData.forEach((board, boardIndex) => {
        const card = document.createElement('div');
        card.className = 'diagram-card';

        const title = document.createElement('h3');
        title.textContent = `${board.material} Board ${boardIndex + 1}`;
        title.id = `diagram-${board.material}-${boardIndex}`;
        card.appendChild(title);

        const info = document.createElement('p');
        info.innerHTML = `Size: ${board.stock_width.toFixed(1)}x${board.stock_height.toFixed(1)}mm<br>
                          Waste: ${board.waste_percentage.toFixed(1)}% (Efficiency: ${board.efficiency_percentage.toFixed(1)}%)`;
        card.appendChild(info);

        const canvas = document.createElement('canvas');
        canvas.className = 'diagram-canvas';
        card.appendChild(canvas);

        container.appendChild(card);

        // Canvas Drawing
        const ctx = canvas.getContext('2d');
        const padding = 40;
        const maxCanvasDim = 600;
        const scale = Math.min(
            (maxCanvasDim - 2 * padding) / board.stock_width,
            (maxCanvasDim - 2 * padding) / board.stock_height
        );

        canvas.width = board.stock_width * scale + 2 * padding;
        canvas.height = board.stock_height * scale + 2 * padding;

        // Draw Board Outline (grayscale)
        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 2;
        ctx.strokeRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
        
        // Add board dimensions as text on the board
        ctx.fillStyle = '#333';
        ctx.font = `${Math.max(12, 14 * scale)}px Arial`;
        ctx.textAlign = 'center';
        ctx.fillText(`${board.stock_width.toFixed(0)}mm`, padding + (board.stock_width * scale) / 2, padding - 5);
        
        ctx.save();
        ctx.translate(padding - 15, padding + (board.stock_height * scale) / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText(`${board.stock_height.toFixed(0)}mm`, 0, 0);
        ctx.restore();

        // Draw Parts
        const parts = board.parts || [];
        parts.forEach((part, partIndex) => {
            const partX = padding + part.x * scale;
            const partY = padding + part.y * scale;
            const partWidth = part.width * scale;
            const partHeight = part.height * scale;

            // Material-based color fill
            ctx.fillStyle = getMaterialColor(part.material);
            ctx.fillRect(partX, partY, partWidth, partHeight);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(partX, partY, partWidth, partHeight);

            // Store part data for click detection
            canvas.partData = canvas.partData || [];
            canvas.partData.push({
                x: partX, y: partY, width: partWidth, height: partHeight,
                part: part, boardIndex: boardIndex
            });

            // Add part ID in center - properly aligned
            if (partWidth > 30 && partHeight > 20) {
                ctx.fillStyle = '#000';
                ctx.font = `${Math.max(8, 10 * scale)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const labelContent = part.instance_id || `P${partIndex + 1}`;
                ctx.fillText(labelContent, partX + partWidth / 2, partY + partHeight / 2);
            }
            
            // Add width dimension (horizontal) - inside piece
            if (partWidth > 50) {
                ctx.fillStyle = '#000';
                ctx.font = `${Math.max(8, 10 * scale)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText(`${part.width.toFixed(0)}mm`, partX + partWidth / 2, partY + 5);
            }
            
            // Add height dimension (vertical) - inside piece
            if (partHeight > 50) {
                ctx.save();
                ctx.translate(partX + 5, partY + partHeight / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillStyle = '#000';
                ctx.font = `${Math.max(8, 10 * scale)}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText(`${part.height.toFixed(0)}mm`, 0, 0);
                ctx.restore();
            }
        });

        // Add click event listener
        canvas.addEventListener('click', (e) => handleCanvasClick(e, canvas));
        canvas.addEventListener('mousemove', (e) => handleCanvasHover(e, canvas));
        canvas.style.cursor = 'pointer';
    });
}

function getPartColor(partIndex) {
    const colors = [
        'rgba(255,0,0,0.6)', 'rgba(0,0,255,0.6)', 'rgba(0,255,0,0.6)', 'rgba(255,255,0,0.6)',
        'rgba(255,165,0,0.6)', 'rgba(128,0,128,0.6)', 'rgba(0,255,255,0.6)', 'rgba(255,0,255,0.6)'
    ];
    return colors[partIndex % colors.length];
}

function renderReport() {
    if (!g_reportData) return;

    // Summary Table
    const summaryTable = document.getElementById('summaryTable');
    summaryTable.innerHTML = `
        <tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Total Parts Instances</td><td>${g_reportData.summary.total_parts_instances || 0}</td></tr>
        <tr><td>Total Unique Part Types</td><td>${g_reportData.summary.total_unique_part_types || 0}</td></tr>
        <tr><td>Total Boards</td><td>${g_reportData.summary.total_boards || 0}</td></tr>
        <tr><td>Overall Efficiency</td><td>${(g_reportData.summary.overall_efficiency || 0).toFixed(2)}%</td></tr>
        <tr><td><strong>Total Project Cost</strong></td><td class="total-highlight"><strong>$${(g_reportData.summary.total_project_cost || 0).toFixed(2)}</strong></td></tr>
    `;

    // Materials Used Section - moved to top
    const materialsContainer = document.getElementById('materialsContainer');
    if (materialsContainer && g_reportData.unique_board_types) {
        materialsContainer.innerHTML = g_reportData.unique_board_types.map((board_type, index) => `
            <div class="material-item" onclick="scrollToDiagram('${board_type.material}')" style="cursor: pointer;">
                <div class="material-swatch" style="background: ${getMaterialColor(board_type.material)}"></div>
                <span class="material-name">${board_type.material}</span>
                <span class="material-price">Price: $${(board_type.price_per_sheet || 0).toFixed(2)}</span>
            </div>
        `).join('');
    }

    // Unique Part Types Table
    const uniquePartTypesTable = document.getElementById('uniquePartTypesTable');
    if (uniquePartTypesTable) {
        uniquePartTypesTable.innerHTML = `
            <tr><th>Name</th><th>W (mm)</th><th>H (mm)</th><th>Thick (mm)</th><th>Material</th><th>Grain</th><th>Total Qty</th><th>Total Area (mÂ²)</th></tr>
        `;
        if (g_reportData.unique_part_types) {
            g_reportData.unique_part_types.forEach(part_type => {
                uniquePartTypesTable.innerHTML += `
                    <tr>
                        <td>${part_type.name}</td>
                        <td>${part_type.width.toFixed(2)}</td>
                        <td>${part_type.height.toFixed(2)}</td>
                        <td>${part_type.thickness.toFixed(2)}</td>
                        <td>${part_type.material}</td>
                        <td>${part_type.grain_direction}</td>
                        <td class="total-highlight">${part_type.total_quantity}</td>
                        <td>${(part_type.total_area / 1000000).toFixed(3)}</td>
                    </tr>
                `;
            });
        }
    }

    // Unique Board Types Table
    const uniqueBoardTypesTable = document.getElementById('uniqueBoardTypesTable');
    if (uniqueBoardTypesTable) {
        uniqueBoardTypesTable.innerHTML = `
            <tr><th>Material</th><th>Dimensions</th><th>Count</th><th>Total Area (mÂ²)</th><th>Price/Sheet</th><th>Total Cost</th></tr>
        `;
        if (g_reportData.unique_board_types) {
            g_reportData.unique_board_types.forEach(board_type => {
                uniqueBoardTypesTable.innerHTML += `
                    <tr>
                        <td>${board_type.material}</td>
                        <td>${board_type.dimensions}</td>
                        <td class="total-highlight">${board_type.count}</td>
                        <td>${(board_type.total_area / 1000000).toFixed(3)}</td>
                        <td>$${(board_type.price_per_sheet || 0).toFixed(2)}</td>
                        <td class="total-highlight">$${(board_type.total_cost || 0).toFixed(2)}</td>
                    </tr>
                `;
            });
        }
    }

    // Boards Table
    const boardsTable = document.getElementById('boardsTable');
    boardsTable.innerHTML = `
        <tr><th>Board#</th><th>Material</th><th>Size</th><th>Parts</th><th>Efficiency</th></tr>
    `;
    if (g_reportData.boards) {
        g_reportData.boards.forEach(board => {
            boardsTable.innerHTML += `
                <tr>
                    <td>${board.board_number}</td>
                    <td>${board.material}</td>
                    <td>${board.stock_size}</td>
                    <td class="total-highlight">${board.parts_count}</td>
                    <td>${board.efficiency.toFixed(2)}%</td>
                </tr>
            `;
        });
    }

    // Parts Placed Table
    const partsTable = document.getElementById('partsTable');
    partsTable.innerHTML = `
        <tr><th>Unique ID</th><th>Name</th><th>Dimensions</th><th>Material</th><th>Board#</th></tr>
    `;
    const parts_list = g_reportData.parts_placed || g_reportData.parts || [];
    parts_list.forEach(part => {
        partsTable.innerHTML += `
            <tr>
                <td>${part.part_unique_id || part.part_number}</td>
                <td>${part.name}</td>
                <td>${part.width.toFixed(0)} Ã— ${part.height.toFixed(0)}mm</td>
                <td>${part.material}</td>
                <td>${part.board_number}</td>
            </tr>
        `;
    });
}

function getMaterialColor(material) {
    // Generate consistent colors based on material name
    let hash = 0;
    for (let i = 0; i < material.length; i++) {
        hash = material.charCodeAt(i) + ((hash << 5) - hash);
    }
    const hue = Math.abs(hash) % 360;
    return `hsl(${hue}, 45%, 65%)`;
}

function getMaterialTexture(material) {
    // Create a simple pattern based on material name
    if (material.toLowerCase().includes('wood') || material.toLowerCase().includes('chestnut')) {
        return 'repeating-linear-gradient(45deg, #8B4513, #8B4513 2px, #A0522D 2px, #A0522D 4px)';
    } else if (material.includes('240,240,240')) {
        return 'repeating-linear-gradient(90deg, #f0f0f0, #f0f0f0 3px, #e0e0e0 3px, #e0e0e0 6px)';
    }
    return getMaterialColor(material);
}

function handleCanvasClick(e, canvas) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    if (canvas.partData) {
        for (let partData of canvas.partData) {
            if (x >= partData.x && x <= partData.x + partData.width &&
                y >= partData.y && y <= partData.y + partData.height) {
                showPartModal(partData.part);
                break;
            }
        }
    }
}

function handleCanvasHover(e, canvas) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    let hovering = false;
    if (canvas.partData) {
        for (let partData of canvas.partData) {
            if (x >= partData.x && x <= partData.x + partData.width &&
                y >= partData.y && y <= partData.y + partData.height) {
                hovering = true;
                break;
            }
        }
    }
    canvas.style.cursor = hovering ? 'pointer' : 'default';
}

let scene, camera, renderer, controls, cube;
let showTexture = false, isOrthographic = false, currentPart = null;

function showPartModal(part) {
    const modal = document.getElementById('partModal');
    const modalCanvas = document.getElementById('modalCanvas');
    const modalInfo = document.getElementById('modalInfo');
    
    initThreeJS(part, modalCanvas);
    

    setupOrbitControls();
    
    // Set modal info
    modalInfo.innerHTML = `
        <h3>${part.name}</h3>
        <p><strong>Dimensions:</strong> ${part.width.toFixed(1)} Ã— ${part.height.toFixed(1)} Ã— ${part.thickness.toFixed(1)}mm</p>
        <p><strong>Area:</strong> ${(part.width * part.height / 1000000).toFixed(3)} mÂ²</p>
        <p><strong>Material:</strong> ${part.material}</p>
        <p><strong>Grain Direction:</strong> ${part.grain_direction || 'Any'}</p>
        <p><strong>Rotated:</strong> ${part.rotated ? 'Yes' : 'No'}</p>
        <p style="color: #666; font-size: 12px;">Left drag: orbit | Middle/Shift+Left drag: pan | Scroll: zoom</p>
    `;
    
    // Setup button controls

    
    document.getElementById('projectionToggle').onclick = () => {
        isOrthographic = !isOrthographic;
        document.getElementById('projectionToggle').textContent = isOrthographic ? 'Perspective' : 'Orthographic';
        
        if (isOrthographic) {
            const distance = camera.position.distanceTo(controls.target);
            camera = new THREE.OrthographicCamera(-distance, distance, distance, -distance, 0.1, 1000);
        } else {
            camera = new THREE.PerspectiveCamera(75, renderer.domElement.width / renderer.domElement.height, 0.1, 1000);
        }
        camera.position.set(5, 5, 5);
        controls.object = camera;
    };
    
    currentPart = part;
    modal.style.display = 'block';
    animate();
}



function exportInteractiveHTML() {
    if (!g_boardsData || g_boardsData.length === 0 || !g_reportData) {
        alert('No data to export. Please generate a report first.');
        return;
    }

    const htmlContent = `<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AutoNestCut Interactive Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .container { display: flex; gap: 20px; }
        .diagrams-container { flex: 1; }
        .report-container { flex: 1; }
        .resizer { width: 5px; background: #ddd; cursor: col-resize; flex-shrink: 0; }
        .diagram-card { border: 1px solid #ddd; margin: 10px 0; padding: 10px; }
        .diagram-canvas { border: 1px solid #ccc; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 2% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 900px; max-height: 90vh; overflow-y: auto; }
        .modal-controls { margin-bottom: 10px; }
        .modal-controls button { margin-right: 10px; padding: 5px 10px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
        #modalCanvas { border: 1px solid #ddd; }
        #modalInfo { margin-top: 15px; }
        .material-item { display: flex; align-items: center; margin: 5px 0; }
        .material-swatch { width: 20px; height: 20px; margin-right: 10px; border: 1px solid #ccc; }
        .total-highlight { font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>AutoNestCut Interactive Report</h1>
        <button onclick="window.print()">Print / Save as PDF</button>
    </div>
    <div class="container">
        <div id="diagramsContainer" class="diagrams-container"></div>
        <div class="resizer" id="resizer"></div>
        <div id="reportContainer" class="report-container">
            <h2>Overall Summary</h2>
            <table id="summaryTable"></table>
            <h2>Materials Used</h2>
            <div id="materialsContainer"></div>
            <h2>Unique Part Types</h2>
            <table id="uniquePartTypesTable"></table>
            <h2>Unique Board Types</h2>
            <table id="uniqueBoardTypesTable"></table>
            <h2>Boards Summary</h2>
            <table id="boardsTable"></table>
            <h2>Parts Placed (Detailed)</h2>
            <table id="partsTable"></table>
        </div>
    </div>
    <div id="partModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-controls">
                <button id="projectionToggle">Orthographic</button>
            </div>
            <canvas id="modalCanvas" width="500" height="400"></canvas>
            <div id="modalInfo"></div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        let g_boardsData = ${JSON.stringify(g_boardsData)};
        let g_reportData = ${JSON.stringify(g_reportData)};
        let scene, camera, renderer, controls, cube;
        let showTexture = false, isOrthographic = false, currentPart = null;
        let resizerInitialized = false;
        
        ${getCompleteJSContent()}
        
        document.addEventListener('DOMContentLoaded', () => {
            renderDiagrams();
            renderReport();
            
            const modal = document.getElementById('partModal');
            const closeBtn = document.querySelector('.close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => modal.style.display = 'none');
            }
            window.addEventListener('click', (e) => {
                if (e.target === modal) modal.style.display = 'none';
            });
            initResizer();
        });
    </script>
</body>
</html>`;

    downloadHTML(htmlContent, 'AutoNestCut_Interactive_Report.html');
}



function getCompleteJSContent() {
    return `
        function renderDiagrams() {
            const container = document.getElementById('diagramsContainer');
            container.innerHTML = '';
        
            if (!g_boardsData || g_boardsData.length === 0) {
                container.innerHTML = '<p>No cutting diagrams to display.</p>';
                return;
            }
        
            g_boardsData.forEach((board, boardIndex) => {
                const card = document.createElement('div');
                card.className = 'diagram-card';
        
                const title = document.createElement('h3');
                title.textContent = \`\${board.material} Board \${boardIndex + 1}\`;
                title.id = \`diagram-\${board.material}-\${boardIndex}\`;
                card.appendChild(title);
        
                const info = document.createElement('p');
                info.innerHTML = \`Size: \${board.stock_width.toFixed(1)}x\${board.stock_height.toFixed(1)}mm<br>
                                  Waste: \${board.waste_percentage.toFixed(1)}% (Efficiency: \${board.efficiency_percentage.toFixed(1)}%)\`;
                card.appendChild(info);
        
                const canvas = document.createElement('canvas');
                canvas.className = 'diagram-canvas';
                card.appendChild(canvas);
        
                container.appendChild(card);
        
                const ctx = canvas.getContext('2d');
                const padding = 40;
                const maxCanvasDim = 600;
                const scale = Math.min(
                    (maxCanvasDim - 2 * padding) / board.stock_width,
                    (maxCanvasDim - 2 * padding) / board.stock_height
                );
        
                canvas.width = board.stock_width * scale + 2 * padding;
                canvas.height = board.stock_height * scale + 2 * padding;
        
                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                ctx.strokeRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
                
                ctx.fillStyle = '#333';
                ctx.font = \`\${Math.max(12, 14 * scale)}px Arial\`;
                ctx.textAlign = 'center';
                ctx.fillText(\`\${board.stock_width.toFixed(0)}mm\`, padding + (board.stock_width * scale) / 2, padding - 5);
                
                ctx.save();
                ctx.translate(padding - 15, padding + (board.stock_height * scale) / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText(\`\${board.stock_height.toFixed(0)}mm\`, 0, 0);
                ctx.restore();
        
                const parts = board.parts || [];
                parts.forEach((part, partIndex) => {
                    const partX = padding + part.x * scale;
                    const partY = padding + part.y * scale;
                    const partWidth = part.width * scale;
                    const partHeight = part.height * scale;
        
                    ctx.fillStyle = getMaterialColor(part.material);
                    ctx.fillRect(partX, partY, partWidth, partHeight);
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(partX, partY, partWidth, partHeight);
        
                    canvas.partData = canvas.partData || [];
                    canvas.partData.push({
                        x: partX, y: partY, width: partWidth, height: partHeight,
                        part: part, boardIndex: boardIndex
                    });
        
                    if (partWidth > 30 && partHeight > 20) {
                        ctx.fillStyle = '#000';
                        ctx.font = \`\${Math.max(8, 10 * scale)}px Arial\`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        const labelContent = part.instance_id || \`P\${partIndex + 1}\`;
                        ctx.fillText(labelContent, partX + partWidth / 2, partY + partHeight / 2);
                    }
                    
                    if (partWidth > 50) {
                        ctx.fillStyle = '#000';
                        ctx.font = \`\${Math.max(8, 10 * scale)}px Arial\`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'top';
                        ctx.fillText(\`\${part.width.toFixed(0)}mm\`, partX + partWidth / 2, partY + 5);
                    }
                    
                    if (partHeight > 50) {
                        ctx.save();
                        ctx.translate(partX + 5, partY + partHeight / 2);
                        ctx.rotate(-Math.PI / 2);
                        ctx.fillStyle = '#000';
                        ctx.font = \`\${Math.max(8, 10 * scale)}px Arial\`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'top';
                        ctx.fillText(\`\${part.height.toFixed(0)}mm\`, 0, 0);
                        ctx.restore();
                    }
                });
        
                canvas.addEventListener('click', (e) => handleCanvasClick(e, canvas));
                canvas.addEventListener('mousemove', (e) => handleCanvasHover(e, canvas));
                canvas.style.cursor = 'pointer';
            });
        }
        
        function renderReport() {
            if (!g_reportData) return;
        
            const summaryTable = document.getElementById('summaryTable');
            summaryTable.innerHTML = \`
                <tr><th>Metric</th><th>Value</th></tr>
                <tr><td>Total Parts Instances</td><td>\${g_reportData.summary.total_parts_instances || 0}</td></tr>
                <tr><td>Total Unique Part Types</td><td>\${g_reportData.summary.total_unique_part_types || 0}</td></tr>
                <tr><td>Total Boards</td><td>\${g_reportData.summary.total_boards || 0}</td></tr>
                <tr><td>Overall Efficiency</td><td>\${(g_reportData.summary.overall_efficiency || 0).toFixed(2)}%</td></tr>
                <tr><td><strong>Total Project Cost</strong></td><td class="total-highlight"><strong>$\${(g_reportData.summary.total_project_cost || 0).toFixed(2)}</strong></td></tr>
            \`;
        
            const materialsContainer = document.getElementById('materialsContainer');
            if (materialsContainer && g_reportData.unique_board_types) {
                materialsContainer.innerHTML = g_reportData.unique_board_types.map(board_type => \`
                    <div class="material-item" onclick="scrollToDiagram('\${board_type.material}')" style="cursor: pointer;">
                        <div class="material-swatch" style="background: \${getMaterialColor(board_type.material)}"></div>
                        <span class="material-name">\${board_type.material}</span>
                        <span class="material-price">Price: $\${(board_type.price_per_sheet || 0).toFixed(2)}</span>
                    </div>
                \`).join('');
            }
        
            const uniquePartTypesTable = document.getElementById('uniquePartTypesTable');
            if (uniquePartTypesTable) {
                uniquePartTypesTable.innerHTML = \`
                    <tr><th>Name</th><th>W (mm)</th><th>H (mm)</th><th>Thick (mm)</th><th>Material</th><th>Grain</th><th>Total Qty</th><th>Total Area (mÂ²)</th></tr>
                \`;
                if (g_reportData.unique_part_types) {
                    g_reportData.unique_part_types.forEach(part_type => {
                        uniquePartTypesTable.innerHTML += \`
                            <tr>
                                <td>\${part_type.name}</td>
                                <td>\${part_type.width.toFixed(2)}</td>
                                <td>\${part_type.height.toFixed(2)}</td>
                                <td>\${part_type.thickness.toFixed(2)}</td>
                                <td>\${part_type.material}</td>
                                <td>\${part_type.grain_direction}</td>
                                <td class="total-highlight">\${part_type.total_quantity}</td>
                                <td>\${(part_type.total_area / 1000000).toFixed(3)}</td>
                            </tr>
                        \`;
                    });
                }
            }
        
            const uniqueBoardTypesTable = document.getElementById('uniqueBoardTypesTable');
            if (uniqueBoardTypesTable) {
                uniqueBoardTypesTable.innerHTML = \`
                    <tr><th>Material</th><th>Dimensions</th><th>Count</th><th>Total Area (mÂ²)</th><th>Price/Sheet</th><th>Total Cost</th></tr>
                \`;
                if (g_reportData.unique_board_types) {
                    g_reportData.unique_board_types.forEach(board_type => {
                        uniqueBoardTypesTable.innerHTML += \`
                            <tr>
                                <td>\${board_type.material}</td>
                                <td>\${board_type.dimensions}</td>
                                <td class="total-highlight">\${board_type.count}</td>
                                <td>\${(board_type.total_area / 1000000).toFixed(3)}</td>
                                <td>$\${(board_type.price_per_sheet || 0).toFixed(2)}</td>
                                <td class="total-highlight">$\${(board_type.total_cost || 0).toFixed(2)}</td>
                            </tr>
                        \`;
                    });
                }
            }
        
            const boardsTable = document.getElementById('boardsTable');
            boardsTable.innerHTML = \`
                <tr><th>Board#</th><th>Material</th><th>Size</th><th>Parts</th><th>Efficiency</th></tr>
            \`;
            if (g_reportData.boards) {
                g_reportData.boards.forEach(board => {
                    boardsTable.innerHTML += \`
                        <tr>
                            <td>\${board.board_number}</td>
                            <td>\${board.material}</td>
                            <td>\${board.stock_size}</td>
                            <td class="total-highlight">\${board.parts_count}</td>
                            <td>\${board.efficiency.toFixed(2)}%</td>
                        </tr>
                    \`;
                });
            }
        
            const partsTable = document.getElementById('partsTable');
            partsTable.innerHTML = \`
                <tr><th>Unique ID</th><th>Name</th><th>Dimensions</th><th>Material</th><th>Board#</th></tr>
            \`;
            const parts_list = g_reportData.parts_placed || g_reportData.parts || [];
            parts_list.forEach(part => {
                partsTable.innerHTML += \`
                    <tr>
                        <td>\${part.part_unique_id || part.part_number}</td>
                        <td>\${part.name}</td>
                        <td>\${part.width.toFixed(0)} Ã— \${part.height.toFixed(0)}mm</td>
                        <td>\${part.material}</td>
                        <td>\${part.board_number}</td>
                    </tr>
                \`;
            });
        }
        
        function showPartModal(part) {
            const modal = document.getElementById('partModal');
            const modalCanvas = document.getElementById('modalCanvas');
            const modalInfo = document.getElementById('modalInfo');
            
            initThreeJS(part, modalCanvas);
            setupOrbitControls();
            
            modalInfo.innerHTML = \`
                <h3>\${part.name}</h3>
                <p><strong>Dimensions:</strong> \${part.width.toFixed(1)} Ã— \${part.height.toFixed(1)} Ã— \${part.thickness.toFixed(1)}mm</p>
                <p><strong>Area:</strong> \${(part.width * part.height / 1000000).toFixed(3)} mÂ²</p>
                <p><strong>Material:</strong> \${part.material}</p>
                <p><strong>Grain Direction:</strong> \${part.grain_direction || 'Any'}</p>
                <p><strong>Rotated:</strong> \${part.rotated ? 'Yes' : 'No'}</p>
                <p style="color: #666; font-size: 12px;">Left drag: orbit | Middle/Shift+Left drag: pan | Scroll: zoom</p>
            \`;
            
            document.getElementById('projectionToggle').onclick = () => {
                isOrthographic = !isOrthographic;
                document.getElementById('projectionToggle').textContent = isOrthographic ? 'Perspective' : 'Orthographic';
                
                if (isOrthographic) {
                    const distance = camera.position.distanceTo(controls.target);
                    camera = new THREE.OrthographicCamera(-distance, distance, distance, -distance, 0.1, 1000);
                } else {
                    camera = new THREE.PerspectiveCamera(75, renderer.domElement.width / renderer.domElement.height, 0.1, 1000);
                }
                camera.position.set(5, 5, 5);
                controls.object = camera;
            };
            
            currentPart = part;
            modal.style.display = 'block';
            animate();
        }
        
        function initThreeJS(part, canvas) {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
            camera.position.set(5, 5, 5);
            
            renderer = new THREE.WebGLRenderer({ canvas: canvas });
            renderer.setSize(canvas.width, canvas.height);
            
            const w = part.width / 100;
            const h = part.height / 100; 
            const d = part.thickness / 100;
            
            const geometry = new THREE.BoxGeometry(w, h, d);
            const material = new THREE.MeshBasicMaterial({ color: 0x74b9ff });
            cube = new THREE.Mesh(geometry, material);
            
            const edges = new THREE.EdgesGeometry(geometry);
            const edgeMaterial = new THREE.LineBasicMaterial({ color: 0x333333, linewidth: 1 });
            const wireframe = new THREE.LineSegments(edges, edgeMaterial);
            
            scene.add(cube);
            scene.add(wireframe);
        }
        
        function setupOrbitControls() {
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            controls.enableZoom = true;
            controls.enablePan = true;
            controls.enableRotate = true;
            controls.minDistance = 1;
            controls.maxDistance = 50;
        }
        
        function animate() {
            if (!renderer || !scene || !camera) return;
            
            controls.update();
            renderer.render(scene, camera);
            
            if (document.getElementById('partModal').style.display === 'block') {
                requestAnimationFrame(animate);
            }
        }
        
        function handleCanvasClick(e, canvas) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (canvas.partData) {
                for (let partData of canvas.partData) {
                    if (x >= partData.x && x <= partData.x + partData.width &&
                        y >= partData.y && y <= partData.y + partData.height) {
                        showPartModal(partData.part);
                        break;
                    }
                }
            }
        }
        
        function handleCanvasHover(e, canvas) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            let hovering = false;
            if (canvas.partData) {
                for (let partData of canvas.partData) {
                    if (x >= partData.x && x <= partData.x + partData.width &&
                        y >= partData.y && y <= partData.y + partData.height) {
                        hovering = true;
                        break;
                    }
                }
            }
            canvas.style.cursor = hovering ? 'pointer' : 'default';
        }
        
        function getMaterialColor(material) {
            let hash = 0;
            for (let i = 0; i < material.length; i++) {
                hash = material.charCodeAt(i) + ((hash << 5) - hash);
            }
            const hue = Math.abs(hash) % 360;
            return \`hsl(\${hue}, 45%, 65%)\`;
        }
        
        function getMaterialTexture(material) {
            if (material.toLowerCase().includes('wood') || material.toLowerCase().includes('chestnut')) {
                return 'repeating-linear-gradient(45deg, #8B4513, #8B4513 2px, #A0522D 2px, #A0522D 4px)';
            } else if (material.includes('240,240,240')) {
                return 'repeating-linear-gradient(90deg, #f0f0f0, #f0f0f0 3px, #e0e0e0 3px, #e0e0e0 6px)';
            }
            return getMaterialColor(material);
        }
        
        // Scroll to the first diagram for a material
        function scrollToDiagram(material) {
            const id = 'diagram-' + material + '-0';
            const firstDiagram = document.getElementById(id);
            if (firstDiagram) {
                firstDiagram.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function initResizer() {
            const resizer = document.getElementById('resizer');
            const leftSide = document.getElementById('diagramsContainer');
            const rightSide = document.getElementById('reportContainer');
            
            if (!resizer || !leftSide || !rightSide || resizerInitialized) return;
            
            let isResizing = false;
            resizerInitialized = true;
            
            resizer.style.cursor = 'col-resize';
            
            function handleMouseMove(e) {
                if (!isResizing) return;
                e.preventDefault();
                
                const container = document.querySelector('.container');
                const containerRect = container.getBoundingClientRect();
                const leftWidth = e.clientX - containerRect.left;
                const totalWidth = containerRect.width;
                const leftPercent = (leftWidth / totalWidth) * 100;
                const rightPercent = 100 - leftPercent;
                
                if (leftPercent > 15 && rightPercent > 25) {
                    leftSide.style.flex = \`0 0 \${leftPercent}%\`;
                    rightSide.style.flex = \`0 0 \${rightPercent}%\`;
                }
            }
            
            function handleMouseUp() {
                isResizing = false;
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
                resizer.style.cursor = 'col-resize';
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            }
            
            resizer.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isResizing = true;
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            });
            
            resizer.addEventListener('mouseenter', () => {
                if (!isResizing) {
                    resizer.style.cursor = 'col-resize';
                }
            });
        }
    `;
}

function downloadHTML(content, filename) {
    try {
        const blob = new Blob([content], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        setTimeout(() => {
            alert('Interactive HTML report exported successfully! Click on any part in the cutting diagrams to view it in 3D.');
        }, 100);
    } catch (error) {
        alert('Error exporting HTML: ' + error.message);
    }
}



function initThreeJS(part, canvas) {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);
    
    camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
    camera.position.set(5, 5, 5);
    
    renderer = new THREE.WebGLRenderer({ canvas: canvas });
    renderer.setSize(canvas.width, canvas.height);
    
    // Create box with part dimensions
    const w = part.width / 100;
    const h = part.height / 100; 
    const d = part.thickness / 100;
    
    const geometry = new THREE.BoxGeometry(w, h, d);
    const material = new THREE.MeshBasicMaterial({ color: 0x74b9ff });
    cube = new THREE.Mesh(geometry, material);
    
    // Add subtle edges
    const edges = new THREE.EdgesGeometry(geometry);
    const edgeMaterial = new THREE.LineBasicMaterial({ color: 0x333333, linewidth: 1 });
    const wireframe = new THREE.LineSegments(edges, edgeMaterial);
    
    scene.add(cube);
    scene.add(wireframe);
}

function createShader(type, source) {
    const shader = gl.createShader(type);
    gl.shaderSource(shader, source);
    gl.compileShader(shader);
    return shader;
}

function createProgram(vertexShader, fragmentShader) {
    const program = gl.createProgram();
    gl.attachShader(program, vertexShader);
    gl.attachShader(program, fragmentShader);
    gl.linkProgram(program);
    return program;
}

function setupOrbitControls() {
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.25;
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.enableRotate = true;
    controls.minDistance = 1;
    controls.maxDistance = 50;
}

function animate() {
    if (!renderer || !scene || !camera) return;
    
    controls.update();
    renderer.render(scene, camera);
    
    if (document.getElementById('partModal').style.display === 'block') {
        requestAnimationFrame(animate);
    }
}



// Resizer functionality
let resizerInitialized = false;

function initResizer() {
    const resizer = document.getElementById('resizer');
    const leftSide = document.getElementById('diagramsContainer');
    const rightSide = document.getElementById('reportContainer');
    
    if (!resizer || !leftSide || !rightSide || resizerInitialized) return;
    
    let isResizing = false;
    resizerInitialized = true;
    
    // Set initial cursor style
    resizer.style.cursor = 'col-resize';
    
    function handleMouseMove(e) {
        if (!isResizing) return;
        e.preventDefault();
        
        const container = document.querySelector('.container');
        const containerRect = container.getBoundingClientRect();
        const leftWidth = e.clientX - containerRect.left;
        const totalWidth = containerRect.width;
        const leftPercent = (leftWidth / totalWidth) * 100;
        const rightPercent = 100 - leftPercent;
        
        if (leftPercent > 15 && rightPercent > 25) {
            leftSide.style.flex = `0 0 ${leftPercent}%`;
            rightSide.style.flex = `0 0 ${rightPercent}%`;
        }
    }
    
    function handleMouseUp() {
        isResizing = false;
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        resizer.style.cursor = 'col-resize';
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
    }
    
    resizer.addEventListener('mousedown', (e) => {
        e.preventDefault();
        isResizing = true;
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });
    
    // Ensure resizer cursor is always visible
    resizer.addEventListener('mouseenter', () => {
        if (!isResizing) {
            resizer.style.cursor = 'col-resize';
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // Only handle back button here since export buttons are handled in main.html
    const backBtn = document.getElementById('backButton');
    
    if (backBtn) {
        backBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            callRuby('back_to_config');
        });
    }

    // Modal close functionality
    const modal = document.getElementById('partModal');
    const closeBtn = document.querySelector('.close');
    
    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });
    
    window.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });

    initResizer();
    // Initialize the page
    setTimeout(() => {
        callRuby('ready');
    }, 100);
});

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\diagrams_style.css

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, Arial, sans-serif;
    margin: 0;
    padding: 0;
    /* Keep a light, high-contrast background to improve readability */
    background-color: #ffffff;
    color: #222;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.header {
    background: linear-gradient(90deg, #005b9f 0%, #008ad6 100%);
    color: #fff;
    padding: 14px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(0,0,0,0.06);
}

.header-content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.header h1 {
    font-size: 1.8em;
    margin: 0;
}

.header h1 {
    color: #ffffff !important;
}

.developer-credit {
    font-size: 0.78em;
    margin: 2px 0 0 0;
    opacity: 0.95;
    font-weight: 400;
}

button {
    background: linear-gradient(180deg,#00A5E3 0%, #008FCC 100%);
    color: #ffffff;
    border: none;
    padding: 10px 16px;
    border-radius: 10px; /* rounded corners consistent with tree */
    cursor: pointer;
    margin-left: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    font-weight: 600;
}

button:hover {
    filter: brightness(0.95);
}

/* Secondary buttons */
.btn-secondary {
    background: #f3f6f9;
    color: #1f2933;
    border: 1px solid #e3e7ea;
    box-shadow: none;
}

.container {
    display: flex;
    flex-grow: 1;
    overflow: hidden;
}

.diagrams-container {
    flex: 1;
    min-width: 300px;
    padding: 20px;
    background-color: #ffffff;
    border-right: 3px solid #ddd;
    overflow-y: auto;
    display: flex;
    flex-wrap: wrap;
    align-content: flex-start;
    gap: 20px;
    resize: horizontal;
}

.report-container {
    flex: 2;
    min-width: 400px;
    padding: 18px;
    padding-right: 50px !important;
    background-color: #fff;
    overflow-y: auto;
    overflow-x: auto;
    box-sizing: border-box;
    border-left: 1px solid rgba(0,0,0,0.04);
    border-radius: 10px 0 0 10px;
}

.resizer {
    width: 5px;
    background: #ddd;
    cursor: col-resize;
    user-select: none;
}

.resizer:hover {
    background: #007bff;
}

.diagram-card {
    border: 1px solid #ccc;
    padding: 12px;
    background-color: #fbfdff;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    border-radius: 12px;
}

.diagram-card h3 {
    font-size: 1.1em;
    margin-bottom: 6px;
    color: #006fb3;
}

.diagram-card p {
    font-size: 0.85em;
    color: #666;
    margin-bottom: 10px;
}

.diagram-canvas {
    border: 1px dashed #aaa;
    display: block;
    background-color: #fff;
}

table {
    border-collapse: collapse;
    margin-bottom: 18px;
    font-size: 0.8em;
    width: auto;
    max-width: calc(100% - 30px);
    table-layout: auto;
    background: transparent;
}

th, td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: left;
    white-space: nowrap;
}

th {
    background-color: #f3f6f8;
    font-weight: 600;
    color: #034a6b;
}

h2 {
    margin-top: 20px;
    margin-bottom: 12px;
    color: #006fb3;
    font-size: 1.2em;
}

.material-item {
    display: inline-flex;
    align-items: center;
    margin: 4px 8px 4px 0;
    padding: 4px 8px;
    background: #ffffff;
    border-radius: 8px;
    border: 1px solid rgba(0,0,0,0.06);
}

.material-swatch {
    width: 20px;
    height: 20px;
    border: 1px solid rgba(0,0,0,0.08);
    margin-right: 8px;
    border-radius: 4px;
}

.material-name {
    font-size: 0.9em;
    font-weight: bold;
}

#materialsContainer {
    margin-bottom: 20px;
}

@media print {
    @page {
        margin: 0.75in;
        size: letter;
    }
    
    * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
    
    body {
        font-family: Arial, sans-serif;
        font-size: 11pt;
        line-height: 1.3;
        margin: 0;
        padding: 0;
        background: white;
        color: black;
        display: block;
        height: auto;
    }
    
    .header {
        text-align: center;
        background: none;
        color: black;
        border-bottom: 2pt solid #333;
        margin-bottom: 20pt;
        padding: 15pt 0;
    }
    
    .header h1 {
        font-size: 20pt;
        font-weight: bold;
        margin: 0;
        color: #333;
    }
    
    .tabs, button, .resizer, .report-header {
        display: none !important;
    }
    
    .container {
        display: block;
        width: 100%;
    }
    
    .diagrams-container {
        display: block;
        width: 100%;
        margin-bottom: 30pt;
        page-break-after: always;
    }
    
    .report-container {
        display: block;
        width: 100%;
        margin: 0;
        padding: 0;
    }
    
    .project-info {
        background: #f8f8f8;
        border: 1pt solid #ccc;
        padding: 15pt;
        margin-bottom: 20pt;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15pt;
    }
    
    .diagram-card {
        page-break-inside: avoid;
        margin-bottom: 20pt;
        border: 1pt solid #333;
        padding: 12pt;
        background: white;
        text-align: center;
    }
    
    .diagram-card h3 {
        font-size: 14pt;
        font-weight: bold;
        margin: 0 0 8pt 0;
        color: #333;
    }
    
    .diagram-card p {
        font-size: 10pt;
        margin: 0 0 12pt 0;
        color: #666;
    }
    
    .diagram-canvas {
        max-width: 100%;
        height: auto;
        border: 1pt solid #666;
        background: white;
    }
    
    h2 {
        font-size: 16pt;
        font-weight: bold;
        margin: 25pt 0 12pt 0;
        color: #333;
        border-bottom: 1pt solid #333;
        padding-bottom: 6pt;
        page-break-after: avoid;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20pt;
        font-size: 9pt;
        page-break-inside: auto;
    }
    
    th, td {
        border: 1pt solid #333;
        padding: 6pt 8pt;
        text-align: left;
        vertical-align: top;
    }
    
    th {
        background: #e8e8e8;
        font-weight: bold;
        font-size: 10pt;
    }
    
    .total-highlight {
        background: #d4edda !important;
        font-weight: bold;
    }
    
    tr {
        page-break-inside: avoid;
    }
    
    #materialsContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 10pt;
        margin-bottom: 15pt;
    }
    
    .material-item {
        border: 1pt solid #666;
        padding: 8pt;
        background: #f5f5f5;
        display: inline-flex;
        align-items: center;
    }
}
/* Modal styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #ffffff;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid rgba(0,0,0,0.06);
    width: 520px;
    max-width: 92%;
    max-height: 80vh;
    border-radius: 12px;
    text-align: center;
    overflow-y: auto;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
}

.close:hover,
.close:focus {
    color: #000;
}

#modalCanvas {
    border: 1px solid #ddd;
    margin: 10px 0;
}

#modalInfo {
    text-align: left;
    margin-top: 15px;
}

#modalInfo h3 {
    margin-top: 0;
    color: #333;
}

#modalInfo p {
    margin: 5px 0;
    color: #666;
}

.modal-controls {
    text-align: center;
    margin-bottom: 10px;
}

.modal-controls button {
    margin: 0 5px;
    padding: 8px 16px;
    background: #007acc;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.modal-controls button:hover {
    background: #005a9e;
}

/* Tab styles */
.tabs {
    display: flex;
    gap: 10px;
}

.tab-button {
    background-color: #4b5563;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px 8px 0 0;
    cursor: pointer;
    margin-left: 0;
}

.tab-button.active {
    background: linear-gradient(180deg,#00A5E3 0%, #008FCC 100%);
}

.tab-button:disabled {
    background-color: #b0b7bd;
    cursor: not-allowed;
}

.tab-content {
    display: none;
    flex-grow: 1;
    overflow: hidden;
}

.tab-content.active {
    display: flex;
    flex-direction: column;
}

/* Report title styling */
.report-title {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid rgba(0,123,255,0.12);
}

.report-title h1 {
    margin: 0;
    color: #333;
    font-size: 2em;
}

/* Project info styling */
.project-info {
    background: #fbfdff;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 30px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.project-field {
    display: flex;
    flex-direction: column;
}

.project-field label {
    font-weight: bold;
    margin-bottom: 5px;
    color: #333;
}

.project-field input {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

/* Total highlighting */
.total-highlight {
    background-color: #eaf7ff !important;
    font-weight: 700;
    color: #014f6e;
}

/* Material item with price */
.material-price {
    font-size: 0.8em;
    color: #666;
    margin-left: 10px;
    font-weight: normal;
}

/* Report header */
.report-header {
    background-color: #f8f9fa;
    padding: 15px 20px;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* Resizer improvements */
.resizer {
    width: 5px;
    background: #ddd;
    cursor: col-resize;
    user-select: none;
    flex-shrink: 0;
}

.resizer:hover {
    background: #007bff;
}

/* Tree structure styles */
.tree-controls {
    margin: 10px 0;
}

.tree-search {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-top: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
    border: 1px solid #dee2e6;
}

.tree-search input {
    flex: 1;
    padding: 6px 10px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 13px;
}

.tree-search button {
    padding: 6px 12px;
    font-size: 12px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-left: 0;
}

.tree-search button:hover {
    background: #5a6268;
}

.tree-structure {
    background: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 15px;
    margin: 10px 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 13px;
    max-height: 500px;
    overflow-y: auto;
    line-height: 1.4;
}

.tree-header {
    font-weight: bold;
    font-size: 14px;
    color: #495057;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 2px solid #dee2e6;
}

.tree-node {
    margin: 1px 0;
}

.tree-item {
    padding: 4px 8px;
    border-radius: 3px;
    cursor: pointer;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.tree-expandable:hover {
    background-color: #e9ecef;
}

.tree-component:hover {
    background-color: #f8f9fa;
}

.expand-icon {
    width: 12px;
    text-align: center;
    font-size: 10px;
    color: #6c757d;
    user-select: none;
}

.node-icon {
    font-size: 14px;
}

.node-name {
    font-weight: 500;
    color: #212529;
}

.node-dimensions {
    color: #007bff;
    font-weight: 400;
    font-size: 12px;
    margin-left: 4px;
}

.node-material {
    color: #28a745;
    font-weight: 400;
    font-size: 12px;
    font-style: italic;
}

.tree-children {
    border-left: 1px dotted #dee2e6;
    margin-left: 10px;
}

.search-highlight {
    background-color: #fff3cd !important;
    border: 1px solid #ffeaa7;
    animation: highlight-pulse 1s ease-in-out;
}

@keyframes highlight-pulse {
    0% { background-color: #fff3cd; }
    50% { background-color: #ffeaa7; }
    100% { background-color: #fff3cd; }
}

/* Enhanced hierarchy tree visual styling (from hierarchy_tree_ui.html)
   Scoped under .tree-structure so it only affects the report tree area */
.tree-structure .tree {
    position: relative;
}

.tree-structure .tree-node {
    position: relative;
    margin-left: 0;
}

.tree-structure .tree-item {
    position: relative;
    margin-bottom: 15px;
}

.tree-structure .node-button {
    /* scaled down to better match surrounding UI */
    padding: 8px 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    transition: all 0.18s ease;
    display: inline-block;
    min-width: 120px;
}

.tree-structure .node-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
}

.tree-structure .level-1 .node-button {
    background: #00A5E3;
    color: white;
}

.tree-structure .level-2 .node-button {
    /* Avoid low-contrast dark text on gray background â€” use desaturated teal with white text */
    background: #7fa4a8;
    color: #ffffff;
}

.tree-structure .level-3 .node-button,
.tree-structure .level-4 .node-button,
.tree-structure .level-5 .node-button,
.tree-structure .level-6 .node-button,
.tree-structure .level-7 .node-button {
    background: white;
    color: #333;
    border: 2px solid #00A5E3;
}

.tree-structure .children {
    margin-left: 40px;
    margin-top: 15px;
    position: relative;
    display: none;
}

.tree-structure .children.expanded {
    display: block;
}

/* Vertical connector line for children */
.tree-structure .children::before {
    content: '';
    position: absolute;
    left: -20px;
    top: 0;
    bottom: 15px;
    width: 2px;
    background: #ccc;
}

/* Horizontal connector */
.tree-structure .tree-item::before {
    content: '';
    position: absolute;
    left: -20px;
    top: 20px;
    width: 20px;
    height: 2px;
    background: #ccc;
}

.tree-structure > .tree-node > .tree-item::before,
.tree-structure > .tree-node > .children::before {
    display: none;
}

/* Toggle indicator */
.tree-structure .node-button::after {
    content: '';
    display: inline-block;
    margin-left: 8px;
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 6px solid currentColor;
    transition: transform 0.18s ease;
    vertical-align: middle;
}

.tree-structure .node-button.expanded::after {
    transform: rotate(180deg);
}

.tree-structure .node-button.no-children::after {
    display: none;
}

.tree-structure .tree-item:last-child::before {
    display: none;
}


-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\documentation.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AutoNestCut Documentation</title>
    <link rel="stylesheet" href="diagrams_style.css">
    <style>
        .doc-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .doc-section {
            margin-bottom: 30px;
        }
        .doc-section h2 {
            color: #007bff;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .step-list {
            counter-reset: step-counter;
        }
        .step-list li {
            counter-increment: step-counter;
            margin-bottom: 15px;
            padding-left: 30px;
            position: relative;
        }
        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #007bff;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .footer {
            background: #333;
            color: white;
            padding: 30px 20px;
            margin-top: 40px;
            border-radius: 8px;
        }
        .footer h3 {
            margin-top: 0;
            color: #007bff;
        }
        .social-links {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .social-links a {
            color: #007bff;
            text-decoration: none;
            padding: 8px 12px;
            background: rgba(0,123,255,0.1);
            border-radius: 4px;
            transition: background 0.3s;
        }
        .social-links a:hover {
            background: rgba(0,123,255,0.2);
        }
        .bug-report {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        .bug-form {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }
        .bug-form input, .bug-form textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }
        .bug-form button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .bug-form button:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>AutoNestCut Documentation</h1>
            <p class="developer-credit">Developed by: Int. Arch. M.Shkeir</p>
        </div>
    </div>

    <div class="doc-container">
        <div class="doc-section">
            <h2>Overview</h2>
            <p>AutoNestCut is a professional SketchUp extension designed for woodworkers, furniture makers, and architects who need to optimize material usage and generate cutting diagrams for sheet goods. The extension automatically analyzes your 3D model components and creates efficient nesting layouts to minimize waste and reduce costs.</p>
        </div>

        <div class="doc-section">
            <h2>Key Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Automatic Part Detection</h4>
                    <p>Intelligently identifies sheet good components in your model based on dimensions and thickness.</p>
                </div>
                <div class="feature-card">
                    <h4>Material Management</h4>
                    <p>Configure stock materials with custom dimensions and pricing for accurate cost calculations.</p>
                </div>
                <div class="feature-card">
                    <h4>Optimized Nesting</h4>
                    <p>Advanced algorithms minimize waste by efficiently arranging parts on stock sheets.</p>
                </div>
                <div class="feature-card">
                    <h4>Visual Diagrams</h4>
                    <p>Generate clear cutting diagrams with part labels and dimensions for workshop use.</p>
                </div>
                <div class="feature-card">
                    <h4>Detailed Reports</h4>
                    <p>Comprehensive reports with material lists, costs, and efficiency metrics.</p>
                </div>
                <div class="feature-card">
                    <h4>Export Options</h4>
                    <p>Export to PDF, CSV, or interactive HTML formats for sharing and documentation.</p>
                </div>
            </div>
        </div>

        <div class="doc-section">
            <h2>How to Use AutoNestCut</h2>
            
            <div class="image-container" style="text-align: center; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <div style="background: #fff; padding: 10px; border-radius: 4px; display: inline-block;">
                    <img src="../../../example/kitchen_cabinets_model_showcase.JPG" alt="Kitchen Cabinet Model Example" style="max-width: 600px; height: auto; border-radius: 4px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div style="display: none; width: 600px; height: 400px; background: #e9ecef; border: 2px dashed #6c757d; align-items: center; justify-content: center; color: #6c757d; font-size: 14px;">Kitchen Cabinet Model Example<br><small>(Image not found: kitchen_cabinets_model_showcase.JPG)</small></div>
                </div>
                <p style="font-style: italic; color: #666; margin-top: 10px;">Example: Kitchen cabinet model ready for cut list generation</p>
            </div>
            
            <ol class="step-list">
                <li><strong>Prepare Your Model:</strong> Create your furniture or project in SketchUp using components for each part. Ensure sheet good parts have realistic thickness (3-50mm) and sufficient area.</li>
                <li><strong>Select Components:</strong> Select the components or groups you want to include in your cutting list. You can select individual parts or entire assemblies.</li>
                <li><strong>Launch Extension:</strong> Go to Extensions > AutoNestCut or click the toolbar button to open the configuration window.</li>
                <li><strong>Configure Settings:</strong> Set your kerf width (saw blade thickness) and choose whether to allow part rotation for better nesting.</li>
                <li><strong>Setup Materials:</strong> Add or modify stock materials with their dimensions and prices. The extension will automatically detect materials from your model.
                    <div class="image-container" style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <div style="background: #fff; padding: 8px; border-radius: 4px; display: inline-block;">
                            <img src="../../../example/stock_materials_pricing.JPG" alt="Stock Materials Configuration" style="max-width: 400px; height: auto; border-radius: 4px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="display: none; width: 400px; height: 250px; background: #e9ecef; border: 2px dashed #6c757d; align-items: center; justify-content: center; color: #6c757d; font-size: 12px;">Stock Materials Configuration<br><small>(Image not found: stock_materials_pricing.JPG)</small></div>
                        </div>
                        <p style="font-style: italic; color: #666; margin-top: 5px; font-size: 0.9em;">Configure materials with dimensions and pricing</p>
                    </div>
                </li>
                <li><strong>Review Parts:</strong> Check the parts preview to ensure all components are detected correctly with proper dimensions.</li>
                <li><strong>Generate Report:</strong> Click "Generate Cut List" to process the nesting optimization and switch to the report tab.</li>
                <li><strong>Review Results:</strong> Examine the cutting diagrams and detailed reports. Add project information like name, address, and date.
                    <div class="image-container" style="text-align: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <div style="background: #fff; padding: 8px; border-radius: 4px; display: inline-block;">
                            <img src="../../../example/diagram_example.JPG" alt="Cutting Diagram Example" style="max-width: 500px; height: auto; border-radius: 4px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="display: none; width: 500px; height: 300px; background: #e9ecef; border: 2px dashed #6c757d; align-items: center; justify-content: center; color: #6c757d; font-size: 12px;">Cutting Diagram Example<br><small>(Image not found: diagram_example.JPG)</small></div>
                        </div>
                        <p style="font-style: italic; color: #666; margin-top: 5px; font-size: 0.9em;">Generated cutting diagrams with part labels and dimensions</p>
                    </div>
                </li>
                <li><strong>Export:</strong> Save your results as PDF for printing, CSV for spreadsheets, or HTML for interactive viewing.</li>
            </ol>
        </div>

        <div class="doc-section">
            <h2>Configuration Options</h2>
            <h3>General Settings</h3>
            <ul>
                <li><strong>Kerf Width:</strong> The thickness of your saw blade cut (typically 2-4mm). This ensures proper spacing between parts.</li>
                <li><strong>Allow Rotation:</strong> Permits the algorithm to rotate parts for better nesting efficiency, unless grain direction is specified.</li>
            </ul>
            
            <h3>Stock Materials</h3>
            <ul>
                <li><strong>Material Name:</strong> Descriptive name for the material (e.g., "Plywood_19mm", "Oak_Veneer")</li>
                <li><strong>Dimensions:</strong> Width and height of standard stock sheets in millimeters</li>
                <li><strong>Price:</strong> Cost per sheet for accurate project costing</li>
            </ul>
        </div>

        <div class="doc-section">
            <h2>Understanding Reports</h2>
            <h3>Materials Used</h3>
            <p>Shows all materials in your project with their associated costs.</p>
            
            <h3>Overall Summary</h3>
            <p>Key metrics including total parts, boards needed, efficiency percentage, and total project cost.</p>
            
            <h3>Cutting Diagrams</h3>
            <p>Visual layouts showing how parts are arranged on each sheet, with part labels and dimensions. Click on any part to view it in 3D:</p>
            
            <div style="display: flex; gap: 20px; margin: 20px 0; justify-content: center;">
                <div class="image-container" style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    <div style="background: #fff; padding: 8px; border-radius: 4px;">
                        <img src="../../../example/orthographic_piece_3d_view.JPG" alt="Orthographic 3D View" style="max-width: 200px; height: auto; border-radius: 4px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 200px; height: 150px; background: #e9ecef; border: 2px dashed #6c757d; align-items: center; justify-content: center; color: #6c757d; font-size: 10px;">Orthographic 3D View<br><small>(Image not found)</small></div>
                    </div>
                    <p style="font-style: italic; color: #666; margin-top: 5px; font-size: 0.8em;">Orthographic 3D view</p>
                </div>
                <div class="image-container" style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    <div style="background: #fff; padding: 8px; border-radius: 4px;">
                        <img src="../../../example/perpective_piece_3d_view.JPG" alt="Perspective 3D View" style="max-width: 200px; height: auto; border-radius: 4px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 200px; height: 150px; background: #e9ecef; border: 2px dashed #6c757d; align-items: center; justify-content: center; color: #6c757d; font-size: 10px;">Perspective 3D View<br><small>(Image not found)</small></div>
                    </div>
                    <p style="font-style: italic; color: #666; margin-top: 5px; font-size: 0.8em;">Perspective 3D view</p>
                </div>
            </div>
            
            <h3>Detailed Tables</h3>
            <ul>
                <li><strong>Unique Part Types:</strong> List of different parts with quantities and total areas</li>
                <li><strong>Board Types:</strong> Summary of different sheet materials and quantities needed</li>
                <li><strong>Parts Placed:</strong> Complete list of every part instance with board assignments</li>
            </ul>
        </div>

        <div class="doc-section">
            <h2>Export Formats</h2>
            <p>AutoNestCut supports multiple export formats to suit different workflows:</p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ðŸ“„ PDF Export</h4>
                    <p>Perfect for printing workshop diagrams and documentation. Includes all cutting layouts and part lists.</p>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #ffc107;">
                        <strong>Example File:</strong> pdf_output_example.pdf<br>
                        <small>Contains complete cutting diagrams and part lists ready for printing</small>
                    </div>
                </div>
                <div class="feature-card">
                    <h4>ðŸ“Š CSV Export</h4>
                    <p>Spreadsheet-compatible format for inventory management and cost analysis.</p>
                    <div style="background: #d1ecf1; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #17a2b8;">
                        <strong>Example File:</strong> Cutting_List_cutlist_model_10.csv<br>
                        <small>Structured data for Excel, Google Sheets, or database import</small>
                    </div>
                </div>
                <div class="feature-card">
                    <h4>ðŸŒ Interactive HTML</h4>
                    <p>Fully interactive report with 3D part views and resizable diagrams for digital sharing.</p>
                    <div style="background: #d4edda; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #28a745;">
                        <strong>Example File:</strong> AutoNestCut_Interactive_Report.html<br>
                        <small>Self-contained interactive report with 3D visualization</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="doc-section">
            <h2>Performance Optimizations</h2>
            <p>AutoNestCut includes advanced performance optimizations to ensure smooth operation even with complex models:</p>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>âš¡ Material Caching</h4>
                    <p>Intelligent caching system stores material lookups to eliminate repeated expensive operations during processing.</p>
                </div>
                <div class="feature-card">
                    <h4>ðŸ”„ Single-Pass Processing</h4>
                    <p>Optimized algorithms process components in a single iteration, reducing processing time from ~10 seconds to under 1 second.</p>
                </div>
                <div class="feature-card">
                    <h4>ðŸŽ¯ Selective Entity Search</h4>
                    <p>Focuses only on selected entities instead of searching the entire model, dramatically improving performance with large projects.</p>
                </div>
            </div>
        </div>

        <div class="doc-section">
            <h2>Tips for Best Results</h2>
            <ul>
                <li>Model parts as separate components with realistic dimensions</li>
                <li>Use consistent naming conventions for similar parts</li>
                <li>Set appropriate grain direction attributes for wood parts</li>
                <li>Verify material assignments before generating reports</li>
                <li>Consider kerf width when setting up your stock materials</li>
                <li>Review the parts preview to catch any detection issues</li>
                <li><strong>Performance:</strong> For large models, select only the components you need to process rather than the entire model</li>
            </ul>
        </div>

        <div class="doc-section">
            <h2>Troubleshooting</h2>
            <h3>Parts Not Detected</h3>
            <ul>
                <li>Ensure parts are modeled as components, not loose geometry</li>
                <li>Check that thickness is between 3-50mm</li>
                <li>Verify minimum area requirements are met</li>
            </ul>
            
            <h3>Poor Nesting Results</h3>
            <ul>
                <li>Enable rotation if grain direction allows</li>
                <li>Adjust stock sheet sizes to better match your parts</li>
                <li>Consider breaking large assemblies into individual parts</li>
            </ul>
            
            <h3>Performance Issues</h3>
            <ul>
                <li><strong>Slow Processing:</strong> The extension now includes automatic performance optimizations that reduce processing time by up to 90%</li>
                <li><strong>Memory Usage:</strong> Caching systems are automatically cleared between sessions to prevent memory buildup</li>
                <li><strong>Large Models:</strong> Select specific components rather than entire complex assemblies for faster processing</li>
                <li><strong>Extension Reload:</strong> If experiencing issues after updates, reload the extension using the Ruby Console</li>
            </ul>
        </div>

        <div class="bug-report">
            <h3>ðŸ› Report a Bug</h3>
            <p>Found an issue? Help us improve AutoNestCut by reporting bugs:</p>
            <form class="bug-form" onsubmit="submitBugReport(event)">
                <input type="text" id="bugTitle" placeholder="Brief description of the issue" required>
                <textarea id="bugDescription" rows="4" placeholder="Detailed description of what happened, steps to reproduce, and expected behavior" required></textarea>
                <input type="email" id="bugEmail" placeholder="Your email (optional, for follow-up)">
                <button type="submit">Send Bug Report</button>
            </form>
        </div>
    </div>

    <div class="footer">
        <h3>Connect with Int. Arch. Moe Shkeir</h3>
        <div class="social-links">
            <a href="https://www.behance.net/muhamadshkeir" target="_blank">Behance</a>
            <a href="https://www.instagram.com/muhamad.a.shk/" target="_blank">Instagram</a>
            <a href="https://www.instagram.com/archi4.design/" target="_blank">Business Instagram</a>
            <a href="http://www.linkedin.com/in/muhammad-s-shkeir" target="_blank">LinkedIn</a>
            <a href="mailto:muhamad.shkeir@gmail.com">Email</a>
        </div>
        <p style="margin-top: 20px; font-size: 0.9em; opacity: 0.8;">
            Â© 2024 AutoNestCut Extension. Developed with passion for efficient woodworking and design.
        </p>
    </div>

    <script>
        function submitBugReport(event) {
            event.preventDefault();
            
            const title = document.getElementById('bugTitle').value;
            const description = document.getElementById('bugDescription').value;
            const email = document.getElementById('bugEmail').value;
            
            const subject = encodeURIComponent(`AutoNestCut Bug Report: ${title}`);
            const body = encodeURIComponent(`Bug Description:\n${description}\n\nReporter Email: ${email}\n\nSketchUp Version: ${navigator.userAgent}\nDate: ${new Date().toISOString()}`);
            
            const mailtoLink = `mailto:muhamad.shkeir@gmail.com?subject=${subject}&body=${body}`;
            window.open(mailtoLink);
            
            alert('Bug report email opened. Please send the email to complete the report.');
            document.querySelector('.bug-form').reset();
        }
    </script>
</body>
</html>

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\main.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AutoNestCut</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="diagrams_style.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>AutoNestCut</h1>
            <p class="developer-credit">Developed by: Int. Arch. M.Shkeir</p>
        </div>
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('config')">Configuration</button>
            <button class="tab-button" id="reportTab" onclick="showTab('report')" disabled>Report</button>
        </div>
    </div>

    <!-- Configuration Tab -->
    <div id="configTab" class="tab-content active">
        <div class="config-container">
            <div class="buttons-top">
                <button type="button" onclick="processNesting()" class="primary">Generate Cut List</button>
                <button type="button" onclick="window.close()">Cancel</button>
            </div>
            
            <div class="section">
                <h2>General Settings</h2>
                <div class="form-group">
                    <label for="kerf_width">Kerf Width (mm):</label>
                    <input type="number" id="kerf_width" name="kerf_width" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label for="allow_rotation">
                        <input type="checkbox" id="allow_rotation" name="allow_rotation"> Allow part rotation
                    </label>
                </div>
            </div>
            
            <div class="section">
                <h2>Stock Materials & Pricing</h2>
                <div class="materials-controls">
                    <button type="button" onclick="addMaterial()">Add Material</button>
                    <button type="button" onclick="loadDefaults()">Load Defaults</button>
                    <button type="button" onclick="importCSV()">Import CSV</button>
                    <button type="button" onclick="exportDatabase()">Export Database</button>
                    <select id="sortBy" onchange="displayMaterials()">
                        <option value="alphabetical">Sort: A-Z</option>
                        <option value="usage">Sort: Used First</option>
                        <option value="mostUsed">Sort: Most Used</option>
                    </select>
                    <button type="button" id="foldToggle" onclick="toggleFold()">Show Used Only</button>
                    <button type="button" onclick="clearHighlight()" class="clear-highlight-btn">Clear Highlight</button>
                </div>
                <div class="materials-header">
                    <span>Material Name</span>
                    <span>Width (mm)</span>
                    <span>Height (mm)</span>
                    <span>Price</span>
                    <span>Actions</span>
                    <span>Status</span>
                </div>
                <div id="materials_list" class="materials-list"></div>
            </div>
            
            <div class="section">
                <h2>Parts Preview</h2>
                <div id="parts_preview"></div>
            </div>
        </div>
    </div>

    <!-- Report Tab -->
    <div id="reportTabContent" class="tab-content">
        <div class="report-header">
            <button id="printButton">Print / Save as PDF</button>
            <button id="exportCsvButton">Export CSV Report</button>
            <button id="exportHtmlButton">Export Interactive HTML</button>
        </div>

        <div class="container">
            <div id="diagramsContainer" class="diagrams-container">
                <p>Generate a report to view diagrams...</p>
            </div>
            <div class="resizer" id="resizer"></div>
            <div id="reportContainer" class="report-container">
                <div class="report-title">
                    <h1>AutoNestCut Report</h1>
                    <p class="developer-credit">Developed by: Int. Arch. M.Shkeir</p>
                </div>
                
                <div class="project-info">
                    <div class="project-field">
                        <label for="projectName">Project Name:</label>
                        <input type="text" id="projectName" name="projectName" placeholder="Enter project name">
                    </div>
                    <div class="project-field">
                        <label for="projectAddress">Address:</label>
                        <input type="text" id="projectAddress" name="projectAddress" placeholder="Enter project address">
                    </div>
                    <div class="project-field">
                        <label for="projectDate">Date:</label>
                        <input type="date" id="projectDate" name="projectDate">
                    </div>
                </div>

                <h2>Materials Used</h2>
                <div id="materialsContainer"></div>

                <h2>Overall Summary</h2>
                <table id="summaryTable"></table>

                <h2>Unique Part Types</h2>
                <table id="uniquePartTypesTable"></table>

                <h2>Unique Board Types</h2>
                <table id="uniqueBoardTypesTable"></table>

                <h2>Boards Summary</h2>
                <table id="boardsTable"></table>

                <h2>Parts Placed (Detailed)</h2>
                <div class="tree-controls">
                    <button type="button" id="treeToggle" onclick="toggleTreeView()">Show Tree Structure</button>
                    <div class="tree-search" id="treeSearchContainer" style="display: none;">
                        <input type="text" id="treeSearch" placeholder="Search components..." oninput="filterTree()">
                        <button type="button" onclick="clearTreeSearch()">Clear</button>
                        <button type="button" onclick="expandAll()">Expand All</button>
                        <button type="button" onclick="collapseAll()">Collapse All</button>
                    </div>
                </div>
                <div id="treeStructure" class="tree-structure" style="display: none;"></div>
                <table id="partsTable"></table>
            </div>
        </div>
    </div>

    <!-- Modal for enlarged part view -->
    <div id="partModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-controls">
                <button id="projectionToggle">Orthographic</button>
            </div>
            <canvas id="modalCanvas" width="500" height="400"></canvas>
            <div id="modalInfo"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="app.js"></script>
    <script src="diagrams_report.js"></script>
    <script>
        let currentReportData = null;

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            if (tabName === 'config') {
                document.getElementById('configTab').classList.add('active');
            } else if (tabName === 'report') {
                document.getElementById('reportTabContent').classList.add('active');
            }
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        function showReportTab(data) {
            document.getElementById('reportTab').disabled = false;
            currentReportData = data;
            g_boardsData = data.diagrams;
            g_reportData = data.report;
            window.originalComponents = data.original_components || [];
            window.hierarchyTree = data.hierarchy_tree || [];
            
            // Set current date as default
            document.getElementById('projectDate').value = new Date().toISOString().split('T')[0];
            
            renderDiagrams();
            renderReport();
            showTab('report');
            
            // Initialize export button event listeners only once
            initializeExportButtons();
            
            // Re-initialize resizer after showing report tab
            setTimeout(() => {
                resizerInitialized = false;
                initResizer();
            }, 100);
        }
        
        let exportButtonsInitialized = false;
        
        function initializeExportButtons() {
            if (exportButtonsInitialized) return;
            
            const printBtn = document.getElementById('printButton');
            const exportCsvBtn = document.getElementById('exportCsvButton');
            const exportHtmlBtn = document.getElementById('exportHtmlButton');
            
            if (printBtn) {
                printBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    exportToPDF();
                });
            }
            
            if (exportCsvBtn) {
                exportCsvBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (currentReportData && currentReportData.report) {
                        callRuby('export_csv', JSON.stringify(currentReportData.report));
                    } else {
                        alert('No report data available for export.');
                    }
                });
            }
            
            if (exportHtmlBtn) {
                exportHtmlBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (typeof exportInteractiveHTML === 'function') {
                        exportInteractiveHTML();
                    } else {
                        alert('HTML export feature is not available.');
                    }
                });
            }
            
            exportButtonsInitialized = true;
        }
        
        function exportToPDF() {
            const modelName = document.title || 'Untitled';
            const timestamp = new Date().toISOString().slice(0,10);
            const filename = `AutoNestCut_Report_${modelName.replace(/[^\w]/g, '_')}_${timestamp}`;
            
            document.title = filename;
            window.print();
        }

        function showError(message) {
            alert(message);
        }
        
        function showConfigTab() {
            showTab('config');
        }
        
        function toggleTreeView() {
            showTreeView = !showTreeView;
            const button = document.getElementById('treeToggle');
            const treeContainer = document.getElementById('treeStructure');
            const searchContainer = document.getElementById('treeSearchContainer');
            
            if (showTreeView) {
                button.textContent = 'Hide Tree Structure';
                treeContainer.style.display = 'block';
                searchContainer.style.display = 'flex';
                renderTreeStructure();
            } else {
                button.textContent = 'Show Tree Structure';
                treeContainer.style.display = 'none';
                searchContainer.style.display = 'none';
            }
        }
        

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {

            const modal = document.getElementById('partModal');
            const closeBtn = document.querySelector('.close');
            
            closeBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Initialize resizer with a delay to ensure DOM is ready
            setTimeout(() => {
                initResizer();
            }, 100);
            callRuby('ready');
        });
    </script>
</body>
</html>

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\report.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AutoNestCut Report</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Cut List Report</h1>
        
        <div class="section">
            <h2>Summary</h2>
            <div id="summary_info"></div>
        </div>
        
        <div class="section">
            <h2>Boards Required</h2>
            <div id="boards_table"></div>
        </div>
        
        <div class="section">
            <h2>Parts List</h2>
            <div id="parts_table"></div>
        </div>
        
        <div class="buttons">
            <button type="button" onclick="exportCSV()" class="primary">Export CSV</button>
            <button type="button" onclick="window.close()">Close</button>
        </div>
    </div>
    
    <script>
        let reportData = null;
        
        function receiveReportData(data) {
            reportData = data;
            displayReport();
        }
        
        function displayReport() {
            if (!reportData) return;
            
            displaySummary();
            displayBoards();
            displayParts();
        }
        
        function displaySummary() {
            const summary = reportData.report.summary;
            document.getElementById('summary_info').innerHTML = `
                <div class="summary-grid">
                    <div>Total Parts: <strong>${summary.total_parts}</strong></div>
                    <div>Total Boards: <strong>${summary.total_boards}</strong></div>
                    <div>Overall Efficiency: <strong>${summary.overall_efficiency}%</strong></div>
                    <div>Total Waste: <strong>${summary.overall_waste_percentage}%</strong></div>
                </div>
            `;
        }
        
        function displayBoards() {
            const boards = reportData.report.boards;
            let html = '<table><thead><tr><th>Board#</th><th>Material</th><th>Size</th><th>Parts</th><th>Efficiency</th><th>Waste</th></tr></thead><tbody>';
            
            boards.forEach(board => {
                html += `<tr>
                    <td>${board.board_number}</td>
                    <td>${board.material}</td>
                    <td>${board.stock_size}</td>
                    <td>${board.parts_count}</td>
                    <td>${board.efficiency}%</td>
                    <td>${board.waste_percentage}%</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            document.getElementById('boards_table').innerHTML = html;
        }
        
        function displayParts() {
            const parts = reportData.report.parts;
            let html = '<table><thead><tr><th>Part#</th><th>Name</th><th>Dimensions</th><th>Material</th><th>Board#</th><th>Rotated</th></tr></thead><tbody>';
            
            parts.forEach(part => {
                html += `<tr>
                    <td>${part.part_number}</td>
                    <td>${part.name}</td>
                    <td>${part.width} Ã— ${part.height} Ã— ${part.thickness}mm</td>
                    <td>${part.material}</td>
                    <td>${part.board_number}</td>
                    <td>${part.rotated}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            document.getElementById('parts_table').innerHTML = html;
        }
        
        function exportCSV() {
            sketchup.export_csv();
        }
        
        // Initialize when page loads
        window.addEventListener('load', function() {
            sketchup.ready();
        });
    </script>
</body>
</html>

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\AutoNestCut\ui\html\style.css

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f5f5f5;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.config-container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow-y: auto;
    flex-grow: 1;
}

h1 {
    color: #333;
    margin-bottom: 30px;
    text-align: center;
}

h2 {
    color: #555;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
}

.section {
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input[type="number"], input[type="text"] {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

input[type="checkbox"] {
    margin-right: 8px;
}

.materials-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
    align-items: center;
}

.materials-controls select {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 12px;
}

.materials-controls button {
    padding: 8px 12px;
    font-size: 12px;
}

.materials-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr auto auto;
    gap: 10px;
    margin-bottom: 10px;
    padding: 8px;
    background: #e9ecef;
    border-radius: 4px;
    font-weight: bold;
    font-size: 12px;
    color: #495057;
}

.materials-list {
    position: relative;
}

.materials-list.folded::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: linear-gradient(transparent, rgba(248, 249, 250, 0.9));
    pointer-events: none;
    border-radius: 0 0 4px 4px;
}

.material-item {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr auto auto;
    gap: 10px;
    margin-bottom: 10px;
    align-items: center;
    padding: 8px;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.material-used {
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
}

.material-unused {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
}

.used-indicator {
    color: #155724;
    font-weight: bold;
    font-size: 12px;
}

.unused-indicator {
    color: #6c757d;
    font-size: 12px;
}

.material-item input {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.material-item button {
    background: #dc3545;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
}

.highlight-btn {
    background: #28a745 !important;
    font-size: 14px;
    padding: 6px 10px !important;
    min-width: 30px;
}

.highlight-btn:hover {
    background: #218838 !important;
}

.clear-highlight-btn {
    background: #ffc107 !important;
    color: #212529 !important;
    font-weight: bold;
}

.clear-highlight-btn:hover {
    background: #e0a800 !important;
}

.buttons {
    text-align: center;
    margin-top: 30px;
}

.buttons-top {
    text-align: center;
    margin-bottom: 30px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 4px;
}

button {
    padding: 10px 20px;
    margin: 0 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

button.primary {
    background: #007bff;
    color: white;
}

button:not(.primary) {
    background: #6c757d;
    color: white;
}

button:hover {
    opacity: 0.9;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

th, td {
    padding: 8px 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

th {
    background-color: #f8f9fa;
    font-weight: bold;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 15px 0;
}

.summary-grid > div {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 4px;
    text-align: center;
}

.tree-controls {
    margin: 10px 0;
}

.tree-search {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-top: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
    border: 1px solid #dee2e6;
}

.tree-search input {
    flex: 1;
    padding: 6px 10px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 13px;
}

.tree-search button {
    padding: 6px 12px;
    font-size: 12px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.tree-search button:hover {
    background: #5a6268;
}

.tree-structure {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 10px;
    padding: 30px;
    margin: 10px 0;
    font-family: Arial, sans-serif;
    max-height: 500px;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.tree-header {
    font-weight: bold;
    font-size: 18px;
    color: #333;
    margin-bottom: 20px;
    text-align: left;
}

.tree-node {
    position: relative;
    margin-bottom: 15px;
}

.tree-item {
    position: relative;
}

.node-button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    transition: all 0.3s ease;
    display: inline-block;
    min-width: 140px;
}

.node-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.level-1 .node-button {
    background: #00A5E3;
    color: white;
}

.level-2 .node-button {
    background: #B8BABC;
    color: #333;
}

.level-3 .node-button,
.level-4 .node-button,
.level-5 .node-button,
.level-6 .node-button,
.level-7 .node-button {
    background: white;
    color: #333;
    border: 2px solid #00A5E3;
}

.children {
    margin-left: 40px;
    margin-top: 15px;
    position: relative;
    display: none;
}

.children.expanded {
    display: block;
}

.children::before {
    content: '';
    position: absolute;
    left: -20px;
    top: 0;
    bottom: 15px;
    width: 2px;
    background: #ccc;
}

.tree-item::before {
    content: '';
    position: absolute;
    left: -20px;
    top: 20px;
    width: 20px;
    height: 2px;
    background: #ccc;
}

.tree > .tree-node > .tree-item::before {
    display: none;
}

.tree > .tree-node > .children::before {
    display: none;
}

.node-button::after {
    content: '';
    display: inline-block;
    margin-left: 8px;
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 6px solid currentColor;
    transition: transform 0.3s ease;
    vertical-align: middle;
}

.node-button.expanded::after {
    transform: rotate(180deg);
}

.node-button.no-children::after {
    display: none;
}

.tree-item:last-child::before {
    display: none;
}

.search-highlight {
    background-color: #fff3cd !important;
    border: 2px solid #ffc107 !important;
    animation: highlight-pulse 1s ease-in-out;
}

@keyframes highlight-pulse {
    0% { background-color: #fff3cd; }
    50% { background-color: #ffeaa7; }
    100% { background-color: #fff3cd; }
}

-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\extras\placeholder_icon.txt

This file used to be `resources/icon.png` but it was a placeholder text file (not a real PNG).

If you want the toolbar icon to show up in SketchUp, add a valid 24x24 (or 32x32) PNG at one of these locations:

- `AutoNestCut/AutoNestCut/resources/icon.png`  (preferred, placed inside the extension package)
- `AutoNestCut/resources/icon.png`               (legacy location)
- `icon.png`                                     (repo root, used as a last-resort fallback)

The extension now checks these locations and verifies that the file begins with the PNG signature. If you have a ready PNG, place it into `AutoNestCut/AutoNestCut/resources/icon.png` and restart SketchUp.


-------------------------------------------
FILE: F:\alt_drive\cutlist\AutoNestCut\resources\icon.png

# This would be a binary PNG file in a real implementation
# For now, creating a placeholder text file
# In practice, you would need to create a 24x24 pixel PNG icon
# representing cutting/nesting (e.g., rectangles arranged on a sheet)

